<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sensors">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sensors: Thermal Camera in Gazebo</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sensors</h1>
        <h2>API Reference</h2>
        <div class="version">
        7.3.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Thermal Camera in Gazebo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial, we will discuss how to use a thermal camera sensor in <a href="https://gazebosim.org/libs/sim">Gazebo</a>.</p>
<p>There are currently a few limitations with the thermal camera, which will be mentioned at the end of the tutorial.</p>
<h2><a class="anchor" id="autotoc_md40"></a>
Requirements</h2>
<p>Since this tutorial will show how to use a thermal camera sensor in Gazebo, you'll need to have Gazebo installed. We recommend installing all Gazebo libraries, using version Citadel or newer (the thermal camera is not available in Gazebo versions prior to Citadel).</p>
<p>The following thermal camera capabilities are available starting from Gazebo Dome:</p><ul>
<li>Heat signature capabilities (supports objects with a variable surface temperature)</li>
<li>8-bit thermal camera image format (the default thermal camera image format is 16-bit)</li>
</ul>
<p>If you need to install Gazebo, <a href="https://gazebosim.org/docs">pick the version you'd like to use</a> and then follow the installation instructions.</p>
<h2><a class="anchor" id="autotoc_md41"></a>
Setting up the thermal camera</h2>
<p>Here's an example of how to attach a thermal camera sensor to a model in a <a href="http://sdformat.org/">SDF</a> file:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;thermal_camera_8bit&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">pose</span>&gt;4.5 0 0.5 0.0 0.0 3.14&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;link&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">pose</span>&gt;0.05 0.05 0.05 0 0 0&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">collision</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;collision&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">box</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">size</span>&gt;0.1 0.1 0.1&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">collision</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">visual</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;visual&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">box</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">size</span>&gt;0.1 0.1 0.1&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">visual</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">sensor</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;thermal_camera_8bit&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;thermal&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">camera</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">horizontal_fov</span>&gt;1.047&lt;/<span class="keywordtype">horizontal_fov</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">image</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">width</span>&gt;320&lt;/<span class="keywordtype">width</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">height</span>&gt;240&lt;/<span class="keywordtype">height</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">format</span>&gt;<span class="keyword">L8</span>&lt;/<span class="keywordtype">format</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">image</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">clip</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">near</span>&gt;0.1&lt;/<span class="keywordtype">near</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">far</span>&gt;100&lt;/<span class="keywordtype">far</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">clip</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">camera</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">always_on</span>&gt;1&lt;/<span class="keywordtype">always_on</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">update_rate</span>&gt;30&lt;/<span class="keywordtype">update_rate</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">visualize</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">visualize</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">topic</span>&gt;<span class="keyword">thermal_camera_8bit</span>/<span class="keyword">image</span>&lt;/<span class="keywordtype">topic</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">plugin</span></div>
<div class="line">        <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thermal-sensor-system&quot;</span></div>
<div class="line">        <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::ThermalSensor&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">min_temp</span>&gt;253.15&lt;/<span class="keywordtype">min_temp</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">max_temp</span>&gt;673.15&lt;/<span class="keywordtype">max_temp</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">resolution</span>&gt;3.0&lt;/<span class="keywordtype">resolution</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">sensor</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">link</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">static</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">static</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>Let's take a closer look at the portion of the code above that focuses on the thermal camera sensor:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">sensor</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;thermal_camera_8bit&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;thermal&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">camera</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">horizontal_fov</span>&gt;1.047&lt;/<span class="keywordtype">horizontal_fov</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">image</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">width</span>&gt;320&lt;/<span class="keywordtype">width</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">height</span>&gt;240&lt;/<span class="keywordtype">height</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">format</span>&gt;<span class="keyword">L8</span>&lt;/<span class="keywordtype">format</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">image</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">clip</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">near</span>&gt;0.1&lt;/<span class="keywordtype">near</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">far</span>&gt;100&lt;/<span class="keywordtype">far</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">clip</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">camera</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">always_on</span>&gt;1&lt;/<span class="keywordtype">always_on</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">update_rate</span>&gt;30&lt;/<span class="keywordtype">update_rate</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">visualize</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">visualize</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">topic</span>&gt;<span class="keyword">thermal_camera_8bit</span>/<span class="keyword">image</span>&lt;/<span class="keywordtype">topic</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">plugin</span></div>
<div class="line">    <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thermal-sensor-system&quot;</span></div>
<div class="line">    <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::ThermalSensor&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">min_temp</span>&gt;253.15&lt;/<span class="keywordtype">min_temp</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">max_temp</span>&gt;673.15&lt;/<span class="keywordtype">max_temp</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">resolution</span>&gt;3.0&lt;/<span class="keywordtype">resolution</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">sensor</span>&gt;</div>
</div><!-- fragment --><p>As we can see, we define a sensor with the following SDF elements:</p><ul>
<li><code>&lt;camera&gt;</code>: The camera, which has the following child elements:<ul>
<li><code>&lt;horizontal_fov&gt;</code>: The horizontal field of view, in radians.</li>
<li><code>&lt;image&gt;</code>: The image size, in pixels.<ul>
<li><code>&lt;format&gt;</code>: The image format. Here, 8-bit (<code>L8</code>) is used, but 16-bit (<code>L16</code>) can also be used. The default thermal camera image format is 16-bit unless otherwise specified.</li>
</ul>
</li>
<li><code>&lt;clip&gt;</code>: The near and far clip planes. Objects are only rendered if they're within these planes.</li>
</ul>
</li>
<li><code>&lt;always_on&gt;</code>: Whether the sensor will always be updated (indicated by <code>1</code>) or not (indicated by <code>0</code>). This is currently unused by Gazebo.</li>
<li><code>&lt;update_rate&gt;</code>: The sensor's update rate, in Hz.</li>
<li><code>&lt;visualize&gt;</code>: Whether the sensor should be visualized in the GUI (indicated by <code>true</code>) or not (indicated by <code>false</code>). This is currently unused by Gazebo.</li>
<li><code>&lt;topic&gt;</code>: The name of the topic where sensor data is published. This is needed for visualization.</li>
</ul>
<p>There's also an optional plugin used here that allows for further configuration of the thermal camera. Here's a description of the elements in this plugin (if the plugin isn't used, the default values mentioned below are used):</p><ul>
<li><code>&lt;min_temp&gt;</code>: The thermal camera's minimum temperature, in Kelvin. The default minimum temperature is <code>0</code>.</li>
<li><code>&lt;max_temp&gt;</code>: The thermal camera's maximum temperature, in Kelvin. The default maximum temperature is calculated as <code>(2^(bitDepth) - 1) * resolution</code>. For a 8-bit thermal camera with a linear resolution of <code>3.0</code>, the maximum temperature is <code>((2^8) - 1) * 3 = 765 Kelvin</code>.</li>
<li><code>&lt;resolution&gt;</code>: The thermal camera's linear resolution. The default linear resolution is <code>0.01</code> for a 16-bit thermal camera, and <code>3.0</code> for a 8-bit thermal camera.</li>
</ul>
<h2><a class="anchor" id="autotoc_md42"></a>
Assigning a temperature to a model</h2>
<p>Now that we have set up our thermal camera, we'll need to assign temperatures to models in the environment. If a model doesn't have a temperature associated with it, then the model's temperature is set to the ambient temperature. There will be some variation in the model's temperature based on the model's color and the world's temperature gradient.</p>
<p>The thermal camera can support objects that either have a uniform or varying surface temperature. We will go over each approach in the following subsections.</p>
<h3><a class="anchor" id="autotoc_md43"></a>
Setting atmospheric temperature properties</h3>
<p>It is recommended to specify the ambient temperature and world's temperature gradient, since this dictates how objects with no specified temperature appear. Here's an example that sets the ambient temperature to 300 kelvin, and the temperature gradient to 0.1 Kelvin/meter:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">atmosphere</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;adiabatic&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">temperature</span>&gt;300&lt;/<span class="keywordtype">temperature</span>&gt;</div>
<div class="line">  <span class="comment">&lt;!--</span></div>
<div class="line"><span class="comment">    This is a more exaggerated temperature gradient, which produces a</span></div>
<div class="line"><span class="comment">    temperature range of ~11.5 kelvin for objects in the thermal camera</span></div>
<div class="line"><span class="comment">    view that don&#39;t have a user-specified temperature.</span></div>
<div class="line"><span class="comment">    Typical temperature gradient is -0.0065 K/m which produces a</span></div>
<div class="line"><span class="comment">    temperature range of 0.75 kelvin.</span></div>
<div class="line"><span class="comment">  --&gt;</span></div>
<div class="line">  &lt;<span class="keywordtype">temperature_gradient</span>&gt;0.1&lt;/<span class="keywordtype">temperature_gradient</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">atmosphere</span>&gt;</div>
</div><!-- fragment --><p>The default values for ambient temperature and temperature gradient can be found in the <a href="http://sdformat.org/spec?ver=1.7&amp;elem=world#world_atmosphere">SDFormat Specification</a>.</p>
<h3><a class="anchor" id="autotoc_md44"></a>
Objects with a uniform temperature</h3>
<p>Here's an example of a box model that has a uniform temperature assigned to it:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">pose</span>&gt;-1 1 0.5 0 0 0&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box_link&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">inertial</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">inertia</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">ixx</span>&gt;1&lt;/<span class="keywordtype">ixx</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">ixy</span>&gt;0&lt;/<span class="keywordtype">ixy</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">ixz</span>&gt;0&lt;/<span class="keywordtype">ixz</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">iyy</span>&gt;1&lt;/<span class="keywordtype">iyy</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">iyz</span>&gt;0&lt;/<span class="keywordtype">iyz</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">izz</span>&gt;1&lt;/<span class="keywordtype">izz</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">inertia</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">mass</span>&gt;1.0&lt;/<span class="keywordtype">mass</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">inertial</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">collision</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box_collision&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">box</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">size</span>&gt;1 1 1&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">collision</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">visual</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box_visual&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">box</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">size</span>&gt;1 1 1&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">material</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">ambient</span>&gt;1 0 0 1&lt;/<span class="keywordtype">ambient</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">diffuse</span>&gt;1 0 0 1&lt;/<span class="keywordtype">diffuse</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">specular</span>&gt;1 0 0 1&lt;/<span class="keywordtype">specular</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">material</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">plugin</span></div>
<div class="line">        <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thermal-system&quot;</span></div>
<div class="line">        <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Thermal&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">temperature</span>&gt;285.0&lt;/<span class="keywordtype">temperature</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">visual</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">link</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>Most of the code above is for the model - here's the key piece for temperature assignment:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thermal-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Thermal&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">temperature</span>&gt;285.0&lt;/<span class="keywordtype">temperature</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>Once the thermal system plugin is specified, all we need to do is include the <code>&lt;temperature&gt;</code> element, which specifies the model's temperature in Kelvin.</p>
<h3><a class="anchor" id="autotoc_md45"></a>
Objects with a varying surface temperature</h3>
<p>Most of the time, objects have a varying surface temperature. Here's an example of the <a href="https://app.gazebosim.org/OpenRobotics/fuel/models/Rescue%20Randy">Rescue Randy</a> model, which has a "heat signature" applied to it. The heat signature is a texture that can be applied to a model, which specifies the model's temperature across its surface.</p>
<p>If we take a look at Rescue Randy's <code>model.sdf</code>, we can see that it incorporates the thermal system plugin, just like the uniform temperature box example above:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thermal-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Thermal&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">heat_signature</span>&gt;<span class="keyword">materials</span>/<span class="keyword">textures</span>/<span class="keyword">RescueRandy_Thermal.png</span>&lt;/<span class="keywordtype">heat_signature</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">max_temp</span>&gt;310&lt;/<span class="keywordtype">max_temp</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>There are a few differences to note for objects with a varying surface temperature:</p><ul>
<li><code>&lt;heat_signature&gt;</code>: The path to the heat signature texture. In this example, the path is given relative to where the Rescue Randy fuel model is located. This can either be an <a href="https://gazebosim.org/libs/fuel_tools">Gazebo Fuel</a> URI, or a path to a file that is on your machine locally.</li>
<li><code>&lt;min_temp&gt;</code>: The minimum temperature (in Kelvin) that should be represented by the heat signature. This defaults to the world's ambient temperature if not specified.</li>
<li><code>&lt;max_temp&gt;</code>: The maximum temperature (in Kelvin) that should be represented by the heat signature. This defaults to the world's ambient temperature if not specified.</li>
</ul>
<h2><a class="anchor" id="autotoc_md46"></a>
Running an example:</h2>
<p>Now that we've discussed how a thermal camera and models with temperature can be specified, let's start an example world that uses the thermal camera.</p>
<p>Run the following command:</p>
<div class="fragment"><div class="line">gz sim -r thermal_camera.sdf</div>
</div><!-- fragment --><p>You should see something similar to this:</p>
<div class="image">
<img src="files/thermal_camera/thermal_camera_demo.png" alt=""/>
</div>
<p>Taking a look at the <a href="https://github.com/gazebosim/gz-sim/blob/e647570f25f962d63af75cf669ff72731d57bd5e/examples/worlds/thermal_camera.sdf">SDF file</a> for this example shows that the box was assigned a temperature of 285 Kelvin.</p>
<p>If we take a look at the Rescue Randy and Samsung J8 <a href="https://app.gazebosim.org/dashboard">fuel models</a>, we see that they have the following temperature range (the SDF file we are using with these models has an <a href="https://github.com/gazebosim/gz-sim/blob/e647570f25f962d63af75cf669ff72731d57bd5e/examples/worlds/thermal_camera.sdf#L135-L144">ambient temperature of 300 Kelvin</a>):</p><ul>
<li>Rescue Randy: 300 Kelvin to 310 Kelvin</li>
<li>Samsung J8: 298.75 Kelvin to 300 Kelvin</li>
</ul>
<p>The temperature of objects in the view of the camera are normalized between 0 (black) and 255 (white) values. The object with the highest temperature in the camera's view will always have white color. If you move the object with the highest temperature out of the camera's view, the object with second highest temperature now becomes white.</p>
<p>You can move the position of the objects and/or camera around in the world to see the effect it has on the camera's output (the different "camera outputs" are how they are visualized in the GUI). An easy way to move objects in the world is by using <code>Transform Control</code>:</p>
<div class="image">
<img src="files/thermal_camera/thermal_camera_demo_2.png" alt=""/>
</div>
<p>Another thing that you can do is modify the temperature ranges for objects with a heat signature. For example, if you go to the fuel cache on your machine (located at <code>~/.gz/fuel/</code> by default) and then modify Rescue Randy's <code>model.sdf</code> to have <code>min_temp</code> be <code>200</code>, and <code>max_temp</code> be <code>500</code>, you should see output similar to this (be sure to re-start the simulator by killing the current simulator (<code>ctrl-c</code> will do) and then re-running <code>gz sim -r thermal_camera.sdf</code>):</p>
<div class="image">
<img src="files/thermal_camera/thermal_camera_demo_3.png" alt=""/>
</div>
<p>Since Rescue Randy's maximum temperature (500 Kelvin) is significantly larger (~200 Kelvin or more) than the temperature of other objects in the scene, Rescue Randy is now a lot brighter compared to the rest of each camera's output.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Processing the thermal camera's output</h2>
<p>In the example above, the thermal cameras publish an <a href="https://github.com/gazebosim/gz-msgs/blob/main/proto/gz/msgs/image.proto">image message</a> to the following topics whenever the camera has a new image:</p><ul>
<li>8-bit thermal camera: <code>/thermal_camera_8bit/image</code></li>
<li>16-bit thermal camera: <code>/thermal_camera</code></li>
</ul>
<p>We can observe the contents of a single message from the 16-bit camera by running the following command:</p>
<div class="fragment"><div class="line">gz topic -e -n 1 -t /thermal_camera</div>
</div><!-- fragment --><p>Here are some important things to observe from the message output:</p><ul>
<li><code>width</code>: 320</li>
<li><code>height</code>: 240</li>
<li><code>pixel_format_type</code>: L_INT16 (16-bit integer)</li>
</ul>
<p>This means that the image is stored in the message as a byte array of size 320x240 pixels. In order to do anything useful with the image stored in the message, we must convert the data in the array back to kelvin. Since the <code>pixel_format_type</code> is <code>L_INT16</code>, that means we need to cast the byte array to an array of unsigned 16-bit integers.</p>
<p>Here's an example 16-bit thermal camera subscriber that performs this conversion:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;gz/msgs/image.pb.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gz/transport.hh&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// used to set the proper resolution of the camera&#39;s output (10mK)</span></div>
<div class="line"><span class="keywordtype">double</span> linearResolution = 0.01;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// a callback function that is triggered whenever the thermal camera</span></div>
<div class="line"><span class="comment">// topic receives a new image message</span></div>
<div class="line"><span class="keywordtype">void</span> OnImage(<span class="keyword">const</span> gz::msgs::Image &amp;_msg)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// convert the serialized image data to 16-bit temperature values</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> thermalSamples = _msg.width() * _msg.height();</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> thermalBufferSize = thermalSamples * <span class="keyword">sizeof</span>(uint16_t);</div>
<div class="line">  <span class="keyword">auto</span> *thermalBuffer = <span class="keyword">new</span> uint16_t[thermalSamples];</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/byte/memcpy.html">memcpy</a>(thermalBuffer, _msg.data().c_str(), thermalBufferSize);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> r = 0; r &lt; _msg.height(); ++r)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// need to figure out the row offset in order to mimic 2D array access</span></div>
<div class="line">    <span class="comment">// with 1D array indexing</span></div>
<div class="line">    <span class="keyword">auto</span> rowOffset = r * _msg.width();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> c = 0; c &lt; _msg.width(); ++c)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// convert the 16-bit value to Kelvin via the camera&#39;s linearResolution</span></div>
<div class="line">      <span class="keyword">auto</span> temp = thermalBuffer[rowOffset + c] * linearResolution;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// do something useful with the temperature (in Kelvin) here</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">delete</span>[] thermalBuffer;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  gz::transport::Node node;</div>
<div class="line">  <span class="keywordflow">if</span> (!node.Subscribe(<span class="stringliteral">&quot;/thermal_camera&quot;</span>, &amp;OnImage))</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error subscribing to the thermal camera topic&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  gz::transport::waitForShutdown();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Save the above code to a file named <code>main.cpp</code> and use this <code>CMakeLists.txt</code> to build it.</p>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.5 FATAL_ERROR)</div>
<div class="line">project(image-listener)</div>
<div class="line"> </div>
<div class="line"># Find the Gazebo Libraries used directly by the example</div>
<div class="line">find_package(gz-msgs9 REQUIRED)</div>
<div class="line">find_package(gz-transport12 REQUIRED)</div>
<div class="line"> </div>
<div class="line">add_executable(${PROJECT_NAME} main.cpp)</div>
<div class="line">target_link_libraries(${PROJECT_NAME} PUBLIC gz-msgs9 gz-transport12)</div>
<div class="line">target_include_directories(${PROJECT_NAME} PUBLIC ${gz_msgs9_INCLUDE_DIRS})</div>
</div><!-- fragment --><p>Although most of the code above is described in the comments, let's go over the key points again:</p><ul>
<li>The image published by the camera is represented as serialized bytes. In order to read the actual temperature data that's stored in the image, we need to convert the data in the image to unsigned 16-bit integers.</li>
<li>Once the image is stored in an array of unsigned 16-bit integers, we'll need to multiply the data in this array by the camera's linear resolution in order to ensure we are working with units of Kelvin. Since this thermal camera has a linear resolution of .01 (10mK), and the maximum value that can be stored in an unsigned 16-bit integer is 65535, this means that the maximum temperature that can be recorded by this camera is (65535 * .01) = 655.35 Kelvin / 680.72 F / 360.4 C.</li>
</ul>
<h2><a class="anchor" id="autotoc_md48"></a>
Thermal Camera Limitations</h2>
<p>The thermal camera has a few limitations:</p><ul>
<li>If one object with a given temperature blocks another object with a given temperature (with respect to the thermal camera's point of view), the blocked object will not be displayed at all, regardless of each object's thickness and temperature difference between them (see the image below for an example). A more realistic implementation would have the camera display temperature fluctuations in the closer object if the temperature difference between the two objects is large enough, and if the closer object isn't too thick.<ul>
<li>More information about thermal camera behavior can be found <a href="https://www.flir.com/discover/cores-components/can-thermal-imaging-see-through-walls/">here</a>.</li>
</ul>
</li>
<li>There's a precision loss when the thermal camera converts temperature readings to gray scale output. To help quantify the magnitude of this precision loss, running the conversion code above on <a href="https://github.com/gazebosim/gz-sim/blob/990e4f240bbb3246a0e1d0c89b74e0ef8f109b4b/examples/worlds/thermal_camera.sdf">this SDF file</a> results in the following processed temperatures for each object in the camera's image:<ul>
<li>sphere: listed in the SDF file as 600 Kelvin, processed from the thermal camera image topic as 598.81 Kelvin</li>
<li>box: listed in the SDF file as 200 Kelvin, processed from the thermal camera image topic as 200.46 Kelvin</li>
<li>cylinder: listed in the SDF file as 400 Kelvin, processed from the thermal camera image topic as 400.92 Kelvin</li>
</ul>
</li>
</ul>
<div class="image">
<img src="files/thermal_camera/hot_object_behind_cool_object.png" alt=""/>
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
