<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sensors">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sensors: Custom sensors</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sensors</h1>
        <h2>API Reference</h2>
        <div class="version">
        10.0.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Custom sensors</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Next Tutorial: <a class="el" href="thermalcameraigngazebo.html">Thermal Camera in Gazebo</a></p>
<p>Gazebo Sensors comes with various built-in sensor types ready to be used. Users aren't limited to those sensor types though. This tutorial will go over the process of implementing a custom sensor that leverages Gazebo Sensors and can be used with downstream applications such as Gazebo.</p>
<h2><a class="anchor" id="why-custom-sensors"></a>
Why custom sensors</h2>
<p>The set of built-in sensors provided by Gazebo Sensors is tied to the SDFormat specification. SDFormat is meant to be as general-purpose as possible, so adding lots of exotic sensors to the specification may become a maintenance burden and counter-productive. Therefore, sensors that are very specific to certain applications are better implemented closer to the applications that need them, than added to the general-purpose specification.</p>
<p>It may also be interesting for downstream projects to implement very specific versions of sensors which are not generally useful for other projects.</p>
<p>Finally, another reason to develop custom sensors is for projects that need to implement proprietary sensors that can't be shared publicly.</p>
<h2><a class="anchor" id="do-i-need-to-use-gazebo-sensors"></a>
Do I need to use Gazebo Sensors?</h2>
<p>A simulated sensor consists of code that can be used to extract specific data from a running simulation. A camera extracts pixels, an IMU extracts accelerations, etc. This doesn't necessarily need to be done though Gazebo Sensors. On Gazebo, for example, it's possible to implement functionality similar to a sensor just using a system plugin without any connection to Gazebo Sensors.</p>
<p>With that in mind, it's worth going over some of the features that Gazebo Sensors provides that make it easier to implement sensors, instead of writing everything from scratch:</p>
<ul>
<li>Standard handling of common parameters, like topic and update rate;</li>
<li>Common APIs for updating the sensors in a loop;</li>
<li>A standard way for loading custom sensors from an SDF <code>&lt;sensor&gt;</code> tag;</li>
<li>Efficient updates for various rendering sensors using the same scene.</li>
</ul>
<h2><a class="anchor" id="lets-get-started"></a>
Let's get started!</h2>
<p>Let's go over the creation of a custom <a href="https://en.wikipedia.org/wiki/Odometer">odometer</a> sensor which will measure the total distance travelled by a robot.</p>
<p>This example is located at <a href="https://github.com/gazebosim/gz-sensors/tree/gz-sensors10/examples/custom_sensor">gz-sensors/examples/custom_sensor</a>, and the integration with Gazebo is at <a href="https://github.com/gazebosim/gz-sim/tree/gz-sensors10/examples/plugin/custom_sensor_system">gz-sim/examples/plugins/custom_sensor_system</a>.</p>
<p>Wherever "odometer" is used, that can be substituted for any other custom sensor type. Seismometer? Breathalyzer? Just adapt the logic to your needs.</p>
<h3><a class="anchor" id="sdf"></a>
SDF</h3>
<p>Custom sensors follow these rules to be loaded from SDFormat:</p>
<ul>
<li>Use <code>type="custom"</code> inside the <code>&lt;sensor&gt;</code> tag</li>
<li>Add an extra <code>gz:type="odometer"</code> attribute, where <code>odometer</code> is a string that uniquely identifies the sensor type.</li>
<li>Optionally, add an <code>&lt;gz:odometer/&gt;</code> element with configuration specific to that sensor.</li>
</ul>
<p>With that in mind, here's what the sensor tag would look like:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">sensor</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;the_odometer&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;custom&quot;</span> <span class="keyword">gz:type</span>=<span class="stringliteral">&quot;odometer&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">always_on</span>&gt;1&lt;/<span class="keywordtype">always_on</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">update_rate</span>&gt;30&lt;/<span class="keywordtype">update_rate</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">topic</span>&gt;<span class="keyword">odom</span>&lt;/<span class="keywordtype">topic</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">gz:odometer</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">noise</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gaussian&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">mean</span>&gt;0.2&lt;/<span class="keywordtype">mean</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">stddev</span>&gt;0.1&lt;/<span class="keywordtype">stddev</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">noise</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">gz:odometer</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">sensor</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="sensor-implementation"></a>
Sensor implementation</h3>
<p>The sensor consists of a class, <code>Odometer</code>, which inherits from <code><a class="el" href="classgz_1_1sensors_1_1Sensor.html" title="a base sensor class">gz::sensors::Sensor</a></code>.</p>
<p>Take a look at <a href="https://github.com/gazebosim/gz-sensors/tree/gz-sensors10/examples/custom_sensor">gz-sensors/examples/custom_sensor</a> for the full code. Here are some important pointers:</p>
<ul>
<li>Be sure to link your sensor to Gazebo Sensors</li>
<li>Implement all pure abstraction functions, like <code>Update</code></li>
<li>Be sure to implement at least one of the <code>Load</code> functions so the sensor can be initialized</li>
<li>Don't forget to call <code>Sensor::Load</code> to load common sensor properties</li>
<li>It's recommended that the sensor publishes its data using Gazebo Transport</li>
</ul>
<p>You may choose to compile your sensor as a shared library, or to embed it directly into other application code.</p>
<h3><a class="anchor" id="loading-into-gazebo"></a>
Loading into Gazebo</h3>
<p>In order to use the sensor on Gazebo, one needs to write a system plugin that instantiates the sensor and updates it periodically with data from simulation.</p>
<p>Take a look at <a href="https://github.com/gazebosim/gz-sim/tree/gz-sensors10/examples/plugin/custom_sensor_system">gz-sim/examples/plugins/custom_sensor_system</a>. for the full code. Here are some important pointers:</p>
<ul>
<li>Check for new entities that have <code>gz::sim::components::CustomSensor</code> during the <code>PreUpdate</code> callback and instantiate new sensors as they appear in simulation.</li>
<li>Don't assume all <code>CustomSensors</code> are of the type you need, be sure to check the type using the <code><a class="el" href="namespacegz_1_1sensors.html#ad31c5a18762dc8b8784ce5754495c04a" title="Get the name of a sensor&#39;s custom type from SDF.">gz::sensors::customType</a></code> function.</li>
<li>During <code>PostUpdate</code>, update all sensors with new data coming from simulation.</li>
<li>Also during <code>PostUpdate</code>, delete any sensors that have been removed from simulation. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
