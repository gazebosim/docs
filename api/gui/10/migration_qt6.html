<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Gui">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Gui: Migrating Qt5 GUI plugins to Qt6</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Gui</h1>
        <h2>API Reference</h2>
        <div class="version">
        10.0.0~pre2
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Migrating Qt5 GUI plugins to Qt6</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Prerequisite Tutorial: <a class="el" href="plugins.html">Plugins</a></p>
<h2><a class="anchor" id="overview-5"></a>
Overview</h2>
<p>Qt5 is planned to be removed in Ubuntu 26.04 LTS. In response to this, Gazebo GUI has upgraded its GUI framework from Qt5 to Qt6 in <code>gz-gui10</code> (Gazebo Jetty). This directly impacts all users who have developed their own custom Gazebo GUI plugins in Qt5.</p>
<p>This tutorial will highlight important changes that users need to make to migrate their existing Qt5 Gazebo GUI plugins to Qt6.</p>
<p>A Gazebo GUI is made up of C++, QML code, and configuration file, see the <a class="el" href="plugins.html">Plugins</a> tutorial for more information. We expect that most of the required changes for porting to Qt6 will be in the QML code.</p>
<h2><a class="anchor" id="qml-and-c-integration"></a>
QML and C++ Integration</h2>
<p>In a Gazebo GUI plugin, users can create a QML interface that invokes C++ functionality and vice versa. There is one major syntax change to how this should be done from <code>gz-gui10</code> onwards. Prior to <code>gz-gui10</code>, access to C++ functions or properties was done with the following syntax in QML:</p>
<div class="fragment"><div class="line">MyClass.FunctionFoo()</div>
</div><!-- fragment --><p>The new syntax for doing this in Qt6 based Gazebo GUI plugin is:</p>
<div class="fragment"><div class="line">_MyClass.FunctionFoo()</div>
</div><!-- fragment --><p>As an example, in the Qt5 based <code>Screenshot</code> GUI plugin's QML code, we call <a href="https://github.com/gazebosim/gz-gui/blob/e0c95585919d95a01fbf3af9a33c7fcd653ab154/src/plugins/screenshot/Screenshot.qml#L50">Screenshot.OnScreenshot()</a> which inovkes the corresponding <a href="https://github.com/gazebosim/gz-gui/blob/e0c95585919d95a01fbf3af9a33c7fcd653ab154/src/plugins/screenshot/Screenshot.cc#L188">C++ function</a> defined in the <code>Screenshot</code> C++ class.</p>
<p>In the Qt6 based Gazebo GUI plugin, the code is changed to <a href="https://github.com/gazebosim/gz-gui/blob/c7093159ac92031350cdf2c31283e3fdfd944194/src/plugins/screenshot/Screenshot.qml#L50">_Screenshot.OnScreeShot()</a> for the QML and C++ binding to work correctly.</p>
<p>This is mainly because Qt6 enforces stricter property rules and that property names should not begin with an upper case letter. Gazebo adds an underscore prefix to workaround this problem. No changes should be needed on the C++ end.</p>
<blockquote class="doxtable">
<p>&zwj;Note: An alternative approach would be to choose a name that starts with a lower case letter, i.e. <code>myClass.FunctionFoo()</code>. However, it was noted that in many cases there exists an QML object with the id <code>myClass</code> already which would conflict with the name of the C++ object. For example, the Screenshot GUI plugin has a tool button with the id: <a href="https://github.com/gazebosim/gz-gui/blob/c7093159ac92031350cdf2c31283e3fdfd944194/src/plugins/screenshot/Screenshot.qml#L37">screenshot</a>. Hence a decision was made to add the <code>_</code> prefix to avoid any potential naming conflicts. </p>
</blockquote>
<h2><a class="anchor" id="qml-migration"></a>
QML Migration</h2>
<p>Gazebo gives users the freedom to import any QML modules in their QML code and create their UI in a way that is no different from writing other <a class="elRef" href="https://doc.qt.io/qt-6/qt.html">Qt</a> programs. So users would need to follow the general <a href="https://doc.qt.io/qt-6/portingguide.html">porting guide</a>, paying attention to the QML and module changes. Some QML modules and types are obsolete while some QML types have significant syntax changes.</p>
<p>Common changes for porting Qt5 QML code to Qt6 include:</p><ul>
<li>Importing a newer version of the <a class="elRef" href="https://doc.qt.io/qt-6/qt.html">Qt</a> module, which can be done by removing the version number, e.g. <code>import QtQuick.Dialogs 1.0</code> becomes <code>import QtQuick.Dialogs</code>.</li>
<li>Adding the <code>_</code> prefix to the C++ object name as described in the <code>QML and C++ Integration</code> section above.</li>
<li>QML types requiring more code changes include but not limited to: <a href="https://doc.qt.io/qt-6/qml-qtquick-dialogs-filedialog.html">FileDialog</a> and <a href="https://doc.qt.io/qt-6/qml-qtquick-treeview.html">TreeView</a>.<ul>
<li>This <a href="https://github.com/gazebosim/gz-sim/pull/2832/files#diff-a93324029765acbdf791f6e6ed06b1ea2e2886a756f949e7948f7824a57b4e7b">Qt6 migration pull request</a> shows examples of porting various Qt5 Gazebo GUI plugins to Qt6.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="qt-app-and-event-loop"></a>
Qt App and Event Loop</h2>
<p>The core of Gazebo GUI sets up the necessary code for running an <a class="elRef" href="https://doc.qt.io/qt-6/qt.html">Qt</a> application and its event loop. Here are some related migration notes:</p>
<ul>
<li>The main C++ API in Gazebo GUI for retrieving the running <a class="elRef" href="https://doc.qt.io/qt-6/qt.html">Qt</a> Application is <a href="https://github.com/gazebosim/gz-gui/blob/e0c95585919d95a01fbf3af9a33c7fcd653ab154/include/gz/gui/Application.hh#L224">App()</a> which essentially returns a <a href="https://doc.qt.io/qt-6/qguiapplication.html#qGuiApp">qGuiApp</a> pointer. This pointer is no longer always guaranteed to be non-null. Users should check this pointer to make sure it is valid before using it.</li>
<li>Users are discouraged from calling <a href="https://doc.qt.io/qt-6/qcoreapplication.html#processEvents">QCoreApplication::processEvents</a> manually in Qt6. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
