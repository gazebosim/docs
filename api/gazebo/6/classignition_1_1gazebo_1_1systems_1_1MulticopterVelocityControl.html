<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Gazebo">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Gazebo: MulticopterVelocityControl Class Reference</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Gazebo</h1>
        <h2>API Reference</h2>
        <div class="version">
        6.16.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 IgnCreateDocs.cmake -->
      <nav class="ign-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.8.17 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceignition.html">ignition</a></li><li class="navelem"><a class="el" href="namespaceignition_1_1gazebo.html">gazebo</a></li><li class="navelem"><a class="el" href="namespaceignition_1_1gazebo_1_1systems.html">systems</a></li><li class="navelem"><a class="el" href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html">MulticopterVelocityControl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl-members.html">List of all members</a> &#124;
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">MulticopterVelocityControl Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This is a velocity controller for multicopters that allows control over the linear velocity and the yaw angular velocity of the vehicle. The velocities are expressed in the body frame of the vehicle. A vehicle with at least 4 rotors is required for the controller to function.  
 <a href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="MulticopterVelocityControl_8hh_source.html">MulticopterVelocityControl.hh</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac3977fcfaadf9d424f6216e6e9a7e14d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html#ac3977fcfaadf9d424f6216e6e9a7e14d">MulticopterVelocityControl</a> ()=default</td></tr>
<tr class="memdesc:ac3977fcfaadf9d424f6216e6e9a7e14d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html#ac3977fcfaadf9d424f6216e6e9a7e14d">More...</a><br /></td></tr>
<tr class="separator:ac3977fcfaadf9d424f6216e6e9a7e14d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58c66c8c1c48cd5fe04132bbf1343abe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html#a58c66c8c1c48cd5fe04132bbf1343abe">Configure</a> (const <a class="el" href="namespaceignition_1_1gazebo.html#ad83694d867b0e3a9446b535b5dfd208d">Entity</a> &amp;_entity, const <a class="elRef" href="http://en.cppreference.com/w/cpp/memory/shared_ptr.html">std::shared_ptr</a>&lt; const sdf::Element &gt; &amp;_sdf, <a class="el" href="classignition_1_1gazebo_1_1EntityComponentManager.html">EntityComponentManager</a> &amp;_ecm, <a class="el" href="classignition_1_1gazebo_1_1EventManager.html">EventManager</a> &amp;_eventMgr) override</td></tr>
<tr class="memdesc:a58c66c8c1c48cd5fe04132bbf1343abe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure the system.  <a href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html#a58c66c8c1c48cd5fe04132bbf1343abe">More...</a><br /></td></tr>
<tr class="separator:a58c66c8c1c48cd5fe04132bbf1343abe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32ad88d23ecabef5998134e63257ff0c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html#a32ad88d23ecabef5998134e63257ff0c">PreUpdate</a> (const <a class="el" href="structignition_1_1gazebo_1_1UpdateInfo.html">gz::sim::UpdateInfo</a> &amp;_info, <a class="el" href="classignition_1_1gazebo_1_1EntityComponentManager.html">gz::sim::EntityComponentManager</a> &amp;_ecm) override</td></tr>
<tr class="separator:a32ad88d23ecabef5998134e63257ff0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classignition_1_1gazebo_1_1System"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classignition_1_1gazebo_1_1System')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classignition_1_1gazebo_1_1System.html">System</a></td></tr>
<tr class="memitem:aad5da93cf8921039ac524abb10ad4254 inherit pub_methods_classignition_1_1gazebo_1_1System"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classignition_1_1gazebo_1_1System.html#aad5da93cf8921039ac524abb10ad4254">System</a> ()=default</td></tr>
<tr class="memdesc:aad5da93cf8921039ac524abb10ad4254 inherit pub_methods_classignition_1_1gazebo_1_1System"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classignition_1_1gazebo_1_1System.html#aad5da93cf8921039ac524abb10ad4254">More...</a><br /></td></tr>
<tr class="separator:aad5da93cf8921039ac524abb10ad4254 inherit pub_methods_classignition_1_1gazebo_1_1System"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75d73261228a8127f188edb3aa46fc21 inherit pub_methods_classignition_1_1gazebo_1_1System"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classignition_1_1gazebo_1_1System.html#a75d73261228a8127f188edb3aa46fc21">~System</a> ()=default</td></tr>
<tr class="memdesc:a75d73261228a8127f188edb3aa46fc21 inherit pub_methods_classignition_1_1gazebo_1_1System"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="classignition_1_1gazebo_1_1System.html#a75d73261228a8127f188edb3aa46fc21">More...</a><br /></td></tr>
<tr class="separator:a75d73261228a8127f188edb3aa46fc21 inherit pub_methods_classignition_1_1gazebo_1_1System"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is a velocity controller for multicopters that allows control over the linear velocity and the yaw angular velocity of the vehicle. The velocities are expressed in the body frame of the vehicle. A vehicle with at least 4 rotors is required for the controller to function. </p>
<p>Note that this system only computes the necessary rotor velocities and updates the Actuators component on the model entity. To actually convert these velocities to thrust, this system requires the <a class="el" href="classignition_1_1gazebo_1_1systems_1_1MulticopterMotorModel.html" title="This system applies a thrust force to models with spinning propellers. See examples/worlds/quadcopter...">MulticopterMotorModel</a> system on each rotor. Note also that only one <a class="el" href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html" title="This is a velocity controller for multicopters that allows control over the linear velocity and the y...">MulticopterVelocityControl</a> system is allowed per model.</p>
<p>This system is inspired by the LeePositionController from RotorS <a href="https://github.com/ethz-asl/rotors_simulator/blob/master/rotors_control/include/rotors_control/lee_position_controller.h">https://github.com/ethz-asl/rotors_simulator/blob/master/rotors_control/include/rotors_control/lee_position_controller.h</a> Instead of subscribing to odometry messages, this system uses ground truth values of orientation, linear velocity and angular velocity from simulation. As such it is not designed to work with user supplied state estimators. Instead, the system allows noise to be added to velocity values to simulate the behavior of state estimators.</p>
<p>Main differences/additions include:</p><ul>
<li>Only controls velocity. Velocity estimates are obtained from simulation ground truth, but noise can be added to simulate realistic estimators.</li>
<li>Automatic calculation of rotor angle and arm length</li>
<li>Automatic calculation of vehicle mass and inertia</li>
<li>Handling of non-orthogonal rotor axis</li>
<li>Maximum acceleration limit</li>
<li>Can be enabled/disabled at runtime.</li>
</ul>
<h1><a class="anchor" id="autotoc_md345"></a>
Parameters</h1>
<p>The following parameters are used by the system</p>
<p>robotNamespace: All ign-transport topics subscribed to and published by the system will be prefixed by this string. This is a required parameter.</p>
<p>commandSubTopic: The system subscribes to this topic to receive twist commands. The default value is "cmd_vel".</p>
<p>enableSubTopic: Topic to enable or disable the system. If false, the controller sends a zero rotor velocity command once and gets disabled. If the vehicle is in the air, disabling the controller will cause it to fall. If true, the controller becomes enabled and waits for a twist message. The default value is "enable".</p>
<p>comLinkName: The link associated with the center of mass of the vehicle. That is, the origin of the center of mass may not be on this link, but this link and the center of mass frame have a fixed transform. Almost always this should be the base_link of the vehicle. This is a required parameter.</p>
<p>velocityGain (x, y, z): Proportional gain on linear velocity. attitudeGain (roll, pitch, yaw): Proportional gain on attitude. This parameter is scaled by the inverse of the inertia matrix so two vehicles with different inertial characteristics may have the same gain if other parameters, such as the forceConstant, are kept the same. This is a required parameter.</p>
<p>angularRateGain (roll, pitch, yaw): Proportional gain on angular velocity. Even though only the yaw angle velocity is controlled, proper gain values for roll and pitch velocities must be specified. This parameter is scaled by the inverse of the inertia matrix so two vehicles with different inertial characteristics may have the same gain if other parameters, such as the forceConstant, are kept the same. This is a required parameter.</p>
<p>maxLinearAcceleration (x, y, z): Maximum limit on linear acceleration. The default value is DBL_MAX.</p>
<p>maximumLinearVelocity (x, y, z): Maximum commanded linear velocity. The default value is DBL_MAX. maximumAngularVelocity (roll, pitch, yaw): Maximum commanded angular velocity. The default value is DBL_MAX.</p>
<p>linearVelocityNoiseMean (x, y, z): Mean of Gaussian noise on linear velocity values obtained from simulation. The default value is (0, 0, 0).</p>
<p>linearVelocityNoiseStdDev (x, y, z): Standard deviation of Gaussian noise on linear values obtained from simulation. A value of 0 implies noise is NOT applied to the component. The default value is (0, 0, 0).</p>
<p>angularVelocityNoiseMean (roll, pitch, yaw): Mean of Gaussian noise on angular velocity values obtained from simulation. The default value is (0, 0, 0).</p>
<p>angularVelocityNoiseStdDev (roll, pitch, yaw): Standard deviation of gaussian noise on angular velocity values obtained from simulation. A value of 0 implies noise is NOT applied to the component. The default value is (0, 0, 0).</p>
<p>rotorConfiguration: This contains a list of <code>&lt;rotor&gt;</code> elements for each rotor in the vehicle. This is a required parameter.</p>
<p>rotor: Contains information about a rotor in the vehicle. All the elements of <code>&lt;rotor&gt;</code> are required parameters.</p>
<p>jointName: The name of the joint associated with this rotor.</p>
<p>forceConstant: A constant that multiplies with the square of the rotor's velocity to compute its thrust.</p>
<p>momentConstant: A constant the multiplies with the rotor's thrust to compute its moment.</p>
<p>direction: Direction of rotation of the rotor. +1 is counterclockwise and -1 is clockwise.</p>
<h1><a class="anchor" id="autotoc_md346"></a>
Examples</h1>
<p>See examples/worlds/quadcopter.sdf for a demonstration. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac3977fcfaadf9d424f6216e6e9a7e14d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3977fcfaadf9d424f6216e6e9a7e14d">&#9670;&nbsp;</a></span>MulticopterVelocityControl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classignition_1_1gazebo_1_1systems_1_1MulticopterVelocityControl.html">MulticopterVelocityControl</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a58c66c8c1c48cd5fe04132bbf1343abe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58c66c8c1c48cd5fe04132bbf1343abe">&#9670;&nbsp;</a></span>Configure()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Configure </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespaceignition_1_1gazebo.html#ad83694d867b0e3a9446b535b5dfd208d">Entity</a> &amp;&#160;</td>
          <td class="paramname"><em>_entity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="http://en.cppreference.com/w/cpp/memory/shared_ptr.html">std::shared_ptr</a>&lt; const sdf::Element &gt; &amp;&#160;</td>
          <td class="paramname"><em>_sdf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classignition_1_1gazebo_1_1EntityComponentManager.html">EntityComponentManager</a> &amp;&#160;</td>
          <td class="paramname"><em>_ecm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classignition_1_1gazebo_1_1EventManager.html">EventManager</a> &amp;&#160;</td>
          <td class="paramname"><em>_eventMgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configure the system. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">_entity</td><td>The entity this plugin is attached to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_sdf</td><td>The SDF Element associated with this system plugin. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_ecm</td><td>The <a class="el" href="classignition_1_1gazebo_1_1EntityComponentManager.html" title="The EntityComponentManager constructs, deletes, and returns components and entities....">EntityComponentManager</a> of the given simulation instance. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_eventMgr</td><td>The <a class="el" href="classignition_1_1gazebo_1_1EventManager.html" title="The EventManager is used to send/receive notifications of simulator events.">EventManager</a> of the given simulation instance. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classignition_1_1gazebo_1_1ISystemConfigure.html#ac5fc9ce04c3166a5322016b5f2d303e0">ISystemConfigure</a>.</p>

</div>
</div>
<a id="a32ad88d23ecabef5998134e63257ff0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32ad88d23ecabef5998134e63257ff0c">&#9670;&nbsp;</a></span>PreUpdate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PreUpdate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structignition_1_1gazebo_1_1UpdateInfo.html">gz::sim::UpdateInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classignition_1_1gazebo_1_1EntityComponentManager.html">gz::sim::EntityComponentManager</a> &amp;&#160;</td>
          <td class="paramname"><em>_ecm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classignition_1_1gazebo_1_1ISystemPreUpdate.html#a760b8673aaf01408786c9ececb8ba520">ISystemPreUpdate</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="MulticopterVelocityControl_8hh_source.html">MulticopterVelocityControl.hh</a></li>
</ul>
</div><!-- contents -->
      </div>
    </main>
  </div>
</body>
