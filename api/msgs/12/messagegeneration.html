<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Msgs">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Msgs: Message Generation</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Msgs</h1>
        <h2>API Reference</h2>
        <div class="version">
        12.0.0~pre2
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Message Generation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="overview-1"></a>
Overview</h2>
<p>This tutorial describes how Gazebo messages are generated and you can create custom messages that can be used with the simulator and command line tools.</p>
<p>Gazebo messages use <a href="https://protobuf.dev">Protobuf</a> to define the structures that can be easily serialized for use in communication through the Gazebo software stack. Protobuf is a language-neutral framework for serializing structured data, with the advantage of generating native language bindings so that messages are easily used from your language of choice.</p>
<h2><a class="anchor" id="message-definitions"></a>
Message Definitions</h2>
<h3><a class="anchor" id="file-structure"></a>
File structure</h3>
<p>Gazebo message definitions are stored in the <a href="https://github.com/gazebosim/gz-msgs/tree/main/proto">proto</a> folder.</p>
<p>Messages may additionally belong to a <code>package</code>, which allows for convenient namespacing or grouping of common messages. Currently, all <code>gz-msgs</code> definitions reside in the <code><a class="el" href="namespacegz_1_1msgs.html">gz.msgs</a></code> package, which generates the corresponding <code><a class="el" href="namespacegz_1_1msgs.html">gz::msgs</a></code> namespace in C++ and <code>gzâ€¤msgs</code> in Python.</p>
<h3><a class="anchor" id="proto-files"></a>
Proto files</h3>
<p>Messages are defined in files with the extension <code>.proto</code>.</p>
<p>The definitions use the <code>proto</code> language, which has two major version, of which Gazebo uses the <code>proto3</code> version.</p>
<p>The full language guide for the <code>proto</code> language is available <a href="https://protobuf.dev/programming-guides/proto3/">here</a></p>
<p>A typical message definition looks something like this:</p>
<div class="fragment"><div class="line">/// First non-comment line must define using the proto3 syntax.</div>
<div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line"> </div>
<div class="line">/// Define the package name we are using</div>
<div class="line">package gz.msgs;</div>
<div class="line"> </div>
<div class="line">/// Import common message definitions</div>
<div class="line">import &quot;gz/msgs/header.proto&quot;;</div>
<div class="line">import &quot;gz/msgs/vector3d.proto&quot;;</div>
<div class="line"> </div>
<div class="line">message FooMessage</div>
<div class="line">{</div>
<div class="line">    /// Message header data (timestamp)</div>
<div class="line">    /// Since this definition is also in gz.msgs, the fully-qualified</div>
<div class="line">    /// name isn&#39;t necessary here, but left in for explicitness.</div>
<div class="line">    gz.msgs.Header header = 1;</div>
<div class="line"> </div>
<div class="line">    /// Define a field using one of the protobuf scalar types</div>
<div class="line">    string name = 2;</div>
<div class="line"> </div>
<div class="line">    /// Define a field using on the Gazebo message types</div>
<div class="line">    gz.msgs.Vector3d position = 3;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that each field has a corresponding <em>field number</em>. Each field must be given an ID between <code>1</code> and <code>536,870,911</code>, with the following restrictions (from the <a href="https://protobuf.dev/programming-guides/proto3/#assigning">language guide</a>):</p>
<ul>
<li>The given number must be unique among all fields for that message.</li>
<li>Field numbers <code>19,000</code> to <code>19,999</code> are reserved for the Protocol Buffers implementation. The protocol buffer compiler will complain if you use one of these reserved field numbers in your message.</li>
<li>You cannot use any previously reserved field numbers or any field numbers that have been allocated to extensions.</li>
</ul>
<h2><a class="anchor" id="the-message-generation-pipeline"></a>
The Message Generation Pipeline</h2>
<p>Once the proto messages have been defined, there are several steps that take place to make the messages usable across the Gazebo stack.</p>
<p>To begin with, each message definition is passed through the <code>gz_msgs_protoc</code> function:</p>
<div class="image">
<object type="image/svg+xml" data="gz_msgs_protoc.svg" style="pointer-events: none;"></object>
</div>
<p>For each file:</p>
<ul>
<li><code>gz_msgs_protoc</code> accepts the arguments necessary to find all the supporting scripts and executables:<ul>
<li><code>gz_msgs_generate.py</code> - Top-level python script entrypoint for generating messages.</li>
<li><code>protoc</code> - The protobuf compiler</li>
<li><code>gz-msgs-protoc-compiler</code> - The Gazebo messages extension compiler.</li>
</ul>
</li>
<li>The protobuf compiler generates <code>.pb.c</code> , <code>.pb.h</code>, and <code>_pb2.py</code> file for each message found in the <code>.proto</code> file.</li>
<li>The generation python script moves the generated <code>.pb.h</code> file into a <code>details/</code> directory to hide some of the protobuf implementation from downstream users.</li>
<li>The <code>gz-msgs-protoc-compiler</code> generates a new <code>.pb.h</code> file with Gazebo-specific definitions</li>
<li><code>gz_msgs_generate.py</code> additionally generates a <code>.pbindex</code> file to be used by later steps in the process.</li>
</ul>
<p>After individual message files have been generated, all of the definitions are grouped and processed via <code>gz_msgs_factory</code></p>
<div class="image">
<object type="image/svg+xml" data="gz_msgs_factory.svg" style="pointer-events: none;"></object>
</div>
<p>For the collection, <code>gz_msgs_factory</code> generates:</p>
<ul>
<li>A <code>register.cc</code> file that can be used to statically register all of the messages passed as arguments.</li>
<li>A <code>MessageTypes.hh</code> file that enumerates all messages available in the collection.</li>
<li>A <code>.gz_desc</code> file that allows the messages to be dynamically loaded by the various Gazebo tools.</li>
</ul>
<h2><a class="anchor" id="custom-message-generation"></a>
Custom Message Generation</h2>
<p>Now that we understand the components of the message generation pipeline, we can use them in our own custom package.</p>
<p>The code for this example can be found in the <code>gz-msgs</code> <a href="https://github.com/gazebosim/gz-msgs/tree/main">repository</a>, in the <a href="https://github.com/gazebosim/gz-msgs/tree/main/examples/generating_custom_msgs"><code>examples/generating_custom_msgs</code></a> folder.</p>
<p>The <code>cmake</code> functionality is exported from the <code>gz-msgs</code> library, via the <code>gz-cmake</code> <a href="https://github.com/gazebosim/gz-cmake/pull/345"><code>extras</code> functionality</a>. To make the functions available, simply <code>find_package(gz-msgs)</code> in your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.22.1 FATAL_ERROR)</div>
<div class="line">project(my_custom_package VERSION 0.0.1)</div>
<div class="line">find_package(gz-cmake REQUIRED)</div>
<div class="line">find_package(gz-msgs REQUIRED)</div>
</div><!-- fragment --><p>Next, create a directory for your custom message definitions:</p>
<div class="fragment"><div class="line">mkdir -p proto/gz/custom_msgs</div>
<div class="line">touch proto/gz/custom_msgs/foo.proto</div>
<div class="line">touch proto/gz/custom_msgs/bar.proto</div>
<div class="line">touch proto/gz/custom_msgs/baz.proto</div>
</div><!-- fragment --><p>Give the message files some content:</p>
<p><code>proto/gz/custom_msgs/foo.proto</code>:</p>
<div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line">package gz.custom_msgs;</div>
<div class="line"> </div>
<div class="line">message Foo</div>
<div class="line">{</div>
<div class="line">  double value = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>proto/gz/custom_msgs/bar.proto</code>:</p>
<div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line">package gz.custom_msgs;</div>
<div class="line"> </div>
<div class="line">message Bar</div>
<div class="line">{</div>
<div class="line">  double value = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>proto/gz/custom_msgs/baz.proto</code>:</p>
<div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line">package gz.custom_msgs;</div>
<div class="line"> </div>
<div class="line">import &quot;gz/msgs/header.proto&quot;;</div>
<div class="line"> </div>
<div class="line">import &quot;gz/custom_msgs/foo.proto&quot;;</div>
<div class="line">import &quot;gz/custom_msgs/bar.proto&quot;;</div>
<div class="line"> </div>
<div class="line">message Baz</div>
<div class="line">{</div>
<div class="line">  gz.custom_msgs.Foo foo = 1;</div>
<div class="line">  gz.custom_msgs.Bar bar = 2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">message BazStamped</div>
<div class="line">{</div>
<div class="line">  gz.msgs.Header header = 1;</div>
<div class="line">  gz.custom_msgs.Baz baz = 2;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Then, back in the <code>CMakeLists.txt</code> file, add following lines to generate the message library:</p>
<div class="fragment"><div class="line"># Define a variable &#39;MSGS_PROTOS&#39; listing the .proto files</div>
<div class="line">set(MSGS_PROTOS</div>
<div class="line">     ${CMAKE_CURRENT_SOURCE_DIR}/proto/gz/custom_msgs/foo.proto</div>
<div class="line">     ${CMAKE_CURRENT_SOURCE_DIR}/proto/gz/custom_msgs/bar.proto</div>
<div class="line">     ${CMAKE_CURRENT_SOURCE_DIR}/proto/gz/custom_msgs/baz.proto</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># Call &#39;gz_msgs_generate_messages()&#39; to process the .proto files</div>
<div class="line">gz_msgs_generate_messages(</div>
<div class="line">  # The cmake target to be generated for libraries/executables to link</div>
<div class="line">  TARGET msgs</div>
<div class="line">  # The protobuf package to generate (Typically based on the path)</div>
<div class="line">  PROTO_PACKAGE &quot;gz.custom_msgs&quot;</div>
<div class="line">  # The path to the base directory of the proto files</div>
<div class="line">  # All import paths should be relative to this (eg gz/custom_msgs/vector3d.proto)</div>
<div class="line">  MSGS_PATH ${CMAKE_CURRENT_SOURCE_DIR}/proto</div>
<div class="line">  # List of proto files to process</div>
<div class="line">  MSGS_PROTOS ${MSGS_PROTOS}</div>
<div class="line">  # Dependency on gz-msgs</div>
<div class="line">  DEPENDENCIES gz-msgs::gz-msgs</div>
<div class="line">)</div>
</div><!-- fragment --><p>In order to reduce the amount of edits needed upon a version change of <code>gz-msgs</code>, it is common to:</p>
<ul>
<li>Define a variable <code>GZ_MSGS_VER</code>, holding the version number: <div class="fragment"><div class="line">find_package(gz-msgs REQUIRED)</div>
</div><!-- fragment --></li>
<li>And change the dependency line in above code block to: <div class="fragment"><div class="line">DEPENDENCIES gz-msgs::gz-msgs</div>
</div><!-- fragment --></li>
</ul>
<h3><a class="anchor" id="using-custom-messages"></a>
Using Custom messages</h3>
<p>There are two primary ways that Gazebo messages are used as part of an application. Messages are either known at compile time and linked into the application, or they are loaded dynamically at runtime.</p>
<h4><a class="anchor" id="compile-time-message-use"></a>
Compile time message use</h4>
<p>When messages are known at compile-time, they can be directly used. This allow for the messages to be used without any sort of reflection/introspection.</p>
<p>Include the headers and interact with the messages using the generated bindings according to the <a href="https://protobuf.dev/reference/cpp/cpp-generated/">language guide</a></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;gz/custom_msgs/baz.pb.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  gz::custom_msgs::BazStamped msg;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// msg has header and baz field</span></div>
<div class="line">  <span class="keyword">auto</span> *header = msg.mutable_header();</div>
<div class="line">  <span class="keyword">auto</span> *baz = msg.mutable_baz();</div>
<div class="line">}</div>
</div><!-- fragment --><p>The corresponding CMake for this:</p>
<div class="fragment"><div class="line">add_executable(${PROJECT_NAME} main.cc)</div>
<div class="line">target_link_libraries(${PROJECT_NAME} PUBLIC ${PROJECT_NAME}-msgs)</div>
</div><!-- fragment --><h4><a class="anchor" id="run-time-message-use"></a>
Run time message use</h4>
<p>Alternatively, there may be cases where all message definitions are not known at the time that the executable/library of interest is being built. A common case for this is with command line tools, where only a limited set of messages are available at the time the tool is built, and more user-defined messages are generated later.</p>
<p>For example, when custom messages are generated, they aren't initially visible to the <code>gz msgs</code> or <code>gz topic</code> command line tools:</p>
<div class="fragment"><div class="line">$ gz msg -l | grep &quot;custom_msgs&quot; | wc -l</div>
<div class="line">0</div>
<div class="line"> </div>
<div class="line">$ gz topic -t /foo -m gz.custom_msgs.Foo -p &#39;value: 1.0&#39;</div>
<div class="line">Unable to create message of type[gz.custom_msgs.Foo] with data[value: 1.0].</div>
</div><!-- fragment --><p>To use the new messages, point the <code>GZ_DESCRIPTOR_PATH</code> environment variable to the location of the <code>build</code> folder or where you have chosen to install the <code>.gz_desc</code> file:</p>
<div class="fragment"><div class="line">$ cd build/</div>
<div class="line"> </div>
<div class="line">$ export GZ_DESCRIPTOR_PATH=`pwd`</div>
<div class="line"> </div>
<div class="line">$ gz msg -l | grep &quot;custom_msgs&quot; | wc -l</div>
<div class="line">4</div>
<div class="line"> </div>
<div class="line">$ gz msg --info gz.custom_msgs.Foo</div>
<div class="line">Name: gz.custom_msgs.Foo</div>
<div class="line">File: gz/custom_msgs/foo.proto</div>
<div class="line"> </div>
<div class="line">message Foo {</div>
<div class="line">  double value = 1 [json_name = &quot;value&quot;];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">$ gz topic -t /foo -m gz.custom_msgs.Foo -p &#39;value: 1.0&#39;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
