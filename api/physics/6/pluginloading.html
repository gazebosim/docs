<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Physics">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Physics: Plugin Loading</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Physics</h1>
        <h2>API Reference</h2>
        <div class="version">
        6.6.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin Loading </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial shows how to create an executable that loads physics engine plugins on Ubuntu, according to the desired feature list.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Overview</h2>
<p>Physics Plugin integrates external physics engines into the Gazebo Physics. It allows users to select from multiple supported physics engines based on their simulation needs. This tutorial will describe how to load a compiled physics plugin using <a class="el" href="namespacegz_1_1physics.html">Gazebo Physics</a> API.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Prerequisites</h2>
<ul>
<li><a class="el" href="installation.html">Installation</a></li>
<li><a class="el" href="physicsplugin.html">Understanding the physics plugin</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md36"></a>
Write a simple loader</h2>
<p>We will use a simplified physics plugin example for this tutorial. Source code can be found at <a href="https://github.com/gazebosim/gz-physics/tree/main/examples/hello_world_loader">gz-physics/examples</a> folder.</p>
<p>First, create a workspace for the example plugin loader.</p>
<div class="fragment"><div class="line">cd ~</div>
<div class="line">mkdir -p ~/hello_world_loader/build</div>
<div class="line">cd hello_world_loader</div>
</div><!-- fragment --><p>Then download the example loader into your current directory by:</p>
<div class="fragment"><div class="line">wget https://raw.githubusercontent.com/gazebosim/gz-physics/main/examples/hello_world_loader/hello_world_loader.cc</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md37"></a>
Examine the code</h3>
<p>At the top of the file <code>hello_world_loader.cc</code>, we include the headers that will be used in our code. After the <code>std</code> C++ libraries are the <code>Loader.hh</code> and <code><a class="elRef" href="https://gazebosim.org/api/common/5/PluginPtr_8hh.html">PluginPtr.hh</a></code>, which provides main functionalities for loading physics plugins and plugin pointers. Next includes from <a class="el" href="namespacegz_1_1physics.html">gz::physics</a> are the tools for retrieving <a class="el" href="classgz_1_1physics_1_1Feature.html">Feature</a> and <a class="el" href="classgz_1_1physics_1_1Entity.html">Entity</a> from physics plugins (please refer to <a class="el" href="physicsplugin.html">Understanding the physics plugin</a> tutorial for their design concepts).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;gz/plugin/Loader.hh&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gz/plugin/PluginPtr.hh&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gz_2physics_2FindFeatures_8hh.html">gz/physics/FindFeatures.hh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gz_2physics_2GetEntities_8hh.html">gz/physics/GetEntities.hh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gz_2physics_2RequestEngine_8hh.html">gz/physics/RequestEngine.hh</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The features that an engine must have to be loaded by this loader.</span></div>
<div class="line"><span class="keyword">using</span> Features = <a class="code" href="structgz_1_1physics_1_1FeatureList.html" title="Use a FeatureList to aggregate a list of Features.">gz::physics::FeatureList</a>&lt;</div>
<div class="line">    <a class="code" href="classgz_1_1physics_1_1GetEngineInfo.html" title="This feature retrieves the physics engine name in use.">gz::physics::GetEngineInfo</a></div>
<div class="line">&gt;;</div>
</div><!-- fragment --><p> Next, in the main function, the loader requires users to provide a path for desired plugins to be loaded. The plugin names are retrieved by <a class="elRef" href="https://gazebosim.org/api/plugin/2/classgz_1_1plugin_1_1Loader.html#a78b2ddd492810b5120ad19bc708aa137">gz::plugin::Loader::LoadLib</a> member function.</p>
<p>Assuming the correct path, our loader will instantiate all plugins that are available in the path using <a class="elRef" href="https://gazebosim.org/api/plugin/2/classgz_1_1plugin_1_1Loader.html#a38af38708f58ad09a98603ed08fdb33c">gz::plugin::Loader::Instantiate</a> member function. Then for each instantiated plugin, using <a class="el" href="structgz_1_1physics_1_1RequestEngine.html#aa04799d42bf6171a8e5cb7e83c631aaa">gz::physics::RequestEngine3d&lt;Features&gt;::From</a>, it will request an engine implementing a <a class="el" href="structgz_1_1physics_1_1FeaturePolicy.html">FeaturePolicy</a> (3D in this case).</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// User should provide path to plugin library</span></div>
<div class="line">  <span class="keywordflow">if</span> (argc &lt;= 1)</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Please provide the path to an engine plugin.&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html" title="STL class.">std::string</a> pluginPath = argv[1];</div>
<div class="line"> </div>
<div class="line">  <a class="codeRef" href="https://gazebosim.org/api/plugin/2/classgz_1_1plugin_1_1Loader.html">gz::plugin::Loader</a> pl;</div>
<div class="line">  <span class="keyword">auto</span> plugins = pl.<a class="codeRef" href="https://gazebosim.org/api/plugin/2/classgz_1_1plugin_1_1Loader.html#a78b2ddd492810b5120ad19bc708aa137">LoadLib</a>(pluginPath);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Look for 3d plugins</span></div>
<div class="line">  <span class="keyword">auto</span> pluginNames = <a class="code" href="structgz_1_1physics_1_1FindFeatures.html#a72938250a7a22eeffc208c870a5f7bf5" title="Find a set of plugins that satisfy the requested list of features.">gz::physics::FindFeatures3d&lt;Features&gt;::From</a>(pl);</div>
<div class="line">  <span class="keywordflow">if</span> (pluginNames.empty())</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;No plugins with required features found in &quot;</span></div>
<div class="line">              &lt;&lt; pluginPath</div>
<div class="line">              &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html" title="STL class.">std::string</a> &amp;name : pluginNames)</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Testing plugin: &quot;</span> &lt;&lt; name &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <a class="codeRef" href="https://gazebosim.org/api/plugin/2/classgz_1_1plugin_1_1TemplatePluginPtr.html">gz::plugin::PluginPtr</a> plugin = pl.<a class="codeRef" href="https://gazebosim.org/api/plugin/2/classgz_1_1plugin_1_1Loader.html#a38af38708f58ad09a98603ed08fdb33c">Instantiate</a>(name);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> engine = <a class="code" href="structgz_1_1physics_1_1RequestEngine.html#aa04799d42bf6171a8e5cb7e83c631aaa" title="Get an Engine from the given physics plugin.">gz::physics::RequestEngine3d&lt;Features&gt;::From</a>(plugin);</div>
<div class="line"> </div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  engine name: &quot;</span> &lt;&lt; engine-&gt;GetName() &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md38"></a>
Setup CMakeLists.txt for CMake build</h3>
<p>Now create a file named <code>CMakeLists.txt</code> with your favorite editor and add these lines for finding <code>gz-plugin</code> and <code>gz-physics</code> dependencies in Citadel release. After that, add the executable pointing to our file and add linking library so that <code>cmake</code> can compile it.</p>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.5 FATAL_ERROR)</div>
<div class="line"> </div>
<div class="line">project(<a class="code" href="namespacegz.html">gz</a>-physics-hello-world-loader)</div>
<div class="line"> </div>
<div class="line">find_package(<a class="code" href="namespacegz.html">gz</a>-plugin2 REQUIRED COMPONENTS all)</div>
<div class="line">set(GZ_PLUGIN_VER ${<a class="code" href="namespacegz.html">gz</a>-plugin2_VERSION_MAJOR})</div>
<div class="line"> </div>
<div class="line">find_package(<a class="code" href="namespacegz.html">gz</a>-physics6 REQUIRED)</div>
<div class="line">set(GZ_PHYSICS_VER ${<a class="code" href="namespacegz.html">gz</a>-physics6_VERSION_MAJOR})</div>
<div class="line"> </div>
<div class="line">add_executable(hello_world_loader hello_world_loader.cc)</div>
<div class="line">target_link_libraries(hello_world_loader</div>
<div class="line">  <a class="code" href="namespacegz.html">gz</a>-plugin${GZ_PLUGIN_VER}::loader</div>
<div class="line">  <a class="code" href="namespacegz.html">gz</a>-physics${GZ_PHYSICS_VER}::gz-physics${GZ_PHYSICS_VER})</div>
</div><!-- fragment --><p>If you find CMake syntax difficult to understand, take a look at the official tutorial <a href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">here</a>.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Build and run</h2>
<h3><a class="anchor" id="autotoc_md40"></a>
Compile the loader</h3>
<p>Your current loader folder should look like this</p>
<div class="fragment"><div class="line">$ ls ~/hello_world_loader</div>
<div class="line">CMakeLists.txt  hello_world_loader.cc  build</div>
</div><!-- fragment --><p>Now you can build the loader by:</p>
<div class="fragment"><div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>This will generate the <code>hello_world_loader</code> executable under <code>build</code> folder. This loader will load any plugin that implements the <code>GetEngineInfo</code> feature, and print the engine name.</p>
<h3><a class="anchor" id="autotoc_md41"></a>
Load existing plugins</h3>
<p>For example, if you have the Gazebo Physics plugin for <a href="https://dartsim.github.io/">DART</a> compiled, find where it is installed with (you may need administrative rights: <code>sudo</code> on Linux platform):</p>
<div class="fragment"><div class="line">find / | grep libgz-physics-dartsim-plugin.so</div>
</div><!-- fragment --><p>You may find more than one file. Choose one of them, and load it with the loader by:</p>
<div class="fragment"><div class="line">./hello_world_loader &lt;path_to&gt;/libgz-physics-dartsim-plugin.so</div>
</div><!-- fragment --><p>And you'll see the engine info:</p>
<div class="fragment"><div class="line">Testing plugin: gz::physics::dartsim::Plugin</div>
<div class="line">  engine name: dartsim-6.10.0</div>
</div><!-- fragment --><p>At the time of writing, Gazebo Physics is shipped with <a href="https://dartsim.github.io/">DART</a> and <a href="https://community.gazebosim.org/t/announcing-new-physics-engine-tpe-trivial-physics-engine/629">TPE</a> physics plugins installed. Following the above steps, you can load <code>TPE</code> by the library name <code>libgz-physics-tpe-plugin.so</code> or other custom plugins by their corresponding names. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
