<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Transport">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Transport: Python Support</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Transport</h1>
        <h2>API Reference</h2>
        <div class="version">
        14.0.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Python Support</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Next Tutorial: <a class="el" href="security.html">Security</a> Previous Tutorial: <a class="el" href="services.html">Services</a></p>
<h2><a class="anchor" id="autotoc_md56"></a>
Overview</h2>
<p>In this tutorial, we are going to show the functionalities implemented in Python. These features are brought up by creating bindings from the C++ implementation using pybind11. It is important to note that not all of C++ features are available yet, on this tutorial we will go over the most relevant features. For more information, refer to the <a href="https://github.com/gazebosim/gz-transport/blob/gz-transport13/python/src/__init__.py"><b>init</b>.py</a> file which is a wrapper for all the bindings.</p>
<p>For this tutorial, we will create two nodes that communicate via messages. One node will be a publisher that generates the information, whereas the other node will be the subscriber consuming the information. Our nodes will be running on different processes within the same machine.</p>
<div class="fragment"><div class="line">mkdir ~/gz_transport_tutorial</div>
<div class="line">cd ~/gz_transport_tutorial</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md57"></a>
Publisher</h2>
<p>Download the <a href="https://github.com/gazebosim/gz-transport/blob/gz-transport13/python/examples/publisher.py">publisher.py</a> file within the <code>gz_transport_tutorial</code> folder and open it with your favorite editor:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.msgs11.stringmsg_pb2 <span class="keyword">import</span> StringMsg</div>
<div class="line"><span class="keyword">from</span> gz.msgs11.vector3d_pb2 <span class="keyword">import</span> Vector3d</div>
<div class="line"><span class="keyword">from</span> gz.transport14 <span class="keyword">import</span> Node</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> time</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>main():</div>
<div class="line">    node = Node()</div>
<div class="line">    stringmsg_topic = <span class="stringliteral">&quot;/example_stringmsg_topic&quot;</span></div>
<div class="line">    vector3d_topic = <span class="stringliteral">&quot;/example_vector3d_topic&quot;</span></div>
<div class="line">    pub_stringmsg = node.advertise(stringmsg_topic, StringMsg)</div>
<div class="line">    pub_vector3d = node.advertise(vector3d_topic, Vector3d)</div>
<div class="line"> </div>
<div class="line">    vector3d_msg = Vector3d()</div>
<div class="line">    vector3d_msg.x = 10</div>
<div class="line">    vector3d_msg.y = 15</div>
<div class="line">    vector3d_msg.z = 20</div>
<div class="line"> </div>
<div class="line">    stringmsg_msg = StringMsg()</div>
<div class="line">    stringmsg_msg.data = <span class="stringliteral">&quot;Hello&quot;</span> </div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">        count = 0</div>
<div class="line">        <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">          count += 1</div>
<div class="line">          vector3d_msg.x = count</div>
<div class="line">          <span class="keywordflow">if</span> <span class="keywordflow">not</span> pub_stringmsg.publish(stringmsg_msg):</div>
<div class="line">              <span class="keywordflow">break</span></div>
<div class="line">          print(<span class="stringliteral">&quot;Publishing &#39;Hello&#39; on topic [{}]&quot;</span>.format(stringmsg_topic))</div>
<div class="line">          <span class="keywordflow">if</span> <span class="keywordflow">not</span> pub_vector3d.publish(vector3d_msg):</div>
<div class="line">              <span class="keywordflow">break</span></div>
<div class="line">          print(<span class="stringliteral">&quot;Publishing a Vector3d on topic [{}]&quot;</span>.format(vector3d_topic))</div>
<div class="line">          time.sleep(0.1)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">        <span class="keywordflow">pass</span></div>
<div class="line"> </div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md58"></a>
Walkthrough</h3>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.msgs10.stringmsg_pb2 <span class="keyword">import</span> StringMsg</div>
<div class="line"><span class="keyword">from</span> gz.msgs10.vector3d_pb2 <span class="keyword">import</span> Vector3d</div>
<div class="line"><span class="keyword">from</span> gz.transport13 <span class="keyword">import</span> Node</div>
</div><!-- fragment --><p>The library <code>gz.transport13</code> contains all the Gazebo Transport elements that can be used in Python. The final API we will use is contained inside the class <code>Node</code>.</p>
<p>The lines <code>from gz.msgs10.stringmsg_pb2 import StringMsg</code> and <code>from gz.msgs10.vector3d_pb2 import Vector3d</code> includes the generated protobuf code that we are going to use for our messages. We are going to publish two types of messages: <code>StringMsg</code> and <code>Vector3d</code> protobuf messages.</p>
<div class="fragment"><div class="line">node = Node()</div>
<div class="line">stringmsg_topic = <span class="stringliteral">&quot;/example_stringmsg_topic&quot;</span></div>
<div class="line">vector3d_topic = <span class="stringliteral">&quot;/example_vector3d_topic&quot;</span></div>
<div class="line">pub_stringmsg = node.advertise(stringmsg_topic, StringMsg)</div>
<div class="line">pub_vector3d = node.advertise(vector3d_topic, Vector3d)</div>
</div><!-- fragment --><p>First of all we declare a <em>Node</em> that will offer some of the transport functionality. In our case, we are interested in publishing topic updates, so the first step is to announce our topics names and their types. Once a topic name is advertised, we can start publishing periodic messages using the publishers objects.</p>
<div class="fragment"><div class="line">vector3d_msg = Vector3d()</div>
<div class="line">vector3d_msg.x = 10</div>
<div class="line">vector3d_msg.y = 15</div>
<div class="line">vector3d_msg.z = 20</div>
<div class="line">stringmsg_msg = StringMsg()</div>
<div class="line">stringmsg_msg.data = <span class="stringliteral">&quot;Hello&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    count = 0</div>
<div class="line">    <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">      count += 1</div>
<div class="line">      vector3d_msg.x = count</div>
<div class="line">      <span class="keywordflow">if</span> <span class="keywordflow">not</span> (pub_stringmsg.publish(stringmsg_msg)):</div>
<div class="line">          <span class="keywordflow">break</span></div>
<div class="line">      print(<span class="stringliteral">&quot;Publishing &#39;Hello&#39; on topic [{}]&quot;</span>.format(stringmsg_topic))</div>
<div class="line">      <span class="keywordflow">if</span> <span class="keywordflow">not</span> (pub_vector3d.publish(vector3d_msg)):</div>
<div class="line">          <span class="keywordflow">break</span></div>
<div class="line">      print(<span class="stringliteral">&quot;Publishing a Vector3d on topic [{}]&quot;</span>.format(vector3d_topic))</div>
<div class="line">      time.sleep(0.1)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">    <span class="keywordflow">pass</span></div>
</div><!-- fragment --><p>In this section of the code we create the protobuf messages and fill them with content. Next, we iterate in a loop that publishes one message every 100ms to each topic. The method <em>publish()</em> sends a message to all the subscribers.</p>
<h2><a class="anchor" id="autotoc_md59"></a>
Subscriber</h2>
<p>Download the <a href="https://github.com/gazebosim/gz-transport/blob/gz-transport13/python/examples/subscriber.py">subscriber.py</a> file into the <code>gz_transport_tutorial</code> folder and open it with your favorite editor:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.msgs11.stringmsg_pb2 <span class="keyword">import</span> StringMsg</div>
<div class="line"><span class="keyword">from</span> gz.msgs11.vector3d_pb2 <span class="keyword">import</span> Vector3d</div>
<div class="line"><span class="keyword">from</span> gz.transport14 <span class="keyword">import</span> Node</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> time</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>stringmsg_cb(msg: StringMsg):</div>
<div class="line">    print(<span class="stringliteral">&quot;Received StringMsg: [{}]&quot;</span>.format(msg.data))</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>vector3_cb(msg: Vector3d):</div>
<div class="line">    print(<span class="stringliteral">&quot;Received Vector3: [x: {}, y: {}, z: {}]&quot;</span>.format(msg.x, msg.y, msg.z))</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>main():</div>
<div class="line">    <span class="comment"># create a transport node</span></div>
<div class="line">    node = Node()</div>
<div class="line">    topic_stringmsg = <span class="stringliteral">&quot;/example_stringmsg_topic&quot;</span></div>
<div class="line">    topic_vector3d = <span class="stringliteral">&quot;/example_vector3d_topic&quot;</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment"># subscribe to a topic by registering a callback</span></div>
<div class="line">    <span class="keywordflow">if</span> node.subscribe(StringMsg, topic_stringmsg, stringmsg_cb):</div>
<div class="line">        print(<span class="stringliteral">&quot;Subscribing to type {} on topic [{}]&quot;</span>.format(</div>
<div class="line">            StringMsg, topic_stringmsg))</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        print(<span class="stringliteral">&quot;Error subscribing to topic [{}]&quot;</span>.format(topic_stringmsg))</div>
<div class="line">        <span class="keywordflow">return</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment"># subscribe to a topic by registering a callback</span></div>
<div class="line">    <span class="keywordflow">if</span> node.subscribe(Vector3d, topic_vector3d, vector3_cb):</div>
<div class="line">        print(<span class="stringliteral">&quot;Subscribing to type {} on topic [{}]&quot;</span>.format(</div>
<div class="line">            Vector3d, topic_vector3d))</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        print(<span class="stringliteral">&quot;Error subscribing to topic [{}]&quot;</span>.format(topic_vector3d))</div>
<div class="line">        <span class="keywordflow">return</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment"># wait for shutdown</span></div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">      <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">        time.sleep(0.001)</div>
<div class="line">    <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">      <span class="keywordflow">pass</span></div>
<div class="line">    print(<span class="stringliteral">&quot;Done&quot;</span>)</div>
<div class="line"> </div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md60"></a>
Walkthrough</h3>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.msgs10.stringmsg_pb2 <span class="keyword">import</span> StringMsg</div>
<div class="line"><span class="keyword">from</span> gz.msgs10.vector3d_pb2 <span class="keyword">import</span> Vector3d</div>
<div class="line"><span class="keyword">from</span> gz.transport13 <span class="keyword">import</span> Node</div>
</div><!-- fragment --><p>Just as before, we are importing the <code>Node</code> class from the <code>gz.transport13</code> library and the generated code for the <code>StringMsg</code> and <code>Vector3d</code> protobuf messages.</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>stringmsg_cb(msg: StringMsg):</div>
<div class="line">    print(<span class="stringliteral">&quot;Received StringMsg: [{}]&quot;</span>.format(msg.data))</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>vector3_cb(msg: Vector3d):</div>
<div class="line">    print(<span class="stringliteral">&quot;Received Vector3: [x: {}, y: {}, z: {}]&quot;</span>.format(msg.x, msg.y, msg.z))</div>
</div><!-- fragment --><p>We need to register a function callback that will execute every time we receive a new topic update. The signature of the callback is always similar to the ones shown in this example with the only exception of the protobuf message type. You should create a function callback with the appropriate protobuf type depending on the type of the topic advertised. In our case, we know that topic <code>/example_stringmsg_topic</code> will contain a Protobuf <code>StringMsg</code> type and topic <code>/example_vector3d_topic</code> a <code>Vector3d</code> type.</p>
<div class="fragment"><div class="line"><span class="comment"># create a transport node</span></div>
<div class="line">node = Node()</div>
<div class="line">topic_stringmsg = <span class="stringliteral">&quot;/example_stringmsg_topic&quot;</span></div>
<div class="line">topic_vector3d = <span class="stringliteral">&quot;/example_vector3d_topic&quot;</span></div>
<div class="line"><span class="comment"># subscribe to a topic by registering a callback</span></div>
<div class="line"><span class="keywordflow">if</span> node.subscribe(StringMsg, topic_stringmsg, stringmsg_cb):</div>
<div class="line">    print(<span class="stringliteral">&quot;Subscribing to type {} on topic [{}]&quot;</span>.format(</div>
<div class="line">        StringMsg, topic_stringmsg))</div>
<div class="line"><span class="keywordflow">else</span>:</div>
<div class="line">    print(<span class="stringliteral">&quot;Error subscribing to topic [{}]&quot;</span>.format(topic_stringmsg))</div>
<div class="line">    <span class="keywordflow">return</span></div>
<div class="line"><span class="comment"># subscribe to a topic by registering a callback</span></div>
<div class="line"><span class="keywordflow">if</span> node.subscribe(Vector3d, topic_vector3d, vector3_cb):</div>
<div class="line">    print(<span class="stringliteral">&quot;Subscribing to type {} on topic [{}]&quot;</span>.format(</div>
<div class="line">        Vector3d, topic_vector3d))</div>
<div class="line"><span class="keywordflow">else</span>:</div>
<div class="line">    print(<span class="stringliteral">&quot;Error subscribing to topic [{}]&quot;</span>.format(topic_vector3d))</div>
<div class="line">    <span class="keywordflow">return</span></div>
</div><!-- fragment --><p>After the node creation, the method <code>subscribe()</code> allows you to subscribe to a given topic by specifying the message type, the topic name and a subscription callback function.</p>
<div class="fragment"><div class="line"><span class="comment"># wait for shutdown</span></div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">  <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">    time.sleep(0.001)</div>
<div class="line"><span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">  <span class="keywordflow">pass</span></div>
</div><!-- fragment --><p>If you don't have any other tasks to do besides waiting for incoming messages, we create an infinite loop that checks for messages each 1ms that will block your current thread until you hit <em>CTRL-C</em>.</p>
<h2><a class="anchor" id="autotoc_md61"></a>
Updating PYTHONPATH</h2>
<p>If you made the binary installation of Gazebo Transport, you can skip this step and go directly to the next section. Otherwise, if you built the package from source it is needed to update the PYTHONPATH in order for Python to recognize the library by doing the following:</p>
<ol type="1">
<li>If you builded from source using <code>colcon</code>: <div class="fragment"><div class="line">export PYTHONPATH=$PYTHONPATH:&lt;path to ws&gt;/install/lib/python</div>
</div><!-- fragment --></li>
<li>If you builded from source using <code>cmake</code>: <div class="fragment"><div class="line">export PYTHONPATH=$PYTHONPATH:&lt;path_install_prefix&gt;/lib/python</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md62"></a>
Running the examples</h2>
<p>Open two new terminals and directly run the Python scripts downloaded previously.</p>
<p>From terminal 1:</p>
<div class="fragment"><div class="line">python3 ./publisher.py</div>
</div><!-- fragment --><p>From terminal 2:</p>
<div class="fragment"><div class="line">python3 ./subscriber.py</div>
</div><!-- fragment --><p>In your publisher terminal, you should expect an output similar to this one, showing when a message is being published:</p>
<div class="fragment"><div class="line">$ ./publisher.py</div>
<div class="line">Publishing &#39;Hello&#39; on topic [/example_stringmsg_topic]</div>
<div class="line">Publishing a Vector3d on topic [/example_vector3d_topic]</div>
<div class="line">Publishing &#39;Hello&#39; on topic [/example_stringmsg_topic]</div>
<div class="line">Publishing a Vector3d on topic [/example_vector3d_topic]</div>
</div><!-- fragment --><p> In your subscriber terminal, you should expect an output similar to this one, showing that your subscriber is receiving the topic updates:</p>
<div class="fragment"><div class="line">$ ./subscriber.py</div>
<div class="line">Received StringMsg: [Hello]</div>
<div class="line">Received Vector3: [x: 2.0, y: 15.0, z: 20.0]</div>
<div class="line">Received StringMsg: [Hello]</div>
<div class="line">Received Vector3: [x: 3.0, y: 15.0, z: 20.0]</div>
<div class="line">Received StringMsg: [Hello]</div>
<div class="line">Received Vector3: [x: 4.0, y: 15.0, z: 20.0]</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md63"></a>
Threading in Gazebo Transport</h2>
<p>The way Gazebo Transport is implemented, it creates several threads each time a node, publisher, subscriber, etc is created. While this allows us to have a better parallelization in processes, a downside is possible race conditions that might occur if the ownership/access of variables is shared across multiple threads. Even though Python has its <a href="https://wiki.python.org/moin/GlobalInterpreterLock">GIL</a>, all the available features are bindings created for its C++ implementation, in other words, the downsides mentioned before are still an issue to be careful about. We recommend to always use threading locks when working with object that are used in several places (publisher and subscribers).</p>
<p>We developed a couple of examples that demonstrate this particular issue. Take a look at a publisher and subscriber (whithin the same node) that have race conditions triggered in the <a href="https://github.com/gazebosim/gz-transport/blob/gz-transport13/python/examples/data_race_without_mutex.py">data_race_without_mutex.py</a> file. The proposed solution to this issue is to use the <code>threading</code> library, you can see the same example with a mutex in the <a href="https://github.com/gazebosim/gz-transport/blob/gz-transport13/python/examples/data_race_with_mutex.py">data_race_with_mutex.py</a> file.</p>
<p>You can run any of those examples by just doing the following in a terminal: </p><div class="fragment"><div class="line">python3 ./data_race_without_mutex.py</div>
</div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line">python3 ./data_race_with_mutex.py</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md64"></a>
Advertise Options</h2>
<p>We can specify some options before we publish the messages. One such option is to specify the number of messages published per topic per second. It is optional to use but it can be handy in situations where we want to control the rate of messages published per topic.</p>
<p>We can declare the throttling option using the following code :</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.msgs10.stringmsg_pb2 <span class="keyword">import</span> StringMsg</div>
<div class="line"><span class="keyword">from</span> gz.transport13 <span class="keyword">import</span> Node, AdvertiseMessageOptions</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create a transport node and advertise a topic with throttling enabled.</span></div>
<div class="line">node = Node()</div>
<div class="line">topic_name = <span class="stringliteral">&quot;/foo&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Setting the throttling option</span></div>
<div class="line">opts = AdvertiseMessageOptions()</div>
<div class="line">opts.msgs_per_sec = 1</div>
<div class="line">pub = node.advertise(topic_name, StringMsg, opts);</div>
<div class="line"><span class="keywordflow">if</span> (!pub):</div>
<div class="line">  print(<span class="stringliteral">&quot;Error advertising topic&quot;</span> + topic_name)</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">False</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md65"></a>
Walkthrough</h3>
<div class="fragment"><div class="line"><span class="comment"># Setting the throttling option</span></div>
<div class="line">opts = AdvertiseMessageOptions()</div>
<div class="line">opts.msgs_per_sec = 1</div>
</div><!-- fragment --><p>In this section of code, we declare an <em>AdvertiseMessageOptions</em> object and use it to set the publishing rate (the member <code>msgs_per_sec</code>), In our case, the rate specified is 1 msg/sec.</p>
<div class="fragment"><div class="line">pub = node.advertise(topic_name, StringMsg, opts);</div>
</div><!-- fragment --><p>Next, we advertise the topic with message throttling enabled. To do it, we pass opts as an argument to the <em>advertise()</em> method.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
Subscribe Options</h2>
<p>A similar option is also available for the Subscriber node which enables it to control the rate of incoming messages from a specific topic. While subscribing to a topic, we can use this option to control the number of messages received per second from that particular topic.</p>
<p>We can declare the throttling option using the following code :</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.msgs10.stringmsg_pb2 <span class="keyword">import</span> StringMsg</div>
<div class="line"><span class="keyword">from</span> gz.transport13 <span class="keyword">import</span> Node, SubscribeOptions</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>stringmsg_cb(msg: StringMsg):</div>
<div class="line">    print(<span class="stringliteral">&quot;Received StringMsg: [{}]&quot;</span>.format(msg.data))</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create a transport node and subscribe to a topic with throttling enabled.</span></div>
<div class="line">node = Node()</div>
<div class="line">topic_name = <span class="stringliteral">&quot;/foo&quot;</span></div>
<div class="line">opts = SubscribeOptions()</div>
<div class="line">opts.msgs_per_sec = 1</div>
<div class="line">node.subscribe(StringMsg, topic_name, stringmsg_cb, opts)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md67"></a>
Walkthrough</h3>
<div class="fragment"><div class="line">opts = SubscribeOptions()</div>
<div class="line">opts.msgs_per_sec = 1</div>
<div class="line">node.subscribe(StringMsg, topic_name, stringmsg_cb, opts)</div>
</div><!-- fragment --><p>In this section of code, we create a <em>SubscribeOptions</em> object and use it to set message rate (the member <code>msgs_per_sec</code>). In our case, the message rate specified is 1 msg/sec. Then, we subscribe to the topic using the <em>subscribe()</em> method with opts passed as an argument to it.</p>
<h2><a class="anchor" id="autotoc_md68"></a>
Topic remapping</h2>
<p>It's possible to set some global node options that will affect both publishers and subscribers. One of these options is topic remapping. A topic remap consists of a pair of topic names. The first name is the original topic name to be replaced. The second name is the new topic name to use instead. As an example, imagine that you recorded a collection of messages published over topic <code>/foo</code>. Maybe in the future, you want to play back the log file but remapping the topic <code>/foo</code> to <code>/bar</code>. This way, all messages will be published over the <code>/bar</code> topic without having to modify the publisher and create a new log.</p>
<p>We can declare the topic remapping option using the following code:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.transport13 <span class="keyword">import</span> Node, NodeOptions</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create a transport node and remap a topic.</span></div>
<div class="line">nodeOpts = NodeOptions()</div>
<div class="line">nodeOptions.add_topic_remap(<span class="stringliteral">&quot;/foo&quot;</span>, <span class="stringliteral">&quot;/bar&quot;</span>);</div>
<div class="line">node = Node(nodeOptions);</div>
</div><!-- fragment --><p>You can modify the publisher example to add this option.</p>
<p>From terminal 1:</p>
<div class="fragment"><div class="line">python3 ./publisher.py</div>
</div><!-- fragment --><p>From terminal 2 (requires Gazebo Tools):</p>
<div class="fragment"><div class="line">gz topic --echo -t /bar</div>
</div><!-- fragment --><p>And you should receive all the messages coming in terminal 2.</p>
<p>The command <code>gz log playback</code> also supports the notion of topic remapping. Run <code>gz log playback -h</code> in your terminal for further details (requires Gazebo Tools).</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Service Requester</h2>
<p>Download the <a href="https://github.com/gazebosim/gz-transport/blob/gz-transport13/python/examples/requester.py">requester.py</a> file into the <code>gz_transport_tutorial</code> folder and open it with your favorite editor:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.msgs11.stringmsg_pb2 <span class="keyword">import</span> StringMsg</div>
<div class="line"><span class="keyword">from</span> gz.transport14 <span class="keyword">import</span> Node</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>main():</div>
<div class="line">    node = Node()</div>
<div class="line">    service_name = <span class="stringliteral">&quot;/echo&quot;</span></div>
<div class="line">    request = StringMsg()</div>
<div class="line">    request.data = <span class="stringliteral">&quot;Hello world&quot;</span></div>
<div class="line">    response = StringMsg()</div>
<div class="line">    timeout = 5000</div>
<div class="line"> </div>
<div class="line">    result, response = node.request(service_name, request, StringMsg, StringMsg, timeout)</div>
<div class="line">    print(<span class="stringliteral">&quot;Result:&quot;</span>, result, <span class="stringliteral">&quot;\nResponse:&quot;</span>, response.data)</div>
<div class="line"> </div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md70"></a>
Walkthrough</h3>
<div class="fragment"><div class="line"><span class="keyword">from</span> gz.msgs10.stringmsg_pb2 <span class="keyword">import</span> StringMsg</div>
<div class="line"><span class="keyword">from</span> gz.transport13 <span class="keyword">import</span> Node</div>
</div><!-- fragment --><p>Just as before, we are importing the <code>Node</code> class from the <code>gz.transport13</code> library and the generated code for the <code>StringMsg</code> protobuf message.</p>
<div class="fragment"><div class="line">node = Node()</div>
<div class="line">service_name = <span class="stringliteral">&quot;/echo&quot;</span></div>
<div class="line">request = StringMsg()</div>
<div class="line">request.data = <span class="stringliteral">&quot;Hello world&quot;</span></div>
<div class="line">response = StringMsg()</div>
<div class="line">timeout = 5000</div>
</div><!-- fragment --><p>On these lines we are creating our <em>Node</em> object which will be used to create the service request and defining all the relevant variables in order to create a request, the service name, the timeout of the request, the request and response data types.</p>
<div class="fragment"><div class="line">result, response = node.request(service_name, request, StringMsg, StringMsg, timeout)</div>
<div class="line">print(<span class="stringliteral">&quot;Result:&quot;</span>, result, <span class="stringliteral">&quot;\nResponse:&quot;</span>, response.data)</div>
</div><!-- fragment --><p>Here we are creating the service request to the <code>/echo</code> service, storing the result and response of the request in some variables and printing them out.</p>
<h2><a class="anchor" id="autotoc_md71"></a>
Service Responser</h2>
<p>Unfortunately, this feature is not available on Python at the moment. However, we can use a service responser created in C++ and make a request to it from a code in Python. Taking that into account, we will use the <a href="https://github.com/gazebosim/gz-transport/blob/gz-transport13/example/responser.cc">response.cc</a> file as the service responser.</p>
<h2><a class="anchor" id="autotoc_md72"></a>
Running the examples</h2>
<p>Open a new terminal and directly run the Python script downloaded previously. It is expected that the service responser is running in another terminal for this, you can refer to the previous tutorial <a class="el" href="services.html">Services</a>.</p>
<p>From terminal 1:</p>
<div class="fragment"><div class="line">python3 ./requester.py</div>
</div><!-- fragment --><p>In your terminal, you should expect an output similar to this one, showing the result and response from the request:</p>
<div class="fragment"><div class="line">$ ./requester.py</div>
<div class="line">Result: True </div>
<div class="line">Response: Hello world</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
