<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: Generation of Procedural Datasets with Blender</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        10.0.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Generation of Procedural Datasets with Blender</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Procedurally-generated datasets of 3D models allow us to create diverse simulation environments with nearly unlimited variety. Such environments enable developers to evaluate their algorithms under various conditions that their robots might experience. Furthermore, it is a simple way of producing a large quantity of synthetic training data for applications within machine learning.</p>
<h2><a class="anchor" id="overview-2"></a>
Overview</h2>
<p><a href="https://blender.org">Blender</a> is a free and open-source 3D software suite with several tools and features for creating models that can be utilized inside robotics simulators like Gazebo. In addition to manually modelling, sculpting and texturing models, Blender also enables procedural generation of datasets that can facilitate diversity in simulation environments. Furthermore, its Python API allows us to generate such datasets programmatically.</p>
<h3><a class="anchor" id="procedural-geometry"></a>
Procedural Geometry</h3>
<p><a href="https://docs.blender.org/manual/en/latest/modeling/geometry_nodes/introduction.html">Geometry Nodes</a> is a system of Blender for creating and modifying geometry through node-based operations. It enables the synthesis of many model variations by combining procedural operations with randomization. Although it enables a relatively simple and fast method for creating datasets, it can be tricky to get started. Fortunately, there are several helpful resources that can help you with the creation of your own custom 3D models, e.g. an <a href="https://www.youtube.com/watch?v=kMDB7c0ZiKA">overview video</a>, <a href="https://blender.org/download/demo-files/#geometry-nodes">demo files</a>, <a href="https://studio.blender.org/training/geometry-nodes-from-scratch">training from Blender Studio</a>, <a href="https://www.youtube.com/watch?v=aO0eUnu0hO0">tutorial by Blender Guru</a> and many others.</p>
<h3><a class="anchor" id="python-script-for-generating-procedural-datasets-of-sdf-models"></a>
Python Script for Generating Procedural Datasets of SDF models</h3>
<p>Python script <a href="https://github.com/gazebosim/gz-sim/tree/gz-sim10/examples/scripts/blender/procedural_dataset_generator.py"><code>procedural_dataset_generator.py</code></a> contains a Blender exporter of SDF models and a generator of procedural SDF dataset. The exporter outputs models that are compatible with the SDF format and the directory structure of <a href="https://app.gazebosim.org">Fuel</a>, which can be used with any existing <code>.blend</code> project. The dataset generator leverages Blender's Geometry Nodes modifiers that are configured to generate countless model variations via the Random Seed input attribute (seed for the pseudorandom generation).</p>
<p>This script processes all selected objects in the opened Blender scene (or all existing objects if none is selected). The exporter is configurable via CLI arguments (or by adjusting default model-specific parameters). Currently, the following features are supported:</p>
<ul>
<li>Export of mesh geometry as COLLADA (<code>.dae</code>), Wavefront (<code>.obj</code>) or STL (<code>.stl</code>) file formats.</li>
<li>Option to exclude specific Blender objects from being exported to visual or collision geometry.</li>
<li>Export separate visual and collision geometry at different levels of resolution to improve collision-checking performance with low-poly geometry.</li>
<li>Estimation of inertial properties while assuming a uniform density.</li>
<li>Optional randomization of model properties via uniform distribution, e.g. mass and surface friction.</li>
<li>Linking of PBR textures sets via symbolic links or copies.</li>
<li>Generation of thumbnails for the exported models.</li>
</ul>
<h2><a class="anchor" id="instructions"></a>
Instructions</h2>
<h3><a class="anchor" id="dependencies"></a>
Dependencies</h3>
<p>Blender is required to open <code>.blend</code> projects and run the script that employs the Python API of Blender (<code>bpy</code>). Versions <code>[&gt;=3.0, &lt;3.3]</code> were tested with the script, but newer versions are also expected to work.</p>
<ul>
<li><a href="https://blender.org/download">Blender <code>[&gt;=3.0]</code></a></li>
</ul>
<h3><a class="anchor" id="run-the-python-script"></a>
Run the Python Script</h3>
<h4><a class="anchor" id="option-a--run-script-inside-blender"></a>
Option A — Run Script Inside Blender</h4>
<p>The first option is to run the Python script directly in Blender's <em>Text Editor</em> tab for scripting while using the default parameters that are configurable via constants at the beginning of the script. For new projects, you can follow these steps:</p>
<ol type="1">
<li>Open the desired Blender <code>.blend</code> project. It is recommended to open Blender using a console to get full access to the standard output and error.</li>
</ol>
<div class="fragment"><div class="line">blender [blender options] file.blend</div>
</div><!-- fragment --><ol type="1">
<li>Copy the <a href="https://github.com/gazebosim/gz-sim/tree/gz-sim10/examples/scripts/blender/procedural_dataset_generator.py"><code>procedural_dataset_generator.py</code></a> Python script into a new text data block in your <code>.blend</code> under the <em>Text Editor</em> tab.</li>
<li>Configure the default parameters of the script for your specific models via constants at the beginning of the file.</li>
<li>Run the script using the <em>Run script</em> button in the panel of the <em>Text Editor</em> tab at the top of the screen.</li>
</ol>
<p><img src="https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/blender_procedural_datasets/blender_instructions.png" alt="Instructions in Blender" class="inline"/></p>
<p>Once you follow these steps and configure the script for your <code>.blend</code> project, you can save it and use Option B in the future.</p>
<h4><a class="anchor" id="option-b--run-an-internal-script"></a>
Option B — Run an Internal Script</h4>
<p>The second option is to run a script that is already saved inside a <code>.blend</code> project, i.e. saved and configured through the procedure above. Therefore, this approach is applicable only for <code>.blend</code> projects previously configured with the <a href="https://github.com/gazebosim/gz-sim/tree/gz-sim10/examples/scripts/blender/procedural_dataset_generator.py"><code>procedural_dataset_generator.py</code></a> Python script. This option enables configuring the script via CLI arguments instead of modifying its contents, which is unnecessary if the project is already configured.</p>
<div class="fragment"><div class="line"># Note: `procedural_dataset_generator.py` is the name of the Python script inside the `file.blend`</div>
<div class="line">blender [blender options] file.blend --python-text procedural_dataset_generator.py -- [script options]</div>
</div><!-- fragment --><h4><a class="anchor" id="option-c--run-an-external-script"></a>
Option C — Run an External Script</h4>
<p>It is also possible to run the Python script externally without configuring it first inside a <code>.blend</code> project. This option also enables configuring the script via CLI arguments, which is often required for new models.</p>
<div class="fragment"><div class="line"># Note: `/path/to/procedural_dataset_generator.py` can be an absolute or relative system path</div>
<div class="line">blender [blender options] file.blend --python /path/to/procedural_dataset_generator.py -- [script options]</div>
</div><!-- fragment --><h2><a class="anchor" id="examples-1"></a>
Examples</h2>
<p>In order to demonstrate the generation of procedural datasets, the following two <code>.blend</code> projects are provided:</p>
<ul>
<li><a href="https://github.com/gazebosim/gz-sim/tree/gz-sim10/tutorials/files/blender_procedural_datasets/rock.blend">rock.blend</a> — Models of randomized rocks for Gazebo that robots can interact with</li>
<li><a href="https://github.com/gazebosim/gz-sim/tree/gz-sim10/tutorials/files/blender_procedural_datasets/woodland.blend">woodland.blend</a> — Static environments of natural scenery with randomly scattered assets of low-poly trees, rocks, grass and flowers (these assets were adapted from <a href="https://studio.blender.org">Blender Studio</a>)</li>
</ul>
<p>You need to download these <code>.blend</code> projects to follow the examples. You can do that either manually on GitHub or via <code>wget</code>/<code>curl</code>.</p>
<div class="fragment"><div class="line">wget https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/blender_procedural_datasets/rock.blend</div>
<div class="line">wget https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/blender_procedural_datasets/woodland.blend</div>
</div><!-- fragment --><h3><a class="anchor" id="try-demo-files"></a>
Try Demo Files</h3>
<p>Now you can open these projects with Blender and run the scripts. Alternatively, you could run the pre-configured Python scripts for each <code>.blend</code> project directly from the console and configure CLI arguments as desired.</p>
<div class="fragment"><div class="line">blender rock.blend --python-text procedural_dataset_generator.py -- -o sdf_models/rock</div>
<div class="line">blender woodland.blend --python-text procedural_dataset_generator.py -- -o sdf_models/woodland</div>
</div><!-- fragment --><p><img src="https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/blender_procedural_datasets/demo_blender_rock.gif" alt="Example of generating a dataset of rock SDF models" class="inline"/></p>
<p><img src="https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/blender_procedural_datasets/demo_blender_woodland.gif" alt="Example of generating a dataset of woodland SDF models" class="inline"/></p>
<p>You can configure the script in several ways (see <code>blender rock.blend --python-text procedural_dataset_generator.py -- -h</code>). For example, you can set a combination of <code>--texture-source-mode</code> and <code>--texture-source-value</code> arguments to link models to (random) PBR textures.</p>
<div class="fragment"><div class="line">## Configure `--texture-source-value` with a path to one of the following directories</div>
<div class="line"># ├── ./                                    # &lt;-- Here to randomly sample a texture set</div>
<div class="line">#   ├── texture0/                           # &lt;-- Here to use texture0</div>
<div class="line">#     ├── *albedo*.png || *color*.png</div>
<div class="line">#     ├── *normal*.png</div>
<div class="line">#     ├── *roughness*.png</div>
<div class="line">#     └── *specular*.png || *metalness*.png</div>
<div class="line">#   ├── texture1/</div>
<div class="line">#   └── ...</div>
<div class="line">blender rock.blend --python-text procedural_dataset_generator.py -- --texture-source-mode path --texture-source-value /path/to/textures</div>
</div><!-- fragment --><h3><a class="anchor" id="expected-output"></a>
Expected Output</h3>
<p>Once the models are generated, you can see the generated directory structure for each model.</p>
<div class="fragment"><div class="line">./sdf_models/</div>
<div class="line">├── rock/            # Parent directory of the generated dataset for rock models</div>
<div class="line">  ├── rock0/         # SDF Model directory of the 1st model</div>
<div class="line">  │ ├── meshes/      # Directory for mesh geometry</div>
<div class="line">  │ │ ├── collision/ # Collision geometry, defaults to `.stl`</div>
<div class="line">  │ │ └── visual/    # Visual geometry, defaults to `.obj`+`.mtl`</div>
<div class="line">  │ ├── thumbnails/  # Directory for the generated thumbnail</div>
<div class="line">  │ ├── model.config # Meta data about the model</div>
<div class="line">  │ └── model.sdf    # SDF description of the model</div>
<div class="line">  ├── rock1/         # SDF Model directory of the 2nd model</div>
<div class="line">  └── ...</div>
<div class="line">└── woodland/          # Identical structure for the dataset of woodland models ...</div>
<div class="line">  ├── woodland0/</div>
<div class="line">  ├── woodland1/</div>
<div class="line">  └── ...</div>
</div><!-- fragment --><h3><a class="anchor" id="gz_sim_resource_path-environment-variable"></a>
&lt;tt&gt;GZ_SIM_RESOURCE_PATH&lt;/tt&gt; Environment Variable</h3>
<p>In order to make the models discoverable by Gazebo, you need to set the <code>GZ_SIM_RESOURCE_PATH</code> environment variable such that it includes the path to the parent directory of the models.</p>
<p>Note that the Python script will always print the adequate command with the exact path after the export of models is finished.</p>
<div class="fragment"><div class="line">export GZ_SIM_RESOURCE_PATH=&quot;${PWD}/sdf_models/rock${GZ_SIM_RESOURCE_PATH:+:${GZ_SIM_RESOURCE_PATH}}&quot;</div>
<div class="line">export GZ_SIM_RESOURCE_PATH=&quot;${PWD}/sdf_models/woodland${GZ_SIM_RESOURCE_PATH:+:${GZ_SIM_RESOURCE_PATH}}&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="spawn-models-in-gazebo"></a>
Spawn Models in Gazebo</h3>
<p>Hereafter, you can spawn the generated models inside Gazebo with your preferred approach, e.g. via the Resource Spawner GUI plugin. Below are some examples of Gazebo environments using the rock and woodland SDF models.</p>
<p><img src="https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/blender_procedural_datasets/demo_gazebo_rock.png" alt="Example of the generated rock SDF models in Gazebo" class="inline"/></p>
<p><img src="https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/blender_procedural_datasets/demo_gazebo_woodland.png" alt="Example of the generated woodland SDF models in Gazebo" class="inline"/></p>
<p>Every object that uses Geometry Nodes in these projects has several input attributes that can be configured. You can open the <code>.blend</code> projects again, navigate to the <code>Modifier Properties</code> tab for each object, and try tweaking them yourself.</p>
<h2><a class="anchor" id="known-issues-2"></a>
Known Issues</h2>
<h3><a class="anchor" id="installation-of-modules-in-blenders-python-environment-trimesh"></a>
Installation of Modules in Blender's Python Environment (&lt;tt&gt;trimesh&lt;/tt&gt;)</h3>
<p>The <a href="https://trimsh.org">trimesh</a> Python module is used to estimate inertial properties. This module is not included by default with the Python environment of Blender and thus needs to be installed. It is installed automatically during the first run of the Python script. However, installing a new Python module within Blender will not be possible if you use it from <a href="https://snapcraft.io/blender">Snap Store</a>. If this is the case, you must use the <code>--python-use-system-env</code> Blender option when running the Python script. Furthermore, you might need to run the script as <code>sudo</code> for the first time if the installation fails due to a lack of permission.</p>
<h2><a class="anchor" id="future-work"></a>
Future Work</h2>
<p>The Python script is not fully featured yet. Below is a list of features that could be eventually added to improve its functionality:</p>
<ul>
<li>Add support for exporting processed objects as separate <code>&lt;visual&gt;</code> and <code>&lt;collision&gt;</code> entities of a single SDF model.</li>
<li>Add support for baking textures for all processed models. Separate <code>&lt;visual&gt;</code> entities would be required to prevent overlapping of UV maps.</li>
<li>Add support for pulling PBR textures from an online source, e.g. repository.</li>
<li>Add support for exporting lights as SDF entities.</li>
<li>Add support for exporting cameras as SDF entities. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
