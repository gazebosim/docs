<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: Automatic Inertia Calculation for Links</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        10.0.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Automatic Inertia Calculation for Links</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="automatic-inertia-calculation-for-sdformat-links"></a>
Automatic Inertia Calculation for SDFormat Links</h2>
<p>This feature enables automatic calculation for the Moments of Inertia, Mass, and Inertial Pose (Center of Mass pose) of a link described using SDFormat. The following geometry types are currently supported for this feature:</p><ul>
<li>Box</li>
<li>Capsule</li>
<li>Cylinder</li>
<li>Ellipsoid</li>
<li>Sphere</li>
<li>Mesh</li>
</ul>
<p>Using this feature, a user can easily set up an accurate simulation with physically plausible inertial values for a link. This also removes the dependency on manual calculations or 3rd-party mesh processing software which can help lower the barrier of entry for beginners.</p>
<p>This tutorial will focus on how this feature can be enabled and how the inertia values for a link can be configured. Some limitations and recommendations would also be discussed along the way that would allow users to more mindfully utilize this feature.</p>
<h2><a class="anchor" id="basic-overview"></a>
Basic Overview</h2>
<p>This feature introduced a new <code>auto</code> attribute for the <code>&lt;inertial&gt;</code> tag which can be set to enable or disable the automatic calculations. It'll be set to false by default.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">inertial</span> <span class="keyword">auto</span>=<span class="stringliteral">&quot;true&quot;</span> /&gt;</div>
</div><!-- fragment --><p>In case, <code>auto</code> is set to true, the constituent <b>collision geometries</b> of the link are considered for the calculations. The <code>&lt;density&gt;</code> tag can be used to specify the mass density value of the collision in kg/m^3. The density of water (1000 kg/m^3) is utilized as the default value:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">collision</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;collision&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">density</span>&gt;2710.0&lt;/<span class="keywordtype">density</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">box</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">size</span>&gt;1 1 1&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">collision</span>&gt;</div>
</div><!-- fragment --><p>In case of multiple collision geometries in a link, a user is free to provide different density values for each and the inertia values from each would be aggregated to calculate the final inertia of the link. However, if there are no collisions present, an <code>ELEMENT_MISSING</code> error would be thrown.</p>
<p><b>Important Notes</b></p><ul>
<li>If <code>auto</code> is set to <code>true</code> and the user has still provided values through the <code>&lt;pose&gt;</code> and <code>&lt;inertia&gt;</code> tags, they would be <b>overwritten</b> by the automatically computed values.</li>
<li>In libSDFormat versions equal to or newer than 14.7.0 and 15.2.0, if <code>&lt;mass&gt;</code> is specified, it takes precedence over the <code>&lt;density&gt;</code> property. The link's inertial parameters will be scaled to match the specified mass while respecting the ratio of collision density values.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>Note:</b> Use SDF Spec version 1.11 or greater to utilize the new tags and attributes of this feature. </p>
</blockquote>
<p>Here's an example snippet of a cylinder model that has automatic inertial calculations enabled and has a density of 1240 kg/m^3:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;cylinder&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;cylinder_link&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">inertial</span> <span class="keyword">auto</span>=<span class="stringliteral">&quot;true&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">collision</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;collision&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">density</span>&gt;1240.0&lt;/<span class="keywordtype">density</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">cylinder</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">radius</span>&gt;1&lt;/<span class="keywordtype">radius</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">length</span>&gt;2&lt;/<span class="keywordtype">length</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">cylinder</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">collision</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">visual</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;visual&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">cylinder</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">radius</span>&gt;1&lt;/<span class="keywordtype">radius</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">length</span>&gt;2&lt;/<span class="keywordtype">length</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">cylinder</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">material</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">diffuse</span>&gt;1.0 1.0 0.0 1.0&lt;/<span class="keywordtype">diffuse</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">ambient</span>&gt;1.0 1.0 0.0 1.0&lt;/<span class="keywordtype">ambient</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">specular</span>&gt;1.0 1.0 0.0 1.0&lt;/<span class="keywordtype">specular</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">material</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">visual</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">link</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>If you use the above snippet in an empty world and launch it with <code>gz-sim</code>, here's how it would look:</p>
<div class="image">
<img src="cylinder_inertia_demo.gif" alt=""/>
<div class="caption">
Cylinder</div></div>
    <h2><a class="anchor" id="links-with-multiple-collisions--the-effect-of-density"></a>
Links with Multiple Collisions &amp; the Effect of Density</h2>
<p>To understand the inertia calculation in links with multiple collisions and the effect of setting different density values, you can launch the <code>auto_inertia_pendulum.sdf</code> example world using:</p>
<div class="fragment"><div class="line">gz sim auto_inertia_pendulum.sdf</div>
</div><!-- fragment --><p>After the gz-sim window opens up, you can right click on both the models and enable the centre of mass visualization by selecting the <code>View &gt; Center of Mass</code> option from the menu. Once you play the simulation it should look this:</p>
<div class="image">
<img src="auto_inertia_pendulum.gif" alt=""/>
<div class="caption">
Pendulum</div></div>
    <p>This example world has two structurally identical models. The pendulum link of both the models contain 3 cylindrical collision geometries:</p><ul>
<li>One on the top which forms the joint (pivot)</li>
<li>A longer cylinder in middle</li>
<li>One at the end which forms the bob of the cylinder.</li>
</ul>
<p>Even, though they are identical, the center of mass for both are different as they use different density values for the different cylinder collisions. On one hand, the upper joint collision of the pendulum on the left has the highest density which causes the center of mass to shift closer to the axis. While on the other hand, the bob collision of the pendulum on the right has the highest density which causes the center of mass to shift towards the end of the pendulum. This difference in mass distribution about the axis of rotation results in a difference in the moment of inertia of the 2 setups and hence different angular velocities.</p>
<h2><a class="anchor" id="mesh-inertia-calculation-with-rolling-shapes-demo"></a>
Mesh Inertia Calculation with Rolling Shapes Demo</h2>
<p>Let's try another example world, <code>auto_inertia_rolling_shapes.sdf</code>. This can be launched with <code>gz sim</code> using the following command:</p>
<div class="fragment"><div class="line">gz sim auto_inertia_rolling_shapes.sdf</div>
</div><!-- fragment --><p>Once you launch and play the simulation, it should look something like this:</p>
<div class="image">
<img src="rolling_inertia_demo.gif" alt=""/>
<div class="caption">
Rolling</div></div>
    <p>Here the right most shapes is a hollow cylinder (yellow). This model is loaded from <a href="https://app.gazebosim.org/jasmeetsingh/fuel/models/Hollow%20Cylinder">Gazebo Fuel</a> and is made using a collada mesh of a hollow cylinder. Apart from this, we can see there is a solid cylinder, a solid sphere and a solid capsule. All of these are made using the <code>&lt;geometry&gt;</code> tag and have automatic inertia calculations enabled. Here, the moments of inertia for the hollow cylinder (which is a non-convex mesh shape) is calculated and from the simulation we can see that it reaches the bottom of the incline last. This is physically accurate as the mass distribution for the hollow cylinder is concentrated at a distance from the axis of rotation (which passes through the center of mass in this case).</p>
<h2><a class="anchor" id="key-points-on-mesh-inertia-calculator"></a>
Key Points on Mesh Inertia Calculator</h2>
<p>The mesh inertia calculator is implemented based on the method described in this <a href="https://www.geometrictools.com/Documentation/PolyhedralMassProperties.pdf">document</a>(pdf). The method is suited for solid, simple polyhedrons of constant mass density.</p>
<p>Here are some key points to consider when using automatic inertia calculation with 3D Meshes:</p><ul>
<li>Water-tight triangle meshes are required for the Mesh Inertia Calculator.</li>
<li>Since the vertex data is used for inertia calculations, high vertex count would be needed for near ideal values. However, it is recommended to use basic shapes with the geometry tag (Box, Capsule, Cylinder, Ellipsoid and Sphere) as collision geometries get a better overall simulation performance or RTF.</li>
<li>In the case that the mesh inertia calculator fails to produce valid inertia, it will attempt to correct the auto-calculated mass matrix if it is strictly positive and within a certain tolerance of satisfying the triangle inequality. If that fails, an error will be logged.</li>
<li>For complex, non-water-tight meshes, it is recommended to enable <a href="http://sdformat.org/spec?ver=1.12&amp;elem=geometry#mesh_optimization">mesh optimization</a> for the mesh collision in SDF by setting it to <code>convex_hull</code> or <code>convex_decomposition</code>. The mesh inertia calculator will then compute inertia based on the decomposed convex hull submeshes. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
