<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: Load image heightmaps and Digital Elevation Models (DEM)</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        10.0.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Load image heightmaps and Digital Elevation Models (DEM)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="overview-4"></a>
Overview</h1>
<h2><a class="anchor" id="what-are-heightmaps-and-why-are-they-useful-for-simulation"></a>
What are heightmaps and why are they useful for simulation?</h2>
<p>Simply put, a heightmap is common term used in computer graphics to refer to a 2D image where the value of each pixel or cell corresponds to the elevation or height of that specific point in the real world.</p>
<div class="image">
<img src="ex_of_grid_of_elevations.png" alt=""/>
<div class="caption">
Visual example of grid of elevations</div></div>
    <p>Image reference: <a href="https://www.futurelearn.com/info/courses/advanced-archaeological-remote-sensing/0/steps/356833">https://www.futurelearn.com/info/courses/advanced-archaeological-remote-sensing/0/steps/356833</a></p>
<p>They are useful for simulation because they offer a simple way to provide realistic digital representation of the terrain. For fields like robotics, accurate topography can be beneficial for develop algorithms and/or models for autonomous navigation, motion planning, task planning, and control because they can provide cost effective, rapid development cycles. Engineers can develop and test algorithms in these environments before physical deployment.</p>
<p>In this tutorial we'll dive deeper into what makes heightmaps, where to get them, and how to process them to use for simulation in Gazebo.</p>
<h2><a class="anchor" id="gazebos-supported-heightmap-types"></a>
Gazebo's supported heightmap types</h2>
<p>Gazebo supports creating a terrain from image heightmaps, meshes, and Digital Elevation Models (DEMs). While this tutorial will be focusing more in depth with DEMs, we will provide a quick overview of the other formats available to try out.</p>
<h3><a class="anchor" id="image-heightmaps"></a>
Image heightmaps</h3>
<p>Image heightmaps use a 2D grayscale image, where each pixel corresponds to the elevation at that point. Black (or <code>0</code>) represents the lowest point and while (or <code>255</code>) represents the highest. This is a simple and efficient way to store elevation data because it can use less memory compared to meshes and DEMs.</p>
<p>The following example will look at the <a href="https://app.gazebosim.org/OpenRobotics/fuel/models/Fortress%20heightmap">demo created for Gazebo Fortress</a>. Below shows the black and white image is what gets referenced in SDF and fed into Gazebo (download the model from the previous link and look at the <code>model.sdf</code> file).</p>
<div class="image">
<img src="fortress_heightmap.png" alt=""/>
<div class="caption">
Example of image heightmap</div></div>
    <p>What ends up getting rendered in Gazebo is shown below:</p>
<div class="image">
<img src="fortress_heightmap_in_gazebo.jpg" alt=""/>
<div class="caption">
Image heightmap in Gazebo</div></div>
    <div class="image">
<img src="fortress_heightmap_in_gazebo2.jpg" alt=""/>
<div class="caption">
Another image heightmap in Gazebo</div></div>
    <h3><a class="anchor" id="meshes"></a>
Meshes</h3>
<p>Another format used for realistic topography are meshes, which are 3D polygonal models. The supported file formats for meshes in Gazebo include DAE, GLTF, OBJ, and STL, and more. These models are best suited for worlds with tunnels, caves, or overhangs.</p>
<p>Examples:</p>
<div class="image">
<img src="mesh_tunnel_entrance.png" alt="" width="80%"/>
</div>
<div class="image">
<img src="mesh_cave.png" alt="" width="80%"/>
</div>
<p>Meshes were the format used for the <a href="https://github.com/osrf/subt/wiki">DARPA Subterranean Challenge (SubT) simulation</a> and most were created from point cloud converted data (check out this <a href="http://gazebosim.org/api/sim/10/pointcloud.html">tutorial on how to convert point cloud data to a 3D mesh model for Gazebo</a>). These heightmap meshes can be found <a href="https://app.gazebosim.org/OpenRobotics/fuel/collections/SubT%20Tech%20Repo">here on Fuel</a>.</p>
<h3><a class="anchor" id="digital-elevation-models"></a>
Digital Elevation Models</h3>
<p>A Digital Elevation Model (<a class="elRef" href="https://gazebosim.org/api/common/7/classDEM.html">DEM</a>) is a 3D representation of a terrain's surface that does not include any objects like buildings or vegetation. DEMs are frequently created by using a combination of sensors, such as satellites, LIDAR, radar, or cameras. The terrain elevations for ground positions are sampled at regularly-spaced horizontal intervals.</p>
<div class="image">
<img src="dem_monterey_bay.png" alt="" width="80%"/>
</div>
<h1><a class="anchor" id="walkthrough-with-dems-for-gazebo"></a>
Walkthrough with DEMs for Gazebo</h1>
<p>There are two main types of <a class="elRef" href="https://gazebosim.org/api/common/7/classDEM.html">DEM</a> formats, a vector-based Triangular Irregular Network (TIN) or a grid of elevations (raster). In Gazebo, raster based formats (more specifically GeoTiff or <code>.tif</code> files) are the most tested formats but in theory Gazebo should be able to run any <a href="https://gdal.org/en/stable/index.html">GDAL</a> default supported format (since GDAL is the backend library that Gazebo uses to read <a class="elRef" href="https://gazebosim.org/api/common/7/classDEM.html">DEM</a> files). Let's look at an example of getting DEMs from publicly available data and using some common open source tools to process them for Gazebo.</p>
<h2><a class="anchor" id="obtaining-data"></a>
Obtaining data</h2>
<p>Many resources for publicly available data exist and include:</p>
<ul>
<li><a href="https://portal.opentopography.org/datasets">OpenTopography</a></li>
<li><a href="http://earthexplorer.usgs.gov">earthexplorer.usgs.gov</a></li>
<li><a href="https://www.earthdata.nasa.gov/topics/land-surface/digital-elevation-terrain-model-dem/data-access-tools">NASA's EarthData</a></li>
<li><a href="https://www.gebco.net/">General Bathymetric Chart of the Oceans (GEBCO) data</a></li>
<li><a href="https://astrogeology.usgs.gov/search?target=&amp;system=&amp;p=1&amp;accscope=&amp;searchBar=">Other planetary DEMs (e.g., Moon or Mars)</a></li>
</ul>
<p>For our example, we will use <a href="https://portal.opentopography.org/datasets">OpenTopography</a>,</p><ul>
<li>Create an account if not done so already</li>
<li>Look for your area of interest, in this example, in the "Search by keyword" textbox enter <code>half dome</code></li>
<li>In the results section, under "High Resolution Topography" click "Get Raster Data"</li>
<li>In the following page,<ul>
<li>In the map, click the blue "Select a Region" button in the top left corner of the map to select the region to extract the <a class="elRef" href="https://gazebosim.org/api/common/7/classDEM.html">DEM</a> from <div class="image">
<img src="open_topography_region_selection.png" alt="" width="80%"/>
</div>
</li>
<li>The data output format should be GeoTiff and Digital Terrain Model (DTM) should be checked for Layer types</li>
<li>Click Submit</li>
</ul>
</li>
<li>Once the data has finished processing, download the bundled results and unzip the file</li>
</ul>
<h2><a class="anchor" id="processing-data"></a>
Processing data</h2>
<p>Common open source tools for geospatial data include:</p>
<ul>
<li><a href="https://gdal.org/en/stable/">Geospatial Data Abstraction Library (GDAL)</a>: is a library and command line toolkit for reading and maipulating DEMs. This is the library that is used in Gazebo for reading DEMs and will be installed on your system if Gazebo is installed.</li>
<li><a href="https://qgis.org/">QGIS</a>: a GUI for viewing, analyzing, editing, and publishing DEMs and relies on GDAL.</li>
</ul>
<p>Using <a href="https://qgis.org/">QGIS</a>,</p>
<ul>
<li>(optional) When working with earth DEMs, it can be helpful to add a map layer (as the base layer) to verify the imported <a class="elRef" href="https://gazebosim.org/api/common/7/classDEM.html">DEM</a> is in the correct projection.<ul>
<li>In the top toolbar, go to Layer &gt; Add Layer &gt; Add XYZ Layer...</li>
<li>In the dropdown menu under "XYZ Connections", select 'Google Satellite' or 'OpenStreetMap' &gt; Click 'Add' &gt; then 'Close'</li>
</ul>
</li>
<li>In the top toolbar, go to Layer &gt; Add Layer &gt; Add Raster Layer...</li>
<li>Select the file that we downloaded and unzipped (from the instructions above) &gt; Click 'Add' &gt; then 'Close'</li>
<li>Check the Coordinate Reference System button at the bottom right to make sure it is set to 'EPSG:4326'. If not click on it and search for 'EPSG:4326', choose 'WGS 84 - SPSG:4326' and click 'OK'</li>
<li>Enter the lat/lon coordinates retrieved from USGS earlier in the "Coordinate" textbox at the bottom (i.e., <code>37.7444, -119.5341</code>) &gt; hit the Enter key (this will move the viewpoint to the desired location)</li>
<li>In the bottom bar, update "Scale" to <code>1:50000</code><ul>
<li>If the optional step was followed, QGIS should look something like the image below, otherwise only the <a class="elRef" href="https://gazebosim.org/api/common/7/classDEM.html">DEM</a> will be displayed</li>
</ul>
</li>
</ul>
<div class="image">
<img src="qgis_satellite_and_dem.png" alt="" width="80%"/>
</div>
<ul>
<li>If the Processing Toolbox panel isn't open, click the gear icon in the top toolbar<ul>
<li>Search for "Clip raster by extent" and double click to open the dialog</li>
<li>Input layer: should be the imported GeoTiff</li>
<li>Clipping extent: click the down arrow and select "Draw on Map Canvas" to select your desired region</li>
</ul>
</li>
</ul>
<div class="image">
<img src="qgis_draw_on_map_canvas.png" alt="" width="80%"/>
</div>
<ul>
<li>Clipped (extent): Click the button with the "..." dots &gt; Save to File ... &gt; select the desired save location and give the file a name</li>
<li>Click the "Run" button, this will add a new layer to the layers panel (on the left)</li>
</ul>
<h2><a class="anchor" id="sdf-setup"></a>
SDF setup</h2>
<p>Now let's set up the SDF model, in a terminal run: <code>gdalinfo -stats &lt;newly_saved.tif&gt;</code></p>
<p>Look for the output: <code>Size is &lt;x_value&gt; &lt;y_value&gt;</code></p>
<p>This is the <code>x</code> and <code>y</code> values that need to be entered in the <code>&lt;size&gt;</code> tag. To calculate z, subtract the <code>Minimum</code> from the <code>Maximum</code> elevation (i.e., <code>z = Maximum - Minimum</code>).</p>
<p>Optionally, to move the model down to Gazebo's camera default viewpoint, update the <code>z</code> of the <code>&lt;pos&gt;</code> tag to be the negative of the <code>Maximum</code> elevation (i.e., <code>&lt;pos&gt;0 0 -Maximum&lt;/pos&gt;</code>). Note when using seabed data (e.g., GEBCO), negate the <code>Minimum</code> instead.</p>
<p>The model should look similar to the following:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;half_dome&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">static</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">static</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;link&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">collision</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;collision&quot;</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">              &lt;<span class="keywordtype">heightmap</span>&gt;</div>
<div class="line">                  &lt;<span class="keywordtype">uri</span>&gt;<span class="keyword">half_dome.tif</span>&lt;/<span class="keywordtype">uri</span>&gt;</div>
<div class="line">                  <span class="comment">&lt;!-- gdalinfo -stats &lt;dem_file&gt; --&gt;</span></div>
<div class="line">                  &lt;<span class="keywordtype">size</span>&gt;3793 3563 1481.398&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">                  &lt;<span class="keywordtype">pos</span>&gt;0 0 -2694.987&lt;/<span class="keywordtype">pos</span>&gt; <span class="comment">&lt;!-- -(max or min elevation) --&gt;</span></div>
<div class="line">              &lt;/<span class="keywordtype">heightmap</span>&gt;</div>
<div class="line">          &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">collision</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">visual</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;visual&quot;</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">              &lt;<span class="keywordtype">heightmap</span>&gt;</div>
<div class="line">                  &lt;<span class="keywordtype">texture</span>&gt;</div>
<div class="line">                      &lt;<span class="keywordtype">diffuse</span>&gt;<span class="keyword">textures</span>/<span class="keyword">rocks_diffuse.png</span>&lt;/<span class="keywordtype">diffuse</span>&gt;</div>
<div class="line">                      &lt;<span class="keywordtype">normal</span>&gt;<span class="keyword">textures</span>/<span class="keyword">rocks_normal.png</span>&lt;/<span class="keywordtype">normal</span>&gt;</div>
<div class="line">                      &lt;<span class="keywordtype">size</span>&gt;250&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">                  &lt;/<span class="keywordtype">texture</span>&gt;</div>
<div class="line">                  &lt;<span class="keywordtype">blend</span>&gt;</div>
<div class="line">                      &lt;<span class="keywordtype">min_height</span>&gt;2&lt;/<span class="keywordtype">min_height</span>&gt;</div>
<div class="line">                      &lt;<span class="keywordtype">fade_dist</span>&gt;5&lt;/<span class="keywordtype">fade_dist</span>&gt;</div>
<div class="line">                  &lt;/<span class="keywordtype">blend</span>&gt;</div>
<div class="line">                  &lt;<span class="keywordtype">blend</span>&gt;</div>
<div class="line">                      &lt;<span class="keywordtype">min_height</span>&gt;4&lt;/<span class="keywordtype">min_height</span>&gt;</div>
<div class="line">                      &lt;<span class="keywordtype">fade_dist</span>&gt;5&lt;/<span class="keywordtype">fade_dist</span>&gt;</div>
<div class="line">                  &lt;/<span class="keywordtype">blend</span>&gt;</div>
<div class="line">                  &lt;<span class="keywordtype">uri</span>&gt;<span class="keyword">half_dome.tif</span>&lt;/<span class="keywordtype">uri</span>&gt;</div>
<div class="line">                  <span class="comment">&lt;!-- gdalinfo -stats &lt;dem_file&gt; --&gt;</span></div>
<div class="line">                  &lt;<span class="keywordtype">size</span>&gt;3793 3563 1481.398&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">                  &lt;<span class="keywordtype">pos</span>&gt;0 0 -2694.987&lt;/<span class="keywordtype">pos</span>&gt; <span class="comment">&lt;!-- -(min or max elevation) --&gt;</span></div>
<div class="line">              &lt;/<span class="keywordtype">heightmap</span>&gt;</div>
<div class="line">          &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">visual</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">link</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>To launch the completed demo yourself, <a href="files/digital_elevation_models/half_dome_example/">download the files here</a> then run:</p>
<div class="fragment"><div class="line">cd /path/to/half_dome_example/</div>
<div class="line"> </div>
<div class="line">gz sim -v 4 half_dome.sdf</div>
</div><!-- fragment --><div class="image">
<img src="gazebo_half_dome.png" alt="" width="80%"/>
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
