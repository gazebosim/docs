<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: Create an underwater vehicle</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        10.0.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Create an underwater vehicle</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="overview-12"></a>
Overview</h1>
<p>Gazebo now supports basic simulation of underwater vehicles. This capability is based on the equations described in Fossen's <a href="https://www.wiley.com/en-sg/Guidance+and+Control+of+Ocean+Vehicles-p-9780471941132">"Guidance and Control of Ocean Vehicles"</a>. This tutorial will guide you through the steps you need to setup simulation of an underwater vehicle. In this tutorial, we will guide you through the setup of the <a href="https://app.gazebosim.org/accurrent/fuel/models/MBARI%20Tethys%20LRAUV">MBARI LRAUV</a>.</p>
<h2><a class="anchor" id="related-tutorials-6"></a>
Related tutorials</h2>
<p><a class="el" href="create_vehicle.html">Create a maritime vehicle</a></p>
<p><a class="el" href="adding_visuals.html">Adding visuals</a></p>
<p><a class="el" href="frame_reference.html">Frame of reference</a></p>
<p><a class="el" href="adding_system_plugins.html">Adding system plugins</a></p>
<p><a class="el" href="theory_buoyancy.html">Buoyancy</a></p>
<p><a class="el" href="theory_hydrodynamics.html">Hydrodynamics</a></p>
<h1><a class="anchor" id="create-your-vehicle-2"></a>
Create your vehicle</h1>
<p>As an example, we'll go through the process of creating an MBARI LRAUV underwater vehicle.</p>
<p>Create a workspace to store your brand new model named <code>my_lrauv</code>.</p>
<div class="fragment"><div class="line">mkdir -p ~/gazebo_maritime/models/my_lrauv/materials/textures</div>
<div class="line">mkdir -p ~/gazebo_maritime/models/my_lrauv/meshes</div>
</div><!-- fragment --><p>Download all the files from here and copy them within that directory:</p>
<div class="fragment"><div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/model.config -O ~/gazebo_maritime/models/my_lrauv/model.config</div>
<div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/model.sdf -O ~/gazebo_maritime/models/my_lrauv/model.sdf</div>
<div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/materials/textures/Tethys_Albedo.png -O ~/gazebo_maritime/models/my_lrauv/materials/textures/Tethys_Albedo.png</div>
<div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/materials/textures/Tethys_Metalness.png -O ~/gazebo_maritime/models/my_lrauv/materials/textures/Tethys_Metalness.png</div>
<div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/materials/textures/Tethys_Normal.png -O ~/gazebo_maritime/models/my_lrauv/materials/textures/Tethys_Normal.png</div>
<div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/materials/textures/Tethys_Roughness.png -O ~/gazebo_maritime/models/my_lrauv/materials/textures/Tethys_Roughness.png</div>
<div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/meshes/base.dae -O ~/gazebo_maritime/models/my_lrauv/meshes/base.dae</div>
<div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/meshes/propeller.dae -O ~/gazebo_maritime/models/my_lrauv/meshes/propeller.dae</div>
<div class="line">wget -r https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/my_lrauv/meshes/tethys.dae -O ~/gazebo_maritime/models/my_lrauv/meshes/tethys.dae</div>
</div><!-- fragment --><p>Open with your favorite editor <code>~/gazebo_maritime/models/my_lrauv/model.sdf</code>.</p>
<p>Notice how the vehicle has been divided into multiple links: chassis, horizontal fins, vertical fins, and a propeller. This is a very common division in vehicles that contain one or more thrusters and some control surfaces. Both the propeller and the control surfaces are movable, thus we need to create separate links for them.</p>
<p>At the bottom of the <code>model.sdf</code> file, you'll find the three joints that connect the horizontal fins, vertical fins, and propeller to the main chassis respectively. All of them are <code>revolute</code> joints, but with different upper and lower limits. While the propeller does not have any limits (to allow infinite rotation), the fins have lower values to constraint the amount of movement of the fin. Again, this is a very common pattern that you'll need to configure based on the specs of your vehicle.</p>
<p>Let's run the simulation:</p>
<div class="fragment"><div class="line">gz sim ~/gazebo_maritime/models/my_lrauv/model.sdf</div>
</div><!-- fragment --><p>You should see Gazebo with your LRAUV loaded. If you hit play, your robot will sadly sink. The good news is that this is expected as we did not attach any plugins to the LRAUV model. Let's do that!</p>
<h1><a class="anchor" id="adding-buoyancy"></a>
Adding buoyancy</h1>
<p>The first thing we need to decide is how much buoyancy we want to provide to our vehicle. In the LRAUV case, we want a robot with neutral buoyancy. In other words, our robot should maintain depth when stationary.</p>
<p>Buoyancy works by opposing the weight of the vehicle. In order to compute the amount of buoyancy force, first we need to sum the total weight of our LRAUV. There's a total of <code>148.3571</code> kg (<code>147.8671</code> + <code>0.2</code> + <code>0.2</code> + <code>0.09</code> kgs) when we add the mass of the chassis, fins and propeller. The buoyancy force is proportional the volume of air in the vehicle according to this equation:</p>
<p>$$volume\_neutral = \frac{mass}{waterDensity}$$</p>
<p>In our case:</p>
<p>$$volume\_neutral = \frac{148.3571}{1000} = 0.1483571$$</p>
<p>That's the total volume of air that our vehicle should contain to keep the robot neutral. If the volume is smaller, the vehicle will sink. If the vehicle's volume is bigger, it will move up. The buoyancy plugin uses all the <code>&lt;collision&gt;</code> elements of the model to compute volume.</p>
<p>Let's verify the total amount of air volume in our vehicle adding up the volumes of all the collision elements:</p>
<p>$$volume = (2 * 0.3 * 0.2464451666666667) + (0.1 * 0.1 * 0.02) + (0.1 * 0.1 * 0.02) + (0.03 * 0.1 * 0.03) = 0.14835710000000002$$</p>
<p>This is the volume that we were looking for to achieve neutral buoyancy. Let's test it! Uncomment the lines in <code>model.sdf:18--24</code> to restore the buoyancy and launch the simulation:</p>
<p>Let's now download the following world that includes the buoyancy plugin:</p>
<div class="fragment"><div class="line">mkdir -p ~/gazebo_maritime/worlds</div>
<div class="line">wget https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim10/tutorials/files/underwater_vehicles/buoyant_lrauv.sdf -O ~/gazebo_maritime/worlds/buoyant_lrauv.sdf</div>
<div class="line">export GZ_SIM_RESOURCE_PATH=:$HOME/gazebo_maritime/models</div>
</div><!-- fragment --><p>And launch Gazebo:</p>
<div class="fragment"><div class="line">gz sim ~/gazebo_maritime/worlds/buoyant_lrauv.sdf</div>
</div><!-- fragment --><p>Now your LRAUV should stay in place! Let's experiment with the buoyancy values. Edit the <code>main_body_buoyancy</code> geometry in your <code>model.sdf</code> to be:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">box</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">size</span>&gt;2 0.3 0.24&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">box</span>&gt;</div>
</div><!-- fragment --><p>And now relaunch the simulation:</p>
<div class="fragment"><div class="line">gz sim ~/gazebo_maritime/worlds/buoyant_lrauv.sdf</div>
</div><!-- fragment --><p>Your LRAUV should slowly sink. Feel free to experiment with other buoyancy values but remember to restore the original value:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">box</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">size</span>&gt;2 0.3 0.2464451666666667&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">box</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="adding-thrusters"></a>
Adding thrusters</h1>
<p>We need the vehicle to move, so we will be adding the <code>Thruster</code> plugin. The thruster plugin takes in a force and applies it along with calculating the desired rpm. Uncomment the following block from your <code>buoyant_lrauv.sdf</code> world:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thruster-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Thruster&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">namespace</span>&gt;<span class="keyword">my_lrauv</span>&lt;/<span class="keywordtype">namespace</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">use_angvel_cmd</span>&gt;0&lt;/<span class="keywordtype">use_angvel_cmd</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">propeller_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">thrust_coefficient</span>&gt;0.004422&lt;/<span class="keywordtype">thrust_coefficient</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">fluid_density</span>&gt;1000&lt;/<span class="keywordtype">fluid_density</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">propeller_diameter</span>&gt;0.2&lt;/<span class="keywordtype">propeller_diameter</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>And start the simulation:</p>
<div class="fragment"><div class="line">gz sim -r ~/gazebo_maritime/worlds/buoyant_lrauv.sdf</div>
</div><!-- fragment --><p>Now if we were to publish to <code>/model/my_lrauv/joint/propeller_joint/cmd_thrust</code></p>
<div class="fragment"><div class="line">gz topic -t /model/my_lrauv/joint/propeller_joint/cmd_thrust -m gz.msgs.Double -p &#39;data: -15&#39;</div>
</div><!-- fragment --><p>We should see the model move. The thrusters are governed by the equation on page 246 of Fossen's book. In particular it relates force to rpm as follows:</p>
<p>$$thrust = fluid\_density * RPM^2 * thrust\_constant * propeller\_blade\_size^4$$</p>
<p>The plugin takes in commands in newtons. So if you have a different thrust curve you can still use the plugin with some type of adapter script. The thrust constant is normally determined by individual manufacturers. In this case we are using the LRAUV's thrust coefficient. you may also build a test rig to measure your thruster's thrust coefficient.</p>
<h1><a class="anchor" id="adding-hydrodynamics"></a>
Adding hydrodynamics</h1>
<p>You may notice that the robot now keeps getting faster and faster. This is because there is no drag to oppose the thruster's force. We will be using Fossen's equations which describe the motion of a craft through the water for this. For better understanding of the parameters here, I would refer you to his book. Usually these parameters can be found via fluid simulation programs or experimental tests in a water tub.</p>
<p>Uncomment the following block from <code>buoyant_lrauv.sdf</code> to enable hydrodynamics.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-hydrodynamics-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Hydrodynamics&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link_name</span>&gt;<span class="keyword">base_link</span>&lt;/<span class="keywordtype">link_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xDotU</span>&gt;-4.876161&lt;/<span class="keywordtype">xDotU</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">yDotV</span>&gt;-126.324739&lt;/<span class="keywordtype">yDotV</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">zDotW</span>&gt;-126.324739&lt;/<span class="keywordtype">zDotW</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">kDotP</span>&gt;0&lt;/<span class="keywordtype">kDotP</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">mDotQ</span>&gt;-33.46&lt;/<span class="keywordtype">mDotQ</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">nDotR</span>&gt;-33.46&lt;/<span class="keywordtype">nDotR</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xUabsU</span>&gt;-6.2282&lt;/<span class="keywordtype">xUabsU</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xU</span>&gt;0&lt;/<span class="keywordtype">xU</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">yVabsV</span>&gt;-601.27&lt;/<span class="keywordtype">yVabsV</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">yV</span>&gt;0&lt;/<span class="keywordtype">yV</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">zWabsW</span>&gt;-601.27&lt;/<span class="keywordtype">zWabsW</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">zW</span>&gt;0&lt;/<span class="keywordtype">zW</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">kPabsP</span>&gt;-0.1916&lt;/<span class="keywordtype">kPabsP</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">kP</span>&gt;0&lt;/<span class="keywordtype">kP</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">mQabsQ</span>&gt;-632.698957&lt;/<span class="keywordtype">mQabsQ</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">mQ</span>&gt;0&lt;/<span class="keywordtype">mQ</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">nRabsR</span>&gt;-632.698957&lt;/<span class="keywordtype">nRabsR</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">nR</span>&gt;0&lt;/<span class="keywordtype">nR</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="adding-control-surfaces"></a>
Adding control surfaces</h1>
<p>Just like aeroplanes, an underwater vehicle may also use fins for stability and control. Fortunately, Gazebo already has a version of the LiftDrag plugin. In this tutorial, we will simply add two liftdrag plugins to the rudder and elevator of MBARI's LRAUV. For more info about the liftdrag plugin including what the parameters mean, you may look at <a href="http://classic.gazebosim.org/tutorials?tut=aerodynamics&amp;cat=physics">this gazebo classic tutorial</a>. Essentially when we tilt the fins, we should experience a lift force which will cause the vehicle to experience a torque and the vehicle should start turning when we move.</p>
<p>These are the relevant blocks to enable the LiftDrag plugins. They're already attached to the model for you.</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Vertical fin --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-lift-drag-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::LiftDrag&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">air_density</span>&gt;1000&lt;/<span class="keywordtype">air_density</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cla</span>&gt;4.13&lt;/<span class="keywordtype">cla</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cla_stall</span>&gt;-1.1&lt;/<span class="keywordtype">cla_stall</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cda</span>&gt;0.2&lt;/<span class="keywordtype">cda</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cda_stall</span>&gt;0.03&lt;/<span class="keywordtype">cda_stall</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">alpha_stall</span>&gt;0.17&lt;/<span class="keywordtype">alpha_stall</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">a0</span>&gt;0&lt;/<span class="keywordtype">a0</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">area</span>&gt;0.0244&lt;/<span class="keywordtype">area</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">upward</span>&gt;0 1 0&lt;/<span class="keywordtype">upward</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">forward</span>&gt;1 0 0&lt;/<span class="keywordtype">forward</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link_name</span>&gt;<span class="keyword">vertical_fins</span>&lt;/<span class="keywordtype">link_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cp</span>&gt;0 0 0&lt;/<span class="keywordtype">cp</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line"> </div>
<div class="line"><span class="comment">&lt;!-- Horizontal fin --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-lift-drag-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::LiftDrag&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">air_density</span>&gt;1000&lt;/<span class="keywordtype">air_density</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cla</span>&gt;4.13&lt;/<span class="keywordtype">cla</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cla_stall</span>&gt;-1.1&lt;/<span class="keywordtype">cla_stall</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cda</span>&gt;0.2&lt;/<span class="keywordtype">cda</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cda_stall</span>&gt;0.03&lt;/<span class="keywordtype">cda_stall</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">alpha_stall</span>&gt;0.17&lt;/<span class="keywordtype">alpha_stall</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">a0</span>&gt;0&lt;/<span class="keywordtype">a0</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">area</span>&gt;0.0244&lt;/<span class="keywordtype">area</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">upward</span>&gt;0 0 1&lt;/<span class="keywordtype">upward</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">forward</span>&gt;1 0 0&lt;/<span class="keywordtype">forward</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link_name</span>&gt;<span class="keyword">horizontal_fins</span>&lt;/<span class="keywordtype">link_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">cp</span>&gt;0 0 0&lt;/<span class="keywordtype">cp</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>The numbers in this case were kindly provided by MBARI for the LRAUV. We also need to be able to control the position of the thruster fins so we will use the joint controller plugin. These are the relevant blocks to enable the control surfaces. They're already attached to the model for you.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-joint-position-controller-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::JointPositionController&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">horizontal_fins_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">p_gain</span>&gt;0.1&lt;/<span class="keywordtype">p_gain</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-joint-position-controller-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::JointPositionController&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">vertical_fins_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">p_gain</span>&gt;0.1&lt;/<span class="keywordtype">p_gain</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>Launch Gazebo:</p>
<div class="fragment"><div class="line">gz sim -r ~/gazebo_maritime/worlds/buoyant_lrauv.sdf</div>
</div><!-- fragment --><p>We should now be able to wiggle the fins using the following command:</p>
<div class="fragment"><div class="line">gz topic -t /model/my_lrauv/joint/vertical_fins_joint/0/cmd_pos -m gz.msgs.Double -p &#39;data: -0.17&#39;</div>
</div><!-- fragment --><p>Now apply some thrust:</p>
<div class="fragment"><div class="line">gz topic -t /model/my_lrauv/joint/propeller_joint/cmd_thrust -m gz.msgs.Double -p &#39;data: -15&#39;</div>
</div><!-- fragment --><div class="image">
<img src="lrauv_turn_left.png" alt=""/>
</div>
<p>And observe how the LRAUV turns due to the rudder's position. You can stop the propeller with:</p>
<div class="fragment"><div class="line">gz topic -t /model/my_lrauv/joint/propeller_joint/cmd_thrust -m gz.msgs.Double -p &#39;data: 0&#39;</div>
</div><!-- fragment --><p>And observe how eventually the LRAUV stops due to the water drag. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
