<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: md__2____w_2docs_2docs_2ws_2src_2gz-sim_2tutorials_2theory__hydrodynamics</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        9.0.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">md__2____w_2docs_2docs_2ws_2src_2gz-sim_2tutorials_2theory__hydrodynamics</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md384"></a>
Overview</h1>
<p><a class="anchor" id="theory_hydrodynamics"></a> This tutorial describes the theory of operation of the hydrodynamics plugin. It's heavily based on [3], and we recommend to read the full paper for a deeper understanding of its theory.</p>
<h1><a class="anchor" id="autotoc_md385"></a>
Understanding Hydrodynamic Forces</h1>
<p>The behavior of a moving body through water is different from the behavior of a ground based vehicle. In particular bodies moving underwater experience much more forces derived from drag, buoyancy and lift. The way these forces act on a body can be seen in the following diagram:</p>
<div class="image">
<img src="MBARI forces.png" alt=""/>
</div>
<h1><a class="anchor" id="autotoc_md386"></a>
The hydrodynamics plugin</h1>
<p>To approximate the motion of the vehicle in the ocean environment, we adapt Fossen’s six degree-of-freedom robot-like vectorial model for marine craft [2] expressed as</p>
<p>$$M ẍ + D(ẋ)ẋ + C(ẋ)ẋ = F$$</p>
<p>where <code>M</code> is the added mass matrix, <code>D(ẋ)</code> is the damping matrix, <code>C(ẋ)</code> is the Coriolis matrix, and <code>ẋ</code> is the velocity six-vector.</p>
<p>If present, ocean current is approximated by adding a term <code>vc</code> to the velocity:</p>
<p>$$M ẍ + D(ẋ − vc )(ẋ − vc ) + C(ẋ − vc )(ẋ − vc ) = F$$</p>
<p>The hydrodynamic forces include the added mass terms due to inertia of the surrounding fluid, the Coriolis-centripetal matrix for the added mass, and hydrodynamic damping. The hydrodynamic damping includes forces due to radiation-induced potential damping, skin friction, wave drift damping, vortex shedding and lifting forces. These effects are aggregated in the hydrodynamic damping matrix. This approximation of the hydrodynamic effects is implemented in this Gazebo plugin. The user defines the characteristics of the vessel under test through a vessel-specific configuration that includes the hydrodynamic derivatives. During each time step of the simulation, the plugin is executed with access to the state of the vessel and environment. The hydrodynamic force terms are calculated based on this state information and the user-defined vessel characteristics. The resulting force and moment values are then applied to the vessel through the Gazebo API for inclusion in the next iteration of the physics engine.</p>
<p>The parameters of the plugin are configured via SDF in the model file. The next table summarizes all the available SDF parameters.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;xDotU&gt;   </td><td class="markdownTableBodyNone">Added mass in surge    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;yDotV&gt;   </td><td class="markdownTableBodyNone">Added mass in sway    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;zDotW&gt;   </td><td class="markdownTableBodyNone">Added mass in heave    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;kDotP&gt;   </td><td class="markdownTableBodyNone">Added mass in roll    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mDotQ&gt;   </td><td class="markdownTableBodyNone">Added mass in pitch    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;nDotR&gt;   </td><td class="markdownTableBodyNone">Added mass in yaw    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;xUabsU&gt;   </td><td class="markdownTableBodyNone">Quadratic drag in surge    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;xU&gt;   </td><td class="markdownTableBodyNone">Linear drag in surge    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;yVabsV&gt;   </td><td class="markdownTableBodyNone">Quadratic drag in sway    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;yV&gt;   </td><td class="markdownTableBodyNone">Linear drag in sway    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;zWabsW&gt;   </td><td class="markdownTableBodyNone">Quadratic drag in heave    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;zW&gt;   </td><td class="markdownTableBodyNone">Linear drag in heave    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;kPabsP&gt;   </td><td class="markdownTableBodyNone">Quadratic drag in roll    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;kP&gt;   </td><td class="markdownTableBodyNone">Linear drag in roll    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mQabsQ&gt;   </td><td class="markdownTableBodyNone">Quadratic drag in pitch    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mQ&gt;   </td><td class="markdownTableBodyNone">Linear drag in pitch    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;nRabsR&gt;   </td><td class="markdownTableBodyNone">Quadratic drag in yaw    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;nR&gt;   </td><td class="markdownTableBodyNone">Linear drag in yaw    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;default_current&gt;   </td><td class="markdownTableBodyNone">Default ocean current vector   </td></tr>
</table>
<p><b>Note about added mass</b>: SDFormat also supports added mass natively. Until we deprecate the added mass parameters of this plugin, do not set the added mass parameters in both places, choose one (either in this plugin or under <code>&lt;inertial&gt;</code> of your link).</p>
<h1><a class="anchor" id="autotoc_md387"></a>
A simple example</h1>
<p>Let's download the provided <code>buoyant_cylinder.sdf</code> world and run to see an example of a cylinder with three plugins attached:</p>
<ul>
<li>Buoyancy: It will make the cylinder float on the surface of the water.</li>
<li>Hydrodynamics: It will simulate the damping generated by the fluid surrounding the cylinder.</li>
<li>Trajectory follower: It will apply some force to move the cylinder one meter in the positive <code>X</code> direction.</li>
</ul>
<div class="fragment"><div class="line">mkdir -p ~/gazebo_maritime/worlds</div>
<div class="line">wget https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim8/tutorials/files/theory_hydrodynamics/buoyant_cylinder.sdf -O ~/gazebo_maritime/worlds/buoyant_cylinder.sdf</div>
<div class="line">gz sim -r ~/gazebo_maritime/worlds/buoyant_cylinder.sdf</div>
</div><!-- fragment --><p>Observe how the cylinder does not sink, and slowly makes its way until it reaches (1, 0, 0) in world coordinates.</p>
<p>Now let's make a change in the hydrodynamics parameters. Considering that the model only moves in <code>X</code> direction (or surge in the maritime terminology), we're going to reduce the value of <code>&lt;xUabsU&gt;</code> and <code>&lt;xU&gt;</code> parameters. Update these parameters to:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">xUabsU</span>&gt;-0.32282&lt;/<span class="keywordtype">xUabsU</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">xU</span>&gt;-2.5&lt;/<span class="keywordtype">xU</span>&gt;</div>
</div><!-- fragment --><p>And run Gazebo again:</p>
<div class="fragment"><div class="line">gz sim -r ~/gazebo_maritime/worlds/buoyant_cylinder.sdf</div>
</div><!-- fragment --><p>Notice how the vehicle does not stop at the 1 meter mark. Instead, the cylinder stops further. This is because we lowered the linear and quadratic drag in the direction that the model is moving.</p>
<p>Let's now try the opposite. Go ahead and update the same parameters to the following values:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">xUabsU</span>&gt;-3.5&lt;/<span class="keywordtype">xUabsU</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">xU</span>&gt;-20&lt;/<span class="keywordtype">xU</span>&gt;</div>
</div><!-- fragment --><p>And run Gazebo:</p>
<div class="fragment"><div class="line">gz sim -r ~/gazebo_maritime/worlds/buoyant_cylinder.sdf</div>
</div><!-- fragment --><p>See how slow the cylinder moves. With these set of parameters we increased the damping in the surge axis, causing the vehicle to slowly move towards its goal.</p>
<h1><a class="anchor" id="autotoc_md388"></a>
Experimental - How to tune the parameters</h1>
<p>The hydrodynamics plugin requires a large number of parameters to model the added mass and drag behaviors of underwater vehicles. This section describes a method to generate an initial set of parameters for the hydrodynamics plugin. Note these parameters need to be tested and possibly tweaked to guarantee model stability.</p>
<h2><a class="anchor" id="autotoc_md389"></a>
Added mass</h2>
<p>A python library called <a href="https://github.com/capytaine/capytaine">Capytaine</a> can be used to determine the added mass matrix of your vehicle. Capytaine enables the user to import a mesh (.stl), define a set of linear potential flow problems and solve these using the included Boundary Element Method (BEM) solver.</p>
<p>Capytaine is typically used to model the interaction between floating bodies and waves, however it can be applied to ROVs by setting the wave frequency and free surface both to infinity (this assumes that the added mass is approximately constant since the ROV does not operate near the wave zone and that it operates in infinitely deep water respectively) [1] (p.14), [2] (p.18).</p>
<p>Furthermore, it is recommended to use a simplified mesh when computing the added mass with Capytaine, since a complex mesh is computationally prohibitive.</p>
<h2><a class="anchor" id="autotoc_md390"></a>
Linear and quadratic damping</h2>
<p>Computing the linear and quadratic damping coefficients is generally not possible using computational analysis and is usually done experimentally [1] (p.28). If determining the damping coefficients experimentally is not feasible, the same method described by Berg2012 can be used to estimate these values from a similar ROV [1] (p.28-31).</p>
<h1><a class="anchor" id="autotoc_md391"></a>
References</h1>
<p>[1] BERG, V. Development and Commissioning of a DP system for ROV SF 30k, 2012.</p>
<p>[2] FOSSEN , T. I. Lecture notes: Ttk 4190 guidance, navigation and control of vehicles, February 2021.</p>
<p>[3] BINGHAM, B. et al., Toward Maritime Robotic Simulation in Gazebo, Oceans Conference, 2019. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
