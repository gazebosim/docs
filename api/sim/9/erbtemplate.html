<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: ERB Template</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        9.4.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">ERB Template</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial shows how to use ERB to generate simulation world files. <a href="https://docs.ruby-lang.org/en/2.3.0/ERB.html">ERB</a> is the commonly used templating language to generate structured text files with Ruby code. In this case, since most simulation world used in gazebo is defined with <a href="http://sdformat.org/">SDFormat</a>, ERB works conveniently.</p>
<h2><a class="anchor" id="why-erb"></a>
Why ERB</h2>
<p>There are many use cases and advantages of using ERB in your SDF file. Some of them are listed below and demonstrated in this <a href="https://github.com/osrf/srcsim/blob/master/worlds/unique.world.erb">example ERB file</a>:</p>
<ol type="1">
<li>Embedding logic into the SDF, such as loops and conditionals</li>
<li>Full access to Ruby's math library, for simple things like PI, to more elaborate ones like matrices and randomization</li>
<li>Breaking the SDF into multiple smaller files for better organization</li>
<li>Placing multiple instances of the same model into simulation world without manually copy-pasting every tag</li>
</ol>
<h2><a class="anchor" id="set-up-ruby"></a>
Set up Ruby</h2>
<p>Firstly, Ruby needs to be installed. If you have gone through <a href="https://gazebosim.org/docs/latest/install">Gazebo Sim's installation guide</a>, it's most likely you already have Ruby installed. To check if Ruby is installed, use </p><div class="fragment"><div class="line">ruby --version</div>
</div><!-- fragment --><p> If it is not found, run the following to install Ruby</p>
<div class="fragment"><div class="line">sudo apt-get install -y ruby</div>
</div><!-- fragment --><h2><a class="anchor" id="create-an-erb-template"></a>
Create an ERB template</h2>
<p>To make a distinction between ERB templates and normal sdformat files, <code>.erb</code> is commonly used as file suffix. ERB language is usually embedded in the SDF file. Below is a step-by-step tutorial to generate 1000 box shapes in a simulation world using ERB template. You can copy-and-paste the code block into an editor to try it out.</p>
<p>First is to create a world using SDFormat syntax. You need to specify both the <code>xml</code> and <code>sdf</code> versions you are using. And don't forget to give your simulation world a name.</p>
<div class="fragment"><div class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</div>
<div class="line">&lt;sdf version=&quot;1.6&quot;&gt;</div>
<div class="line">  &lt;world name=&quot;shapes&quot;&gt;</div>
<div class="line">    &lt;!-- This is where you put `&lt;plugin&gt;`, `&lt;model&gt;` and etc. tags --&gt;</div>
<div class="line">  &lt;/world&gt;</div>
<div class="line">&lt;/sdf&gt;</div>
</div><!-- fragment --><p>To create 1000 instances of simple box shapes, you can use a <code>for</code> loop in Ruby syntax in the ERB template. This code block can be inserted in between the <code>&lt;world&gt;</code> tags. Note that the <code>&lt;model&gt;</code> tags are wrapped in between the ERB template. <code>&lt;% end %&gt;</code> is to mark the end of loops or <code>if</code> statements. Each box model also has a different name and pose to ensure they show up as individuals in simulation.</p>
<div class="fragment"><div class="line">&lt;%</div>
<div class="line">  # number of population</div>
<div class="line">  n = 1000</div>
<div class="line">  for m in (0..n)</div>
<div class="line">%&gt;</div>
<div class="line"> </div>
<div class="line">&lt;model name=&quot;box_&lt;%= m.to_s %&gt;&quot;&gt;</div>
<div class="line">  &lt;pose&gt;&lt;%= -750 + m*1.5 %&gt; 0 0.5 0 0 0&lt;/pose&gt;</div>
<div class="line">  &lt;link name=&quot;box_link&quot;&gt;</div>
<div class="line">    &lt;inertial&gt;</div>
<div class="line">      &lt;inertia&gt;</div>
<div class="line">        &lt;ixx&gt;1&lt;/ixx&gt;</div>
<div class="line">        &lt;ixy&gt;0&lt;/ixy&gt;</div>
<div class="line">        &lt;ixz&gt;0&lt;/ixz&gt;</div>
<div class="line">        &lt;iyy&gt;1&lt;/iyy&gt;</div>
<div class="line">        &lt;iyz&gt;0&lt;/iyz&gt;</div>
<div class="line">        &lt;izz&gt;1&lt;/izz&gt;</div>
<div class="line">      &lt;/inertia&gt;</div>
<div class="line">      &lt;mass&gt;1.0&lt;/mass&gt;</div>
<div class="line">    &lt;/inertial&gt;</div>
<div class="line">    &lt;collision name=&quot;box_collision&quot;&gt;</div>
<div class="line">      &lt;geometry&gt;</div>
<div class="line">        &lt;box&gt;</div>
<div class="line">          &lt;size&gt;1 1 1&lt;/size&gt;</div>
<div class="line">        &lt;/box&gt;</div>
<div class="line">      &lt;/geometry&gt;</div>
<div class="line">    &lt;/collision&gt;</div>
<div class="line"> </div>
<div class="line">    &lt;visual name=&quot;box_visual&quot;&gt;</div>
<div class="line">      &lt;geometry&gt;</div>
<div class="line">        &lt;box&gt;</div>
<div class="line">          &lt;size&gt;1 1 1&lt;/size&gt;</div>
<div class="line">        &lt;/box&gt;</div>
<div class="line">      &lt;/geometry&gt;</div>
<div class="line">      &lt;material&gt;</div>
<div class="line">        &lt;ambient&gt;1 0 0 1&lt;/ambient&gt;</div>
<div class="line">        &lt;diffuse&gt;1 0 0 1&lt;/diffuse&gt;</div>
<div class="line">        &lt;specular&gt;1 0 0 1&lt;/specular&gt;</div>
<div class="line">      &lt;/material&gt;</div>
<div class="line">    &lt;/visual&gt;</div>
<div class="line">  &lt;/link&gt;</div>
<div class="line">&lt;/model&gt;</div>
<div class="line">&lt;%</div>
<div class="line">  end</div>
<div class="line">%&gt;</div>
</div><!-- fragment --><p><a href="https://github.com/gazebosim/gz-sim/blob/main/examples/worlds/shapes_population.sdf.erb">Here</a> is a complete shapes simulation world example.</p>
<p>Instead of simple shapes, you can also use a nested loop to generate 100 actors spaced out evenly in a simulation world.</p>
<div class="fragment"><div class="line">&lt;%</div>
<div class="line">  # number of population</div>
<div class="line">  total = 10</div>
<div class="line">  for i in (0..total-1)</div>
<div class="line">    for j in (1..total)</div>
<div class="line">%&gt;</div>
<div class="line"> </div>
<div class="line">&lt;actor name=&quot;actor_&lt;%= 10*i+j %&gt;&quot;&gt;</div>
<div class="line">    &lt;skin&gt;</div>
<div class="line">    &lt;filename&gt;https://fuel.gazebosim.org/1.0/Mingfei/models/actor/tip/files/meshes/talk_b.dae&lt;/filename&gt;</div>
<div class="line">    &lt;scale&gt;1.0&lt;/scale&gt;</div>
<div class="line">    &lt;/skin&gt;</div>
<div class="line">    &lt;animation name=&quot;talk_b&quot;&gt;</div>
<div class="line">    &lt;filename&gt;https://fuel.gazebosim.org/1.0/Mingfei/models/actor/tip/files/meshes/talk_b.dae&lt;/filename&gt;</div>
<div class="line">    &lt;scale&gt;0.055&lt;/scale&gt;</div>
<div class="line">    &lt;interpolate_x&gt;true&lt;/interpolate_x&gt;</div>
<div class="line">    &lt;/animation&gt;</div>
<div class="line">    &lt;script&gt;</div>
<div class="line">    &lt;loop&gt;true&lt;/loop&gt;</div>
<div class="line">    &lt;auto_start&gt;true&lt;/auto_start&gt;</div>
<div class="line">    &lt;trajectory id=&quot;&lt;%= 10*i+j %&gt;&quot; type=&quot;talk_b&quot;&gt;</div>
<div class="line">        &lt;waypoint&gt;</div>
<div class="line">        &lt;time&gt;0&lt;/time&gt;</div>
<div class="line">        &lt;pose&gt;&lt;%= -5 + 2*j %&gt; &lt;%= 5 + -2*i %&gt; 1.0 0 0 0&lt;/pose&gt;</div>
<div class="line">        &lt;/waypoint&gt;</div>
<div class="line">        &lt;waypoint&gt;</div>
<div class="line">        &lt;time&gt;30&lt;/time&gt;</div>
<div class="line">        &lt;pose&gt;&lt;%= -5 + 2*j %&gt; &lt;%= 5 + -2*i %&gt; 1.0 0 0 0&lt;/pose&gt;</div>
<div class="line">        &lt;/waypoint&gt;</div>
<div class="line">    &lt;/trajectory&gt;</div>
<div class="line">    &lt;/script&gt;</div>
<div class="line">&lt;/actor&gt;</div>
<div class="line"> </div>
<div class="line">&lt;%</div>
<div class="line">    end</div>
<div class="line">  end</div>
<div class="line">%&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="generate-sdf-from-erb-template"></a>
Generate SDF from ERB template</h2>
<p>Now that an ERB template file is ready and saved as <code>my_first_erb.erb</code>, you can run the following terminal command to generate the corresponding SDF file.</p>
<div class="fragment"><div class="line"># generate SDF with the ERB template</div>
<div class="line">erb my_first_erb.erb &gt; my_first_erb.sdf</div>
</div><!-- fragment --><h2><a class="anchor" id="run-simulation-world"></a>
Run simulation world</h2>
<p>To test if the ERB template works, run the SDF file with the <code>gz sim</code> command</p>
<div class="fragment"><div class="line"># run with Gazebo</div>
<div class="line">gz sim my_first_erb.sdf</div>
</div><!-- fragment --><p>If there are any errors or warnings from running the SDF file, you would need to go back to the ERB file and see if any coding mistakes were made. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
