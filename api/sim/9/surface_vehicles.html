<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: Create a surface vehicle</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        9.4.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Create a surface vehicle</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="overview-8"></a>
Overview</h1>
<p>This tutorial explains how to create and load a maritime surface vehicle in Gazebo. This type of vehicle usually has multiple thrusters and navigate with the presence of waves and wind.</p>
<h2><a class="anchor" id="related-tutorials-5"></a>
Related tutorials</h2>
<p><a class="el" href="create_vehicle.html">Create a maritime vehicle</a></p>
<p><a class="el" href="adding_visuals.html">Adding visuals</a></p>
<p><a class="el" href="frame_reference.html">Frame of reference</a></p>
<p><a class="el" href="adding_system_plugins.html">Adding system plugins</a></p>
<p><a class="el" href="theory_hydrodynamics.html">Hydrodynamics</a></p>
<h1><a class="anchor" id="adding-an-environment"></a>
Adding an environment</h1>
<p>We'll start this tutorial creating a workspace with some custom models, worlds, and plugins that are not available yet on Gazebo. You could use this workspace as a template when in need of customizing Gazebo for your needs.</p>
<p>To compile all the custom libraries in the right order <code>colcon</code> is recommended. The <code>colcon</code> tool is available on all platforms using <code>pip3</code>.</p>
<div class="fragment"><div class="line">wget https://raw.githubusercontent.com/gazebosim/gz-sim/gz-sim8/tutorials/files/surface_vehicles/gz_maritime_ws.zip -O ~/gz_maritime_ws.zip</div>
<div class="line">unzip ~/gz_maritime_ws.zip</div>
</div><!-- fragment --><h2><a class="anchor" id="generic-tools"></a>
Generic tools</h2>
<p>Install tools needed by this tutorial:</p>
<div class="fragment"><div class="line">sudo apt install python3-pip wget</div>
<div class="line">pip3 install -U colcon-common-extensions</div>
</div><!-- fragment --><h2><a class="anchor" id="setup-the-workspace"></a>
Setup the workspace</h2>
<p>Let's now build our workspace:</p>
<div class="fragment"><div class="line">cd ~/gazebo_maritime_ws</div>
<div class="line">colcon build --merge-install</div>
<div class="line">export GZ_SIM_RESOURCE_PATH=$GZ_SIM_RESOURCE_PATH:~/gazebo_maritime_ws/install/share/gazebo_maritime/models</div>
<div class="line">export GZ_SIM_SYSTEM_PLUGIN_PATH=$GZ_SIM_SYSTEM_PLUGIN_PATH:~/gazebo_maritime_ws/install/lib</div>
<div class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:~/gazebo_maritime_ws/install/lib</div>
</div><!-- fragment --><p>And run the simulation:</p>
<div class="fragment"><div class="line">gz sim -r src/gazebo_maritime/worlds/sydney_regatta.sdf</div>
</div><!-- fragment --><div class="image">
<img src="sydney_regatta.png" alt=""/>
</div>
<p>Gazebo is loaded with the Sydney Regatta Center!</p>
<h1><a class="anchor" id="create-your-vehicle-1"></a>
Create your vehicle</h1>
<p>It's time to create our maritime surface vehicle. We're going to use the Wave Adaptive Modular Vehicle (WAM-V) as the surface platform. This is the robot that we use in the <a href="https://github.com/osrf/vrx">VRX project</a> as well.</p>
<h2><a class="anchor" id="basic-sdf-1"></a>
Basic SDF</h2>
<p>Let's start with the basic SDF of the WAM-V platform. Open with your favorite editor the file <code>~/gazebo_maritime_ws/src/gazebo_maritime/models/wam-v/model.sdf</code>.</p>
<p>Notice how the vehicle is composed by multiple links:</p>
<div class="fragment"><div class="line">wam-v</div>
<div class="line">└────────────────────────────── base_link</div>
<div class="line">  left_chasis_engine_joint└─────── left_engine_link</div>
<div class="line">     left_engine_propeller_joint└─────── left_propeller_link</div>
<div class="line"> </div>
<div class="line">  right_chasis_engine_joint└─────── right_engine_link</div>
<div class="line">    right_engine_propeller_joint└─────── right_propeller_link</div>
</div><!-- fragment --><p>The main chassis with the two rigid pontoons are captured by <code>base_link</code>. A revolute joint (<code>left_chasis_engine_joint</code>) connects the chasis and the <code>left_engine_link</code>. The purpose of this connection is to allow the engine to rotate. This is an additional degree of freedom that we expose to make the thruster control more flexible. Then, the <code>left_engine_link</code> is connected to the <code>left_propeller_link</code> via the revolute joint <code>left_engine_propeller_joint</code>. The purpose of this connection is to allow the propeller to spin. This kinematic structure is repeated on the right side.</p>
<p>Uncomment now the following block in the <code>sydney_regatta.sdf</code> file:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Uncomment this block to load the WAM-V model--&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">include</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">name</span>&gt;<span class="keyword">wam-V</span>&lt;/<span class="keywordtype">name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">pose</span>&gt;-532 162 0 0 0 1&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">uri</span>&gt;<span class="keyword">wam-v</span>&lt;/<span class="keywordtype">uri</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">include</span>&gt;</div>
</div><!-- fragment --><p>And launch Gazebo:</p>
<div class="fragment"><div class="line">gz sim src/gazebo_maritime/worlds/sydney_regatta.sdf</div>
</div><!-- fragment --><div class="image">
<img src="wamv.png" alt=""/>
</div>
<p>If you hit play, your WAM-V will sink (sad but expected). There's no buoyancy enabled yet.</p>
<h2><a class="anchor" id="checking-frame-of-reference-1"></a>
Checking frame of reference</h2>
<p>Launch your world in Gazebo as we did before:</p>
<div class="fragment"><div class="line">gz sim src/gazebo_maritime/worlds/sydney_regatta.sdf</div>
</div><!-- fragment --><p>You can visualize the frame of reference of your vehicle by loading the plugin <code>Transform Control</code> from the GUI.</p>
<div class="image">
<img src="gui_transform_control.png" alt=""/>
</div>
<p>Then, click on the vehicle, and then, click on the <code>Translate mode</code> icon. You'll now visualize your WAM-V frame of reference. As this is the expected frame of reference, we won't need to apply changes in the COLLADA mesh or add any <code>&lt;pose&gt;</code> offset to our <code>model.sdf</code>.</p>
<div class="image">
<img src="wamv_reference_frame.png" alt=""/>
</div>
<h2><a class="anchor" id="adding-plugins-1"></a>
Adding plugins</h2>
<h3><a class="anchor" id="the-surface-plugin"></a>
The Surface plugin</h3>
<p>Normally, there's a section here where we explain how to add buoyancy to our model. It's totally possible to do it that way but for stability reasons, we have created a more specific plugin to simulate buoyancy in the presence of waves, the <code>Surface</code> plugin.</p>
<p>Open the file <code>~/gazebo_maritime_ws/src/gazebo_maritime/models/wam-v/model.sdf</code> with your favorite editor and look at the <code>Surface</code> plugin:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Uncomment to produce buoyancy on the left hull --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;libSurface.so&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;maritime::Surface&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link_name</span>&gt;<span class="keyword">base_link</span>&lt;/<span class="keywordtype">link_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">hull_length</span>&gt;4.9&lt;/<span class="keywordtype">hull_length</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">hull_radius</span>&gt;0.213&lt;/<span class="keywordtype">hull_radius</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">fluid_level</span>&gt;0&lt;/<span class="keywordtype">fluid_level</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">points</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">point</span>&gt;0.6 1.03 0&lt;/<span class="keywordtype">point</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">point</span>&gt;-1.4 1.03 0&lt;/<span class="keywordtype">point</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">points</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">wavefield</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">topic</span>&gt;/<span class="keyword">gazebo</span>/<span class="keyword">wavefield</span>/<span class="keyword">parameters</span>&lt;/<span class="keywordtype">topic</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">wavefield</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>Before we go into the weeds of the plugin, you can guess from the comment that this plugin simulates the buoyancy generated by the left pontoon. A very similar plugin is attached to the right pontoon.</p>
<p>The <code>Surface</code> plugin simulates the buoyancy of an object at the surface of a fluid. This system/plugin must be attached to a model and the system applies buoyancy to a collection of points around a given link.</p>
<p>This plugin models the vehicle's buoyancy assuming a single hull with a cylindrical shape. You can instantiate multiple plugins when your vehicle has multiple pontoons.</p>
<p>This plugin also supports waves. If you provide a wavefield topic via SDF, the plugin will receive the wavefield parameters and account for the delta Z that the waves generate at each point.</p>
<p>Here are the detailed parameters:</p>
<ul>
<li><code>&lt;link_name&gt;</code> is the name of the link used to apply forces.</li>
<li>[Optional] <code>&lt;hull_length&gt;</code> is the length of the vessel [m].</li>
<li>[Optional] <code>&lt;hull_radius&gt;</code> is the radius of the vessel's hull [m].</li>
<li>[Optional] <code>&lt;fluid_level&gt;</code> is the depth at which the fluid should be in the vehicle</li>
<li>[Optional] <code>&lt;fluid_density&gt;</code> is the density of the fluid.</li>
<li>[Optional] <code>&lt;points&gt;</code> contains a collection of points where the forces generated by this plugin will be applied. See the format of each point next:</li>
<li>[Optional] <code>&lt;points&gt;&lt;point&gt;</code> Relative position of the point relative to <code>link_name</code>.</li>
<li>[Optional] <code>&lt;wavefield&gt;</code>: The wavefield parameters. See <code>~/gazebo_maritime_ws/src/gazebo_maritime/src/Wavefield.hh</code>.</li>
</ul>
<p>Go ahead and uncomment the two blocks in <code>~/gazebo_maritime_ws/src/gazebo_maritime/models/wam-v/model.sdf</code> to instantiate the <code>Surface</code> plugins and see the effect on your WAM-V:</p>
<div class="fragment"><div class="line">colcon build --merge-install</div>
<div class="line">gz sim -r src/gazebo_maritime/worlds/sydney_regatta.sdf</div>
</div><!-- fragment --><p>Now your vehicle is floating in the water!</p>
<h3><a class="anchor" id="hydrodynamics-1"></a>
Hydrodynamics</h3>
<p>I know, I know, it looks like a dancing catamaran. The reason for that behavior is because we don't have any drag yet to oppose the forces of the <code>Surface</code> plugins. We need hydrodynamics!</p>
<p>We will be using Fossen's equations which describe the motion of a craft through the water for this. For better understanding of the parameters here, I would refer you to <a href="https://www.wiley.com/en-sg/Guidance+and+Control+of+Ocean+Vehicles-p-9780471941132">his book</a> (check your library). Usually these parameters can be found via fluid simulation programs or experimental tests in a water tub.</p>
<p>Uncomment the following block from <code>~/gazebo_maritime_ws/src/gazebo_maritime/models/wam-v/model.sdf</code> to enable hydrodynamics.</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Hydrodynamics --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-hydrodynamics-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Hydrodynamics&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link_name</span>&gt;<span class="keyword">base_link</span>&lt;/<span class="keywordtype">link_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xDotU</span>&gt;0.0&lt;/<span class="keywordtype">xDotU</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">yDotV</span>&gt;0.0&lt;/<span class="keywordtype">yDotV</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">nDotR</span>&gt;0.0&lt;/<span class="keywordtype">nDotR</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xU</span>&gt;-51.3&lt;/<span class="keywordtype">xU</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xAbsU</span>&gt;-72.4&lt;/<span class="keywordtype">xAbsU</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">yV</span>&gt;-40.0&lt;/<span class="keywordtype">yV</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">yAbsV</span>&gt;0.0&lt;/<span class="keywordtype">yAbsV</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">zW</span>&gt;-500.0&lt;/<span class="keywordtype">zW</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">kP</span>&gt;-50.0&lt;/<span class="keywordtype">kP</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">mQ</span>&gt;-50.0&lt;/<span class="keywordtype">mQ</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">nR</span>&gt;-400.0&lt;/<span class="keywordtype">nR</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">nAbsR</span>&gt;0.0&lt;/<span class="keywordtype">nAbsR</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>And run Gazebo:</p>
<div class="fragment"><div class="line">colcon build --merge-install</div>
<div class="line">gz sim -r src/gazebo_maritime/worlds/sydney_regatta.sdf</div>
</div><!-- fragment --><p>The WAM-V is much more stable now and see how it moves following the movement of the waves.</p>
<p>You could experiment with the wavefield parameters to see different behaviors of the WAM-V floating on the waves. For example, update the following block in the <code>~/gazebo_maritime_ws/src/gazebo_maritime/worlds/sydney_regatta.sdf</code> world file:</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- The wave field --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">plugin</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;libPublisherPlugin.so&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;maritime::PublisherPlugin&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">message</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Param&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/gazebo/wavefield/parameters&quot;</span></div>
<div class="line">           <span class="keyword">every</span>=<span class="stringliteral">&quot;2.0&quot;</span>&gt;</div>
<div class="line">    <span class="keyword">params</span> {</div>
<div class="line">      <span class="keyword">key:</span> <span class="stringliteral">&quot;direction&quot;</span></div>
<div class="line">      <span class="keyword">value</span> {</div>
<div class="line">        <span class="keyword">type:</span> <span class="keyword">DOUBLE</span></div>
<div class="line">        <span class="keyword">double_value:</span> 0.0</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">params</span> {</div>
<div class="line">      <span class="keyword">key:</span> <span class="stringliteral">&quot;gain&quot;</span></div>
<div class="line">      <span class="keyword">value</span> {</div>
<div class="line">        <span class="keyword">type:</span> <span class="keyword">DOUBLE</span></div>
<div class="line">        <span class="keyword">double_value:</span> 0.8</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">params</span> {</div>
<div class="line">      <span class="keyword">key:</span> <span class="stringliteral">&quot;period&quot;</span></div>
<div class="line">      <span class="keyword">value</span> {</div>
<div class="line">        <span class="keyword">type:</span> <span class="keyword">DOUBLE</span></div>
<div class="line">        <span class="keyword">double_value:</span> 5</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">params</span> {</div>
<div class="line">      <span class="keyword">key:</span> <span class="stringliteral">&quot;steepness&quot;</span></div>
<div class="line">      <span class="keyword">value</span> {</div>
<div class="line">        <span class="keyword">type:</span> <span class="keyword">DOUBLE</span></div>
<div class="line">        <span class="keyword">double_value:</span> 0</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  &lt;/<span class="keywordtype">message</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>The gain parameter has been increased to <code>0.8</code> producing bigger waves. You should expect your WAM-V to move more agresively up and down.</p>
<p>Both the <code>WaveVisual</code> plugin (used for rendering the waves) and the <code>Surface</code> plugin (used to simulate the physics of the waves) are updated via the same topic. The <code>PublisherPlugin</code> periodically publishes the wavefield parameters to make sure that all the wave-related plugins work with the same wavefield parameters.</p>
<h3><a class="anchor" id="thruster"></a>
Thruster</h3>
<p>We need the vehicle to move, so we will be adding the <code>Thruster</code> plugin. In the case of the WAM-V, we need two thrusters. Each thruster plugin takes in a force and applies it along with calculating the desired rpm. Uncomment the following block from your <code>~/gazebo_maritime_ws/src/gazebo_maritime/models/wam-v/model.sdf</code> model:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thruster-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Thruster&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">left_engine_propeller_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">thrust_coefficient</span>&gt;0.004422&lt;/<span class="keywordtype">thrust_coefficient</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">fluid_density</span>&gt;1000&lt;/<span class="keywordtype">fluid_density</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">propeller_diameter</span>&gt;0.2&lt;/<span class="keywordtype">propeller_diameter</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">velocity_control</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">velocity_control</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-joint-position-controller-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::JointPositionController&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">left_chasis_engine_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">use_velocity_commands</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">use_velocity_commands</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">topic</span>&gt;/<span class="keyword">wamv</span>/<span class="keyword">left</span>/<span class="keyword">thruster</span>/<span class="keyword">joint</span>/<span class="keyword">cmd_pos</span>&lt;/<span class="keywordtype">topic</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thruster-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Thruster&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">right_engine_propeller_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">thrust_coefficient</span>&gt;0.004422&lt;/<span class="keywordtype">thrust_coefficient</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">fluid_density</span>&gt;1000&lt;/<span class="keywordtype">fluid_density</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">propeller_diameter</span>&gt;0.2&lt;/<span class="keywordtype">propeller_diameter</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">velocity_control</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">velocity_control</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-joint-position-controller-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::JointPositionController&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">right_chasis_engine_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">use_velocity_commands</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">use_velocity_commands</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">topic</span>&gt;/<span class="keyword">wamv</span>/<span class="keyword">right</span>/<span class="keyword">thruster</span>/<span class="keyword">joint</span>/<span class="keyword">cmd_pos</span>&lt;/<span class="keywordtype">topic</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>And start Gazebo again:</p>
<div class="fragment"><div class="line">colcon build --merge-install</div>
<div class="line">gz sim -r src/gazebo_maritime/worlds/sydney_regatta.sdf</div>
</div><!-- fragment --><p>Send a command to rotate the left thruster:</p>
<div class="fragment"><div class="line">gz topic -t /wamv/left/thruster/joint/cmd_pos -m gz.msgs.Double -p &#39;data: -0.15&#39;</div>
</div><!-- fragment --><p>Send a command to spin the right propeler:</p>
<div class="fragment"><div class="line">gz topic -t /model/wam-V/joint/right_engine_propeller_joint/cmd_thrust -m gz.msgs.Double -p &#39;data: 10.00&#39;</div>
</div><!-- fragment --><p>And see how your WAM-V starts moving, bon voyage! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
