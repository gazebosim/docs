<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: Triggered Publisher</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        8.6.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Triggered Publisher </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>TriggeredPublisher</code> system publishes a user specified message on an output topic in response to an input message that matches user specified criteria. It can also call a user specified service in response to an input message. The system works by checking the input against a set of Matchers. Matchers contain string representations of protobuf messages which are compared for equality or containment with the input message. Matchers can match the whole input message or only a specific field inside the message.</p>
<p>This tutorial describes how the Triggered Publisher system can be used to cause a box to fall from its initial position by detaching a detachable joint in response to the motion of a vehicle. The tutorial also covers how Triggered Publisher systems can be chained together by showing how the falling of the box can trigger another box to fall. Last, it covers how a service call can be triggered to reset the robot pose. The finished world SDFormat file for this tutorial can be found in <a href="https://github.com/gazebosim/gz-sim/blob/gz-sim8/examples/worlds/triggered_publisher.sdf">examples/worlds/triggered_publisher.sdf</a></p>
<p>We will use the differential drive vehicle from <a href="https://github.com/gazebosim/gz-sim/blob/gz-sim8/examples/worlds/diff_drive.sdf">examples/worlds/diff_drive.sdf</a>, but modify the input topic of the <code>DiffDrive</code> system to <code>cmd_vel</code>. A snippet of the change to the <code>DiffDrive</code> system is shown below:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&#39;vehicle_blue&#39;</span>&gt;</div>
<div class="line">  ...</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">plugin</span></div>
<div class="line">    <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-diff-drive-system&quot;</span></div>
<div class="line">    <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::DiffDrive&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">left_joint</span>&gt;<span class="keyword">front_left_wheel_joint</span>&lt;/<span class="keywordtype">left_joint</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">left_joint</span>&gt;<span class="keyword">rear_left_wheel_joint</span>&lt;/<span class="keywordtype">left_joint</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">right_joint</span>&gt;<span class="keyword">front_right_wheel_joint</span>&lt;/<span class="keywordtype">right_joint</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">right_joint</span>&gt;<span class="keyword">rear_right_wheel_joint</span>&lt;/<span class="keywordtype">right_joint</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">wheel_separation</span>&gt;1.25&lt;/<span class="keywordtype">wheel_separation</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">wheel_radius</span>&gt;0.3&lt;/<span class="keywordtype">wheel_radius</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">topic</span>&gt;<span class="keyword">cmd_vel</span>&lt;/<span class="keywordtype">topic</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>The first <code>TriggeredPublisher</code> we create will demonstrate how we can send a predetermined <code>Twist</code> message to the <code>DiffDrive</code> vehicle in response to a "start" message from the user:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-triggered-publisher-system&quot;</span></div>
<div class="line">        <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::TriggeredPublisher&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">input</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Empty&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/start&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">output</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Twist&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/cmd_vel&quot;</span>&gt;</div>
<div class="line">      <span class="keyword">linear:</span> {<span class="keyword">x:</span> 3}</div>
<div class="line">  &lt;/<span class="keywordtype">output</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>The <code>&lt;input&gt;</code> tag sets up the <code>TriggeredPublisher</code> to subscribe to the topic <code>/start</code> with a message type of <code>gz.msgs.Empty</code>. The <code>&lt;output&gt;</code> tag specifies the topic of the output and the actual data to be published. The data is expressed in the human-readable form of Google Protobuf messages. This is the same format used by <code>gz topic</code> for publishing messages.</p>
<p>Since the <code>TriggeredPublisher</code> only deals with Gazebo topics, it can be anywhere a <code>&lt;plugin&gt;</code> tag is allowed. For this example, we will put it under <code>&lt;world&gt;</code>.</p>
<p>Next we will create a trigger that causes a box to fall when the <code>DiffDrive</code> vehicle crosses a contact sensor on the ground. To do this, we first create the falling box model and call it <code>box1</code></p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box1&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">pose</span>&gt;3 0 8 0 0 0&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box_body&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">visual</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;v1&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">box</span>&gt;&lt;<span class="keywordtype">size</span>&gt;1 1 1&lt;/<span class="keywordtype">size</span>&gt;&lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">material</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">diffuse</span>&gt;0.8 0.2 0.2 1&lt;/<span class="keywordtype">diffuse</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">specular</span>&gt;1.0 0 0 1&lt;/<span class="keywordtype">specular</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">material</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">visual</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">collision</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;c1&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">box</span>&gt;&lt;<span class="keywordtype">size</span>&gt;1 1 1&lt;/<span class="keywordtype">size</span>&gt;&lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">collision</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">link</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>For now, the model will only contain a single link with a <code>&lt;visual&gt;</code> and a <code>&lt;collision&gt;</code>. Next, we create a model named "trigger" that contains the contact sensor, the <code>TouchPlugin</code> and <code>DetachableJoint</code> systems as well as visuals indicating where the sensor is on the ground.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;trigger&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">pose</span>&gt;3 0 0 0 0 0&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">static</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">static</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">link</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;body&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">visual</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;v1&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">box</span>&gt;&lt;<span class="keywordtype">size</span>&gt;0.1 10 0.01&lt;/<span class="keywordtype">size</span>&gt;&lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">visual</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">collision</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;c1&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">box</span>&gt;&lt;<span class="keywordtype">size</span>&gt;0.1 10 0.01&lt;/<span class="keywordtype">size</span>&gt;&lt;/<span class="keywordtype">box</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">geometry</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">collision</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">sensor</span> <span class="keyword">name</span>=<span class="stringliteral">&#39;sensor_contact&#39;</span> <span class="keyword">type</span>=<span class="stringliteral">&#39;contact&#39;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">contact</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">collision</span>&gt;<span class="keyword">c1</span>&lt;/<span class="keywordtype">collision</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">contact</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">sensor</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">link</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">plugin</span></div>
<div class="line">      <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-touchplugin-system&quot;</span></div>
<div class="line">      <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::TouchPlugin&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">target</span>&gt;<span class="keyword">vehicle_blue</span>&lt;/<span class="keywordtype">target</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">namespace</span>&gt;<span class="keyword">trigger</span>&lt;/<span class="keywordtype">namespace</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">time</span>&gt;0.001&lt;/<span class="keywordtype">time</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">enabled</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">enabled</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">plugin</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-detachable-joint-system&quot;</span></div>
<div class="line">            <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::DetachableJoint&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">parent_link</span>&gt;<span class="keyword">body</span>&lt;/<span class="keywordtype">parent_link</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">child_model</span>&gt;<span class="keyword">box1</span>&lt;/<span class="keywordtype">child_model</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">child_link</span>&gt;<span class="keyword">box_body</span>&lt;/<span class="keywordtype">child_link</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">detach_topic</span>&gt;/<span class="keyword">box1</span>/<span class="keyword">detach</span>&lt;/<span class="keywordtype">detach_topic</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The contact sensor needs the <code>Contact</code> system under <code>&lt;world&gt;</code></dd></dl>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">world</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">plugin</span></div>
<div class="line">    <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-contact-system&quot;</span></div>
<div class="line">    <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Contact&quot;</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">&lt;/<span class="keywordtype">world</span>&gt;</div>
</div><!-- fragment --><p>The <code>DetachableJoint</code> system creates a fixed joint between the link "body" in <code>trigger</code> and the link "box_body" in <code>box1</code>. The model <code>trigger</code> is a static model, hence, <code>box1</code> will remain fixed in space as long as it is attached to <code>trigger</code>. The <code>DetachableJoint</code> system subscribes to the <code>/box1/detach</code> topic and, on receipt of a message, will break the fixed joint and lets <code>box1</code> fall to the ground.</p>
<p>When the vehicle runs over the contact sensor associated with <code>c1</code>, the <code>TouchPlugin</code> will publish a message on <code>/trigger/touched</code>. We will use this as our trigger to send a message to <code>/box1/detach</code>. The <code>TouchPlugin</code> publishes only when there is contact, so we can trigger on any received message. However, to demonstrate the use of matchers, we will only trigger when the Boolean input message is <code>true</code></p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-triggered-publisher-system&quot;</span></div>
<div class="line">        <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::TriggeredPublisher&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">input</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Boolean&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/trigger/touched&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">match</span>&gt;<span class="keyword">data:</span> <span class="keyword">true</span>&lt;/<span class="keywordtype">match</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">input</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">output</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Empty&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/box1/detach&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>Finally, we will use an Altimeter sensor to detect when <code>box1</code> has fallen to the ground to cause another box to fall. We will add the Altimeter sensor to the link "box_body" in <code>box1</code></p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box1&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">pose</span>&gt;3 0 8 0 0 0&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box_body&quot;</span>&gt;</div>
<div class="line">    ...</div>
<div class="line">    &lt;<span class="keywordtype">sensor</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;altimeter_sensor&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;altimeter&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">topic</span>&gt;/<span class="keyword">altimeter</span>&lt;/<span class="keywordtype">topic</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">always_on</span>&gt;1&lt;/<span class="keywordtype">always_on</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">update_rate</span>&gt;30&lt;/<span class="keywordtype">update_rate</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">visualize</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">visualize</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">sensor</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">link</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The Altimeter sensor needs the <code>Altimter</code> system under <code>&lt;world&gt;</code> <div class="fragment"><div class="line">&lt;<span class="keywordtype">world</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">plugin</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-altimeter-system&quot;</span></div>
<div class="line">    <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Altimeter&quot;</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">&lt;/<span class="keywordtype">world</span>&gt;</div>
</div><!-- fragment --></dd></dl>
<p>We will call the second falling box <code>box2</code> and it will contain the same types of visuals and collisions as in box1.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;box2&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">pose</span>&gt;5 0 8 0 0 0&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>Again, we'll make use of the <code>DetachableJoint</code> system to attach <code>box2</code> to the static model <code>trigger</code> by adding the following to <code>trigger</code></p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;trigger&quot;</span>&gt;</div>
<div class="line">  ...</div>
<div class="line">  &lt;<span class="keywordtype">plugin</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-detachable-joint-system&quot;</span></div>
<div class="line">          <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::DetachableJoint&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">parent_link</span>&gt;<span class="keyword">body</span>&lt;/<span class="keywordtype">parent_link</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">child_model</span>&gt;<span class="keyword">box2</span>&lt;/<span class="keywordtype">child_model</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">child_link</span>&gt;<span class="keyword">box_body</span>&lt;/<span class="keywordtype">child_link</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">detach_topic</span>&gt;/<span class="keyword">box2</span>/<span class="keyword">detach</span>&lt;/<span class="keywordtype">detach_topic</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>Similar to what we did for <code>box1</code>, we need to publish to <code>/box2/detach</code> when our desired trigger occurs. To setup our trigger, we observe that the altimeter publishes an <code>gz.msgs.Altimeter</code> message that contains a <code>vertical_position</code> field. Since we do not necessarily care about the values of the other fields inside <code>gz.msgs.Altimeter</code>, we will create a <code>TriggeredPublisher</code> matcher that matches a specific field.</p>
<p>The value of the <code>vertical_position</code> field will be the altitude of the link that it is associated with relative to its starting altitude. When <code>box1</code> falls to the ground, the value of the altimeter will read about -7.5. However, since we do not know the exact value and an exact comparison of floating point numbers is not advised, we will set a tolerance of 0.2.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-triggered-publisher-system&quot;</span></div>
<div class="line">        <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::TriggeredPublisher&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">input</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Altimeter&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/altimeter&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">match</span> <span class="keyword">field</span>=<span class="stringliteral">&quot;vertical_position&quot;</span> <span class="keyword">tol</span>=<span class="stringliteral">&quot;0.2&quot;</span>&gt;-7.5&lt;/<span class="keywordtype">match</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">input</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">output</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Empty&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/box2/detach&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>We can now run the simulation and from the command line by running</p>
<div class="fragment"><div class="line">gz sim -r triggered_publisher.sdf</div>
</div><!-- fragment --><p>and publish the start message</p>
<div class="fragment"><div class="line">gz topic -t &quot;/start&quot; -m gz.msgs.Empty -p &quot; &quot;</div>
</div><!-- fragment --><p>The vehicle will start moving forward and two boxes will eventually fall to the ground.</p>
<p>Once both boxes have fallen, we can publish a message to invoke a service call to reset the vehicle position as well as set the speed to 0. As shown below, the <code>&lt;output&gt;</code> sets the linear x speed to 0, and the <code>&lt;service&gt;</code> tag contains metadata to invoke a service call to <code>/world/triggered_publisher/set_pose</code>. The <code>reqMsg</code> is expressed in the human-readable form of Google Protobuf meesages. Multiple <code>&lt;service&gt;</code> tags can be used as well as with the <code>&lt;output&gt;</code> tag.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-triggered-publisher-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::TriggeredPublisher&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">input</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Empty&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/reset_robot&quot;</span>/&gt;</div>
<div class="line">  &lt;<span class="keywordtype">output</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;gz.msgs.Twist&quot;</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;/cmd_vel&quot;</span>&gt;</div>
<div class="line">      <span class="keyword">linear:</span> {<span class="keyword">x:</span> 0}</div>
<div class="line">  &lt;/<span class="keywordtype">output</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">service</span></div>
<div class="line">    <span class="keyword">name</span>=<span class="stringliteral">&quot;/world/triggered_publisher/set_pose&quot;</span></div>
<div class="line">    <span class="keyword">reqType</span>=<span class="stringliteral">&quot;gz.msgs.Pose&quot;</span></div>
<div class="line">    <span class="keyword">repType</span>=<span class="stringliteral">&quot;gz.msgs.Boolean&quot;</span></div>
<div class="line">    <span class="keyword">timeout</span>=<span class="stringliteral">&quot;3000&quot;</span></div>
<div class="line">    <span class="keyword">reqMsg</span>=<span class="stringliteral">&quot;name: &#39;blue_vehicle&#39;, id: 8, position: {x: -3, z: 1}&quot;</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">service</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>Publish an empty message to the <code>/reset_robot</code> topic to reset the vehicle back to its original position.</p>
<div class="fragment"><div class="line">gz topic -t &quot;/reset_robot&quot; -m gz.msgs.Empty -p &quot; &quot;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
