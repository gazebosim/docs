<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: Particle Emitter</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        8.6.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Particle Emitter </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial shows how to use the particle emitter system to add and configure particle effects like smoke and fog in simulation. It also shows the effects that particles have on different types of sensors in Gazebo.</p>
<h2><a class="anchor" id="autotoc_md315"></a>
Particle Emitter System</h2>
<p>We will demonstrate the particle emitter system by using the <a href="https://github.com/gazebosim/gz-sim/blob/main/examples/worlds/particle_emitter.sdf">examples/worlds/particle_emitter.sdf</a> world.</p>
<p>To be able to spawn particle emitters, first you will need to include the particle emitter system as a plugin to the world in your SDF. The system does not take any arguments.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">  <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-particle-emitter-system&quot;</span></div>
<div class="line">  <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::ParticleEmitter&quot;</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>Next, we can start adding particle emitter models into the world. In our example world, we include a <a href="https://app.gazebosim.org/OpenRobotics/fuel/models/Fog%20Generator">Fog Generator</a> model from Gazebo Fuel:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">include</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">uri</span>&gt;<span class="keyword">https:</span>//<span class="keyword">fuel.gazebosim.org</span>/1.0/<span class="keyword">openrobotics</span>/<span class="keyword">models</span>/<span class="keyword">fog</span> <span class="keyword">generator</span>&lt;/<span class="keywordtype">uri</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">include</span>&gt;</div>
</div><!-- fragment --><p>Here is the content of the Fog Generator <a href="https://fuel.gazebosim.org/1.0/OpenRobotics/models/Fog%20Generator/1/files/model.sdf">model.sdf</a> file.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">model</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;fog_generator&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">pose</span>&gt;0 0 0 0 -1.5707 0&lt;/<span class="keywordtype">pose</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">static</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">static</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">link</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;fog_link&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">particle_emitter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;emitter&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;box&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">emitting</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">emitting</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">size</span>&gt;10 10 0&lt;/<span class="keywordtype">size</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">particle_size</span>&gt;1 1 1&lt;/<span class="keywordtype">particle_size</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">lifetime</span>&gt;25&lt;/<span class="keywordtype">lifetime</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">min_velocity</span>&gt;0.1&lt;/<span class="keywordtype">min_velocity</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">max_velocity</span>&gt;0.2&lt;/<span class="keywordtype">max_velocity</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">scale_rate</span>&gt;0.5&lt;/<span class="keywordtype">scale_rate</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">rate</span>&gt;5&lt;/<span class="keywordtype">rate</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">material</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">diffuse</span>&gt;0.7 0.7 0.7&lt;/<span class="keywordtype">diffuse</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">specular</span>&gt;1.0 1.0 1.0&lt;/<span class="keywordtype">specular</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">pbr</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">metal</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">albedo_map</span>&gt;<span class="keyword">materials</span>/<span class="keyword">textures</span>/<span class="keyword">fog.png</span>&lt;/<span class="keywordtype">albedo_map</span>&gt;</div>
<div class="line">          &lt;/<span class="keywordtype">metal</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">pbr</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">material</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">color_range_image</span>&gt;<span class="keyword">materials</span>/<span class="keyword">textures</span>/<span class="keyword">fogcolors.png</span>&lt;/<span class="keywordtype">color_range_image</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">particle_emitter</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">link</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">model</span>&gt;</div>
</div><!-- fragment --><p>The SDF 1.6+ specification supports having a <code>&lt;particle_emitter&gt;</code> SDF element as a child of <code>&lt;link&gt;</code>. The particle emitter itself has several properties that can be configured, see Gazebo Rendering's <a href="https://gazebosim.org/api/rendering/8/particles.html">particles tutorial</a> for more details on these properties. In our Fog Generator model, we are using a box type particle emitter that covers a region size of 10 by 10m. By default, the particles are emitted in the <code>+x</code> direction, hence the model as a pitch rotation of -90 degrees to rotate the particle emitter so that the particles are emitted upwards in <code>+z</code>.</p>
<p>Let's launch the example world to see what it looks like.</p>
<div class="fragment"><div class="line">gz sim -v 4 -r particle_emitter.sdf</div>
</div><!-- fragment --><p>You should see the fog slowly starting to appear from the ground plane in the world:</p>
<div class="image">
<img src="fog_generator.png" alt=""/>
</div>
<p>Next, try changing some properties of the particle emitter while the simulation is running. You can do this by publishing messages over Gazebo Transport. Try turning off the particle emitter by setting the <code>emitting</code> property to <code>false</code>. Make sure the simulation is running in order for this command to take effect.</p>
<div class="fragment"><div class="line">gz topic -t /model/fog_generator/link/fog_link/particle_emitter/emitter/cmd -m gz.msgs.ParticleEmitter -p &#39;emitting: {data: false}&#39;</div>
</div><!-- fragment --><p>Note the above command tells the particle emitter to stop emitting. It does not make all the particles disappear immediately. The particles that have already been emitted will naturally fade and disappear over the specified <code>lifetime</code>.</p>
<p>Turn particle emitter back on by setting the <code>emitting</code> property to <code>true</code>:</p>
<div class="fragment"><div class="line">gz topic -t /model/fog_generator/link/fog_link/particle_emitter/emitter/cmd -m gz.msgs.ParticleEmitter -p &#39;emitting: {data: true}&#39;</div>
</div><!-- fragment --><p>Here is an example command for changing the <code>rate</code> property of the particle emitter. This should make the particle emitter emit more particles per second, causing it to visually appear more dense.</p>
<div class="fragment"><div class="line">gz topic -t /model/fog_generator/link/fog_link/particle_emitter/emitter/cmd -m gz.msgs.ParticleEmitter -p &#39;rate: {data: 100}&#39;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md316"></a>
Particle Effects on Sensors</h2>
<p>The particles are not only a visual effect in simulation, they also have an effect on sensors in simulation. Here are the sensor types and the effects the particle emitter have on them:</p>
<ul>
<li><code>camera</code>: The particles are visible to a regular camera sensor</li>
<li><code>depth_camera</code>: The particles have a scattering effect on the depth data.</li>
<li><code>rgbd_camera</code>: The particles are visible in the RGB image and have a scattering effect on the depth data.</li>
<li><code>gpu_lidar</code>: The particles have a scattering effect on the lidar range readings.</li>
<li><code>thermal_camera</code>: The particles are not visible in the thermal camera image.</li>
</ul>
<p>The gif below shows an <a href="https://gist.github.com/iche033/bcd3b7d3f4874e1e707e392d6dbb0aa0">example world</a> with six different sensors looking at the fog generator with a rescue randy model inside the fog.</p>
<div class="image">
<img src="sensor_scatter_tutorial.gif" alt=""/>
</div>
<p>The two image displays on the left show the images from a regular camera sensor and RGB output of a RGBD camera. The two have very similar color image output that shows the fog in the camera view. To their right are the depth images produced by a depth camera and the depth output of the RGBD camera. The depth readings are noisy due to the particle scattering effect. You can also see that these sensors can partially see through the fog and detect the rescue randy inside it. The bottom left of the gif shows the lidar visualization; the range data are also affected by the scattering effect. Finally, the thermal camera image display on the bottom right shows that thermal cameras do not detect particles.</p>
<p>The sensor scattering effect can be configured by adding <code>&lt;particle_scatter_ratio&gt;</code> to the <code>&lt;particle_emitter&gt;</code> SDF element. This property determines the ratio of particles that will be detected by sensors. Increasing the ratio means there is a higher chance of particles reflecting and interfering with depth sensing, making the emitter appear more dense. Decreasing the ratio decreases the chance of particles reflecting and interfering with depth sensing, making it appear less dense.</p>
<p>See image below that reduces the particle scatter ratio to 0.1. The depth camera image, RGBD camera's depth image, and lidar's range data are noticeably less noisy than the gif above.</p>
<div class="image">
<img src="particle_scatter_ratio.png" alt=""/>
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
