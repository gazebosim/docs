<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Cmake">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Cmake: Developing with Gazebo CMake</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Cmake</h1>
        <h2>API Reference</h2>
        <div class="version">
        5.0.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Developing with Gazebo CMake</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="developing-with-gazebo-cmake"></a>
Developing with Gazebo CMake</h1>
<p>This tutorial documents various tips and strategies for developing with Gazebo CMake.</p>
<h2><a class="anchor" id="helpful-cmake-flags"></a>
Helpful CMake flags</h2>
<p>There are several flags that control the results of the CMake tool. Some of these flags are built into CMake, where some are Gazebo CMake specific.</p>
<p>All of the following flags may be set as part of an individual CMake invocation. Alternatively, the flags may be passed to <code>colcon</code> using techniques described later in this document.</p>
<h3><a class="anchor" id="setting-the-build-type"></a>
Setting the build type</h3>
<p>The <code>CMAKE_BUILD_TYPE</code> variable controls the type of binary output from the build stage. This will have an impact on the flags passed to the compiler and linker.</p>
<p>The available options are:</p>
<ul>
<li><code>RelWithDebInfo</code>: Mostly optimized build, but with debug symbols.</li>
<li><code>Debug</code>: Debug build without optimizations, with debug symbols enabled.</li>
<li><code>Release</code>: Fully optimized build, no debug symbols.</li>
<li><code>MinSizeRel</code>: Fully optimized build, minimal binary size</li>
<li><code>Coverage</code>: Build with additional information required for the <a href="https://en.wikipedia.org/wiki/Gcov"><code>gcov</code> analysis tool</a></li>
<li><code>Profile</code>: Use flags that are helpful with the <a href="https://en.wikipedia.org/wiki/Gprof"><code>gprof</code> profiling tool</a></li>
</ul>
<p>More information about flags applied can be found in <a href="https://github.com/gazebosim/gz-cmake/blob/gz-cmake5/cmake/GzSetCompilerFlags.cmake">GzSetCompilerFlags.cmake</a></p>
<p>If left unspecified, <code>CMAKE_BUILD_TYPE</code> is set to <code>RelWithDebInfo</code></p>
<p>To change the build type, set the CMake flag:</p>
<div class="fragment"><div class="line">-DCMAKE_BUILD_TYPE=Debug</div>
</div><!-- fragment --><h3><a class="anchor" id="disabling-or-suppressing-warnings-about-optional-components"></a>
Disabling or suppressing warnings about optional components</h3>
<p>Many Gazebo packages come with optional component libraries. These optional components will typically have additional dependencies that the package's core library does not require. If you are missing the dependencies of any optional components, you will receive a cmake warning like</p>
<div class="fragment"><div class="line">-- Skipping component [component_name]: Missing dependency [dependency_name].</div>
<div class="line">   ^~~~~ Set SKIP_component_name=true in cmake to suppress this warning.</div>
</div><!-- fragment --><p>If you do not care about the specified component, you can safely ignore this warning. The configuration and build steps will succeed without any problem. The only side effect is the optional component will not be built.</p>
<p>If you do want to build the optional component, then you will need to install whichever dependencies were said to be missing and then rerun cmake.</p>
<p>If you do <em>not</em> want to build the optional component and you want to suppress the warning about the missing dependencies, you can set the cmake flag:</p>
<div class="fragment"><div class="line">-DSKIP_component_name=true</div>
</div><!-- fragment --><p>where you should replace <code>component_name</code> with the actual name of the component as specified inside the angle brackets <code>[]</code> of the warning.</p>
<h3><a class="anchor" id="creating-a-compilation-database"></a>
Creating a compilation database</h3>
<p><code>CMake</code> can optionally generate a compilation data base that may be used with a variety of code completion tools.</p>
<p>By default, a compilation database is <em>not generated</em></p>
<p>To enable compilation database generation, set the CMake flag:</p>
<div class="fragment"><div class="line">-DCMAKE_EXPORT_COMPILE_COMMANDS=ON</div>
</div><!-- fragment --><p>For more information about what the compilation database is, consult the <a href="https://clang.llvm.org/docs/JSONCompilationDatabase.html"><code>clang</code> documentation</a></p>
<p>Some examples of utilities that can use the compilation database:</p>
<ul>
<li><a href="https://github.com/neoclide/coc.nvim"><code>coc.vim</code></a>: Code completion for VIM</li>
<li><a href="https://github.com/ycm-core/YouCompleteMe"><code>YouCompleteMe</code></a> Code completion for VIM</li>
</ul>
<h3><a class="anchor" id="using-the-ninja-build-system"></a>
Using the ninja build system</h3>
<p>Rather than using <code>make</code>, it may be desired to use the <a href="https://ninja-build.org/">Ninja</a> build tool.</p>
<p>By default <code>make</code> will be used.</p>
<p>To change the build system type, set the CMake flag:</p>
<div class="fragment"><div class="line">-GNinja</div>
</div><!-- fragment --><h3><a class="anchor" id="build-sanitizers"></a>
Build sanitizers</h3>
<p><code>GZ_SANITIZER</code> CMake parameter can be used with different compilers to support the detection of different problems in the code. <a href="https://gazebosim.org/api/cmake/4/sanitizersbuilds.html">Check the documentation for <code>GZ_SANITIZER</code> flag</a></p>
<h3><a class="anchor" id="using-ccache"></a>
Using CCache</h3>
<p>When you are doing frequent rebuilds, you can use a program to cache intermediate compiler results.</p>
<p>First, install <a href="https://ccache.dev/"><code>ccache</code></a> and configure it to an appropriate cache size for your system:</p>
<div class="fragment"><div class="line">$ sudo apt update &amp;&amp; sudo apt install ccache</div>
<div class="line">$ ccache -M10G</div>
<div class="line">Set cache size limit to 10.0 GB</div>
</div><!-- fragment --><p>Then set the CMake flags:</p>
<div class="fragment"><div class="line">-DCMAKE_C_COMPILER_LAUNCHER=ccache</div>
<div class="line">-DCMAKE_CXX_COMPILER_LAUNCHER=ccache</div>
</div><!-- fragment --><h3><a class="anchor" id="enablingdisabling-documentation"></a>
Enabling/Disabling Documentation</h3>
<p>When you are doing frequent rebuilds, it generally doesn't make sense to rebuild documentation each build.</p>
<p>By default, building documentation is <em>enabled</em>.</p>
<p>To disable building documentation, set the CMake flag:</p>
<div class="fragment"><div class="line">-DBUILD_DOCS=OFF</div>
</div><!-- fragment --><h3><a class="anchor" id="enablingdisabling-tests"></a>
Enabling/Disabling Tests</h3>
<p>If your intent is to only produce libraries and executables, it is possible to disable tests.</p>
<p>By default, building tests is <em>enabled</em>.</p>
<p>To disable building tests, set the CMake flag:</p>
<div class="fragment"><div class="line">-DBUILD_TESTING=OFF</div>
</div><!-- fragment --><h3><a class="anchor" id="enablingdisabling-buildsystem-tests"></a>
Enabling/Disabling Buildsystem Tests</h3>
<p>There are additional tests of the Gazebo CMake buildsystem. It is recommend to run these tests when making modifications to the Gazebo CMake codebase.</p>
<p>By default, building buildsystem tests is <em>disabled</em>.</p>
<p>To enable building buildsystem tests, set the CMake flags:</p>
<div class="fragment"><div class="line">-DBUILD_TESTING=ON</div>
<div class="line">-DBUILDSYSTEM_TESTING=ON</div>
</div><!-- fragment --><h2><a class="anchor" id="developing-with-colcon-and-vcstool"></a>
Developing with Colcon and vcstool</h2>
<p><a href="https://colcon.readthedocs.io/en/released/"><code>colcon</code></a> is a tool that improves the workflow of building and testing multiple software packages. As a Gazebo collection is composed of multiple packages that are frequently built and tested together, <code>colcon</code> eases this workflow.</p>
<p>The basic outline of obtaining Gazebo source packages via <code>vcs</code> and building with <code>colcon</code> is available in the <a href="https://gazebosim.org/docs/latest/install_ubuntu_src">Gazebo source installation documentation</a>.</p>
<h3><a class="anchor" id="passing-cmake-flags-via-command-line"></a>
Passing CMake flags via command line</h3>
<p>When performing <code>colcon</code> builds, flags may be passed to Gazebo CMake to configure the build.</p>
<p>This can be done via the <code>--cmake-args</code> flag in <code>colcon</code>:</p>
<div class="fragment"><div class="line">colcon build --cmake-args -DCMAKE_EXPORT_COMPILE_COMMANDS=1</div>
</div><!-- fragment --><h3><a class="anchor" id="passing-colcon-mixins-via-command-line"></a>
Passing colcon mixins via command line</h3>
<p>To ease configuration of common flags, <code>colcon</code> has a concept of <code>mixins</code>, that are flags that "shortcut" groups of behavior.</p>
<p>The set of readily-available defaults is in the <a href="https://github.com/colcon/colcon-mixin-repository">colcon-mixin-repository</a>.</p>
<p>To install:</p>
<div class="fragment"><div class="line">$ colcon mixin add default https://raw.githubusercontent.com/colcon/colcon-mixin-repository/master/index.yaml</div>
<div class="line">$ colcon mixin update default</div>
<div class="line">$ colcon mixin show</div>
</div><!-- fragment --><p>An example of building with <code>colcon</code> with two mixins:</p><ul>
<li><a href="https://github.com/colcon/colcon-mixin-repository/blob/master/ccache.mixin"><code>ccache</code> mixin</a></li>
<li><a href="https://github.com/colcon/colcon-mixin-repository/blob/master/build-type.mixin"><code>rel-with-db-info</code> mixin</a></li>
</ul>
<div class="fragment"><div class="line">colcon build --mixin ccache rel-with-deb-info</div>
</div><!-- fragment --><p>This will build with the flags applied from the requested mixins.</p>
<p>Colcon allows you to create your own mixins for commonly-reused command line flags. For more information about creating mixins, consult the <a href="https://colcon.readthedocs.io/en/released/reference/mixin-arguments.html"><code>colcon mixin</code> documentation</a></p>
<h3><a class="anchor" id="using-a-defaults-file"></a>
Using a defaults file</h3>
<p>It is useful to be able to apply a consistent set of flags across an entire Gazebo collection when building. One mechanism for accomplishing this is a <code>defaults.yaml</code> file. This is a file of configuration options that <code>colcon</code> will read to customize the default behavior. More information about the <code>defaults.yaml</code> file can be found in the corresponding <a href="https://colcon.readthedocs.io/en/released/user/configuration.html#defaults-yaml"><code>colcon</code> documentation</a></p>
<p>For the following, if you do not have <code>colcon</code> or <code>vcs</code> installed, consult the <a href="https://gazebosim.org/docs/latest/install_ubuntu_src">Gazebo source installation documentation</a>.</p>
<p>To try this out, first create a Gazebo source workspace: </p><div class="fragment"><div class="line">mkdir -p ~/gz_edifice/src</div>
<div class="line">cd ~/gz_edifice/</div>
<div class="line">wget https://raw.githubusercontent.com/gazebo-tooling/gazebodistro/main/collection-edifice.yaml</div>
<div class="line">vcs import src &lt; collection-edifice.yaml</div>
</div><!-- fragment --><p>Then add a <code>~/gz_edifice/defaults.yaml</code> file with compilation flags:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;build&quot;: {</div>
<div class="line">    &quot;merge-install&quot;: true,</div>
<div class="line">    &quot;symlink-install&quot;: true,</div>
<div class="line">    &quot;cmake-args&quot;: [</div>
<div class="line">      &quot;--no-warn-unused-cli&quot;,</div>
<div class="line">      &quot;-DCMAKE_EXPORT_COMPILE_COMMANDS=1&quot;,</div>
<div class="line">      &quot;-DCMAKE_BUILD_TYPE=RelWithDebInfo&quot;,</div>
<div class="line">    ]</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>To build with this defaults file, first export the correct environment variable and execute colcon:</p>
<div class="fragment"><div class="line">cd ~/gz_edifice</div>
<div class="line">export COLCON_DEFAULTS_FILE=`pwd`/defaults.yaml</div>
<div class="line">colcon build</div>
</div><!-- fragment --><h3><a class="anchor" id="using-a-defaults-file-with-mixins"></a>
Using a defaults file with mixins</h3>
<p>Mixins can also be applied via the <code>defaults.yaml</code> file:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;build&quot;: {</div>
<div class="line">    &quot;merge-install&quot;: true,</div>
<div class="line">    &quot;symlink-install&quot;: true,</div>
<div class="line">    &quot;mixins&quot;: [</div>
<div class="line">      &quot;compile-commands&quot;,</div>
<div class="line">      &quot;rel-with-deb-info&quot;,</div>
<div class="line">    ]</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="setting-a-per-workspace-defaults-file-with-direnv"></a>
Setting a per-workspace defaults file with direnv</h3>
<p>Optionally, defaults can be applied user-wide by placing a defaults file at <code>$COLCON_HOME/defaults.yaml</code> (which is <code>~/.colcon/defaults.yaml</code> by default).</p>
<p>In order to manage per-workspace settings, a tool like <a href="https://direnv.net/"><code>direnv</code></a> can be used to automate the application of the environment variable. Once <code>direnv</code> is installed and configured with your shell of choice, do the following:</p>
<div class="fragment"><div class="line">$ cd ~/gz_edifice/</div>
<div class="line"># The environment variable will be unset</div>
<div class="line">$ echo $COLCON_DEFAULTS_FILE</div>
<div class="line"> </div>
<div class="line">$ echo export COLCON_DEFAULTS_FILE=`pwd`/defaults.yaml &gt; .envrc</div>
<div class="line">direnv: error .envrc is blocked, Run `direnv allow` to approve its content</div>
<div class="line">$ direnv allow</div>
<div class="line">direnv: loading ~/gz_edifice/.envrc</div>
<div class="line">direnv: export +COLCON_DEFAULTS_FILE</div>
<div class="line"> </div>
<div class="line">$ echo $COLCON_DEFAULTS_FILE</div>
<div class="line">~/gz_edifice/defaults.yaml</div>
</div><!-- fragment --><p>Once this is configured, the environment will be applied each time you navigate to the <code>~/gz_edifice</code> directory or its children. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
