<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Rendering">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Rendering: Actor animation tutorial</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Rendering</h1>
        <h2>API Reference</h2>
        <div class="version">
        8.2.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Actor animation tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial will show you how to use the Gazebo Rendering library to create an actor animation.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Compile and run the example</h2>
<p>Clone the source code, Create a build directory and use <code>cmake</code> and <code>make</code> to compile the code:</p>
<div class="fragment"><div class="line">git clone https://github.com/gazebosim/gz-rendering</div>
<div class="line">cd gz-rendering/examples/actor_animation</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>When the code is compiled you can execute the example with the following command. Using the left and right button of the mouse you can move around the scene and zoom in and out.</p>
<div class="fragment"><div class="line">./actor_animation</div>
</div><!-- fragment --><div class="image">
<img src="actor_animation.png" alt=""/>
</div>
<h2><a class="anchor" id="autotoc_md31"></a>
Code</h2>
<p>In this section we will describe the main classes and methods used to create the actor. The basic steps are:</p>
<ul>
<li>Load the mesh with animations</li>
<li>Create the actor visual</li>
<li>Load the mesh into the render engine</li>
<li>Attach the mesh to the actor visual</li>
<li>Animate the skeleton</li>
</ul>
<p>Create a <code>MeshDescriptor</code> class with the mesh name of the actor, then using the <code>MeshManager</code> Singleton class, load the mesh and its animations using the descriptor:</p>
<div class="fragment"><div class="line">  <a class="codeRef" href="https://gazebosim.org/api/common/5/gz_2common_2Console_8hh.html#a4477f82c7273e73b91daf71766bcfda6">gzmsg</a> &lt;&lt; <span class="stringliteral">&quot;Creating mesh with animations...&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  MeshDescriptor descriptor;</div>
<div class="line">  descriptor.meshName = common::joinPaths(RESOURCE_PATH, <span class="stringliteral">&quot;walk.dae&quot;</span>);</div>
<div class="line">  common::MeshManager *meshManager = common::MeshManager::Instance();</div>
<div class="line">  descriptor.mesh = meshManager-&gt;Load(descriptor.meshName);</div>
</div><!-- fragment --><p> The mesh is now loaded with all animations. You can also add additional animations to the mesh:</p>
<div class="fragment"><div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> bvhFile = common::joinPaths(RESOURCE_PATH, <span class="stringliteral">&quot;cmu-13_26.bvh&quot;</span>);</div>
<div class="line">  <span class="keywordtype">double</span> scale = 0.055;</div>
<div class="line">  _skel = descriptor.mesh-&gt;MeshSkeleton();</div>
<div class="line">  _skel-&gt;AddBvhAnimation(bvhFile, scale);</div>
<div class="line">  <span class="keywordflow">if</span> (_skel-&gt;AnimationCount() == 0)</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="https://gazebosim.org/api/common/5/gz_2common_2Console_8hh.html#acf18c83e7419e002351f1eeceb6c2cf4">gzerr</a> &lt;&lt; <span class="stringliteral">&quot;Failed to load animation.&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  <a class="codeRef" href="https://gazebosim.org/api/common/5/gz_2common_2Console_8hh.html#a4477f82c7273e73b91daf71766bcfda6">gzmsg</a> &lt;&lt; <span class="stringliteral">&quot;Loaded animations: &quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _skel-&gt;AnimationCount(); ++i)</div>
<div class="line">    gzmsg &lt;&lt; <span class="stringliteral">&quot;  * &quot;</span> &lt;&lt; _skel-&gt;Animation(i)-&gt;Name() &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
</div><!-- fragment --><p> Create a <code>Visual</code> pointer with the scene manager and set the position and rotation of the visual:</p>
<div class="fragment"><div class="line">      <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> actorName = <span class="stringliteral">&quot;actor&quot;</span> + <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string/to_string.html">std::to_string</a>(count++);</div>
<div class="line">      <a class="code" href="namespacegz_1_1rendering.html#ade5c89d5a76252eccf0d1036e1d1f462" title="Shared pointer to Visual.">VisualPtr</a> actorVisual = _scene-&gt;CreateVisual(actorName);</div>
<div class="line"> </div>
<div class="line">      actorVisual-&gt;SetLocalPosition(x, y, 0);</div>
<div class="line">      actorVisual-&gt;SetLocalRotation(0, 0, 3.14);</div>
</div><!-- fragment --><p> Create the mesh in gz-rendering - this loads the animations into the render engine</p>
<div class="fragment"><div class="line">      <span class="keyword">auto</span> mesh = _scene-&gt;CreateMesh(descriptor);</div>
<div class="line">      <span class="keywordflow">if</span> (!mesh)</div>
<div class="line">      {</div>
<div class="line">        <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Failed to load mesh with animation.&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
</div><!-- fragment --><p> Finally, attach the mesh to the visual and add the visual to the scene:</p>
<div class="fragment"><div class="line">      actorVisual-&gt;AddGeometry(mesh);</div>
<div class="line">      root-&gt;AddChild(actorVisual);</div>
</div><!-- fragment --><p> There are two ways to play the animations:</p>
<ul>
<li>Update animation time: The first method is to advance the time every iteration and let the render engine handle the animations.</li>
</ul>
<div class="fragment"><div class="line">    ir::MeshPtr mesh =</div>
<div class="line">        std::dynamic_pointer_cast&lt;ir::Mesh&gt;(v-&gt;GeometryByIndex(0));</div>
<div class="line">    mesh-&gt;UpdateSkeletonAnimation(</div>
<div class="line">        std::chrono::duration_cast&lt;std::chrono::steady_clock::duration&gt;(</div>
<div class="line">        <a class="codeRef" href="http://en.cppreference.com/w/cpp/chrono/duration.html">std::chrono::duration&lt;double&gt;</a>(_time)));</div>
</div><!-- fragment --><ul>
<li>Update bone pose: The second and more involved method is to manually compute and set the bone pose over time.</li>
</ul>
<div class="fragment"><div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/map.html">std::map&lt;std::string, gz::math::Matrix4d&gt;</a> animFrames;</div>
<div class="line">    animFrames = g_skelAnim-&gt;PoseAt(_time, <span class="keyword">true</span>);</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/map.html">std::map&lt;std::string, gz::math::Matrix4d&gt;</a> skinFrames;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> pair : animFrames)</div>
<div class="line">    {</div>
<div class="line">      <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> animNodeName = pair.first;</div>
<div class="line">      <span class="keyword">auto</span> animTf = pair.second;</div>
<div class="line"> </div>
<div class="line">      <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> skinName =</div>
<div class="line">          g_skel-&gt;NodeNameAnimToSkin(g_animIdx, animNodeName);</div>
<div class="line">      <a class="codeRef" href="https://gazebosim.org/api/math/7/classgz_1_1math_1_1Matrix4.html">gz::math::Matrix4d</a> skinTf =</div>
<div class="line">              g_skel-&gt;AlignTranslation(g_animIdx, animNodeName)</div>
<div class="line">              * animTf * g_skel-&gt;AlignRotation(g_animIdx, animNodeName);</div>
<div class="line"> </div>
<div class="line">      skinFrames[skinName] = skinTf;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// set bone transforms</span></div>
<div class="line">    ir::MeshPtr mesh =</div>
<div class="line">        std::dynamic_pointer_cast&lt;ir::Mesh&gt;(v-&gt;GeometryByIndex(0));</div>
<div class="line">    mesh-&gt;SetSkeletonLocalTransforms(skinFrames);</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
